kind: job
metadata:
  name: concept-drift
  tag: ''
  hash: becc3056df8eb917251ee094d2b3bc540871cddf
  project: ''
  labels:
    author: orz
    framework: sklearn
  categories:
  - ml
  - serve
spec:
  command: ''
  args: []
  env: []
  default_handler: handler
  entry_points:
    concept_drift_deployer:
      name: concept_drift_deployer
      doc: "    \n    \n    "
      parameters:
      - name: context
        type: MLClientCtx
      - name: base_dataset
        type: DataItem
      - name: input_stream
        type: str
      - name: output_stream
        type: str
      - name: output_tsdb
        type: str
      - name: tsdb_batch_size
        type: int
      - name: callbacks
        type: list
      - name: models
        type: list
        default:
        - ddm
        - eddm
        - pagehinkley
      - name: models_dest
        default: models
      - name: pagehinkley_threshold
        type: float
        default: 10
      - name: ddm_warning_level
        type: float
        default: 2
      - name: ddm_out_control_level
        type: float
        default: 3
      - name: label_col
        default: label
      - name: prediction_col
        default: prediction
      - name: hub_url
        type: str
        default: <_ast.Name object at 0x7f320b8a6d30>
      - name: fn_tag
        type: str
        default: master
      outputs: []
      lineno: 14
  description: Deploy a streaming Concept Drift detector on a labeled stream
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHNrbXVsdGlmbG93LmRyaWZ0X2RldGVjdGlvbgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgb3MKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgZHVtcHMsIGxvYWQsIGR1bXAKCmZyb20gbnVjbGlvLnRyaWdnZXJzIGltcG9ydCBWM0lPU3RyZWFtVHJpZ2dlcgpmcm9tIG1scnVuIGltcG9ydCBEYXRhSXRlbSwgaW1wb3J0X2Z1bmN0aW9uLCBtbGNvbmYsIE1MQ2xpZW50Q3R4LCBtb3VudF92M2lvCgppbXBvcnQgcmFuZG9tCgpkZWYgY29uY2VwdF9kcmlmdF9kZXBsb3llcihjb250ZXh0OiBNTENsaWVudEN0eCwgYmFzZV9kYXRhc2V0OkRhdGFJdGVtLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRfc3RyZWFtOnN0ciwgb3V0cHV0X3N0cmVhbTpzdHIsIG91dHB1dF90c2RiOnN0ciwgdHNkYl9iYXRjaF9zaXplOmludCwgY2FsbGJhY2tzOmxpc3QsIAogICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbHM6bGlzdD1bJ2RkbScsICdlZGRtJywgJ3BhZ2VoaW5rbGV5J10sIG1vZGVsc19kZXN0PSdtb2RlbHMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlaGlua2xleV90aHJlc2hvbGQ6ZmxvYXQ9MTAsIGRkbV93YXJuaW5nX2xldmVsOmZsb2F0PTIsIGRkbV9vdXRfY29udHJvbF9sZXZlbDpmbG9hdD0zLAogICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9jb2w9J2xhYmVsJywgcHJlZGljdGlvbl9jb2w9J3ByZWRpY3Rpb24nLCBodWJfdXJsOnN0cj1tbGNvbmYuaHViX3VybCwgZm5fdGFnOnN0cj0nbWFzdGVyJyk6CiAgICAnJycKICAgIAogICAgCiAgICAnJycKICAgIG1sY29uZi5kYnBhdGggPSBtbGNvbmYuZGJwYXRoIG9yICdodHRwOi8vbWxydW4tYXBpOjgwODAnCiAgICBtbGNvbmYuaHViX3VybCA9IGh1Yl91cmwKICAgIGZuID0gaW1wb3J0X2Z1bmN0aW9uKHVybD0naHViOi8vY29uY2VwdF9kcmlmdF9zdHJlYW1pbmcnKQogICAgCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdMb2FkaW5nIGJhc2UgZGF0YXNldCcpCiAgICBiYXNlX2RmID0gYmFzZV9kYXRhc2V0LmFzX2RmKCkKICAgIGVycm9yX3N0cmVhbSA9IG5wLndoZXJlKGJhc2VfZGZbcHJlZGljdGlvbl9jb2xdLnZhbHVlcz09YmFzZV9kZltsYWJlbF9jb2xdLnZhbHVlcywgMCwgMSkKICAgIAogICAgY29udGV4dC5sb2dnZXIuaW5mbygnQ3JlYXRpbmcgbW9kZWxzJykKICAgIG1vZGVscyA9IFttb2RlbC5zdHJpcCgpIGZvciBtb2RlbCBpbiBvcy5nZXRlbnYoJ21vZGVscycsICdwYWdlaGlua2xleSwgZGRtLCBlZGRtJykuc3BsaXQoJywnKV0KICAgIG1vZGVscyA9IHsnZWRkbSc6IHNrbXVsdGlmbG93LmRyaWZ0X2RldGVjdGlvbi5FRERNKCksCiAgICAgICAgICAgICAgJ3BhZ2VoaW5rbGV5Jzogc2ttdWx0aWZsb3cuZHJpZnRfZGV0ZWN0aW9uLlBhZ2VIaW5rbGV5KG1pbl9pbnN0YW5jZXM9bGVuKGVycm9yX3N0cmVhbSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVzaG9sZD1wYWdlaGlua2xleV90aHJlc2hvbGQpLAogICAgICAgICAgICAgICdkZG0nOiBza211bHRpZmxvdy5kcmlmdF9kZXRlY3Rpb24uRERNKG1pbl9udW1faW5zdGFuY2VzPWxlbihlcnJvcl9zdHJlYW0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdfbGV2ZWw9ZGRtX3dhcm5pbmdfbGV2ZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0X2NvbnRyb2xfbGV2ZWw9ZGRtX291dF9jb250cm9sX2xldmVsKX0KICAgIAogICAgY29udGV4dC5sb2dnZXIuaW5mbygnU3RyZWFtaW5nIGRhdGEgdG8gbW9kZWxzJykKICAgIGZvciBpIGluIHJhbmdlKGxlbihlcnJvcl9zdHJlYW0pKToKICAgICAgICBmb3IgbW9kZWxfbmFtZSwgbW9kZWwgaW4gbW9kZWxzLml0ZW1zKCk6CiAgICAgICAgICAgIG1vZGVsLmFkZF9lbGVtZW50KGVycm9yX3N0cmVhbVtpXSkKICAgICAgICAgICAgCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdMb2dnaW5nIHJlYWR5IG1vZGVscycpCiAgICBmb3IgbmFtZSwgbW9kZWwgaW4gbW9kZWxzLml0ZW1zKCk6CiAgICAgICAgZGF0YSA9IGR1bXBzKG1vZGVsKQogICAgICAgIG1vZGVsX2ZpbGUgPSBmJ3tuYW1lfS5wa2wnCiAgICAgICAgY29udGV4dC5sb2dfbW9kZWwoZid7bmFtZX1fY29uY2VwdF9kcmlmdCcsIGJvZHk9ZGF0YSwgbGFiZWxzPVsnY29uY2VwdF9kcmlmdCddLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX2ZpbGU9bW9kZWxfZmlsZSwgbW9kZWxfZGlyPW1vZGVsc19kZXN0KQogICAgICAgIGZuLnNldF9lbnZzKHtmJ3tuYW1lfV9tb2RlbF9wYXRoJzogb3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgbW9kZWxzX2Rlc3QsIG1vZGVsX2ZpbGUpfSkKICAgICAgICAgICAgCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdEZXBsb3lpbmcgQ29uY2VwdCBEcmlmdCBTdHJlYW1pbmcgZnVuY3Rpb24nKQogICAgZm4uc2V0X2VudnMoeydsYWJlbF9jb2wnOiBsYWJlbF9jb2wsCiAgICAgICAgICAgICAgICAgJ3ByZWRpY3Rpb25fY29sJzogcHJlZGljdGlvbl9jb2wsIAogICAgICAgICAgICAgICAgICdkcmlmdF9zdHJlYW0nOiBvdXRwdXRfc3RyZWFtLAogICAgICAgICAgICAgICAgICd0c2RiX3RhYmxlJzogb3V0cHV0X3RzZGIsCiAgICAgICAgICAgICAgICAgJ3BhZ2VoaW5rbGV5X3RocmVzaG9sZCc6IHBhZ2VoaW5rbGV5X3RocmVzaG9sZCwKICAgICAgICAgICAgICAgICAnZGRtX3dhcm5pbmdfbGV2ZWwnOiBkZG1fd2FybmluZ19sZXZlbCwKICAgICAgICAgICAgICAgICAnZGRtX291dF9jb250cm9sJzogZGRtX291dF9jb250cm9sX2xldmVsfSkgICAgCiAgICBmbi5hZGRfdHJpZ2dlcignbGFiZWxlZF9zdHJlYW0nLCBWM0lPU3RyZWFtVHJpZ2dlcih1cmw9aW5wdXRfc3RyZWFtKSkKICAgIGZuLmFwcGx5KG1vdW50X3YzaW8oKSkKICAgIHByaW50KGZuLnRvX3lhbWwoKSkKICAgIGZuLmRlcGxveShwcm9qZWN0PWNvbnRleHQucHJvamVjdCkKCg==
    base_image: mlrun/ml-models:0.4.7
    commands:
    - python -m pip install scikit-multiflow==0.4.1
    - python -m pip install v3io_frames
    - python -m pip install git+https://github.com/nuclio/nuclio-jupyter.git
    code_origin: https://github.com/mlrun/functions#a29953add7917e0bbeda4517f48bcfbc63f90d15:concept_drift.ipynb
