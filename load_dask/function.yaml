kind: dask
metadata:
  name: load-dask
  tag: latest
  hash: c66091bc1b50fbdcc9293c6f8630941f3b7ff105
  project: ''
  labels:
    author: yjb
  categories:
  - fileutils
  - distributed
spec:
  command: ''
  image: mlrun/ml-models
  env: []
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTA0LTMwIDIwOjQzCgppbXBvcnQgb3MKaW1wb3J0IGpzb24KaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKCmltcG9ydCBkYXNrCmltcG9ydCBkYXNrLmRhdGFmcmFtZSBhcyBkZApmcm9tIGRhc2suZGlzdHJpYnV0ZWQgaW1wb3J0IENsaWVudCwgTG9jYWxDbHVzdGVyCgpmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCgpmcm9tIHR5cGluZyBpbXBvcnQgTGlzdCwgT3B0aW9uYWwKCmRlZiBsb2FkX2Rhc2soCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIHNyY19kYXRhOiBzdHIsCiAgICBkYXNrX2tleTogc3RyID0gImRhc2tfa2V5IiwKICAgIGluY19jb2xzOiBPcHRpb25hbFtMaXN0W3N0cl1dID0gTm9uZSwKICAgIGluZGV4X2NvbHM6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lLAogICAgZGFza19wZXJzaXN0OiBib29sID0gVHJ1ZSwKICAgIHJlZnJlc2hfZGF0YTogYm9vbCA9IFRydWUsCiAgICBzY2hlZHVsZXJfa2V5OiBzdHIgPSAic2NoZWR1bGVyIgopIC0+IE5vbmU6CiAgICAiIiJMb2FkIGRhdGFzZXQgaW50byBhbiBleGlzdGluZyBkYXNrIGNsdXN0ZXIKICAgIAogICAgZGFzayBqb2JzIGRlZmluZSB0aGUgZGFzayBjbGllbnQgcGFyYW1ldGVycyBhdCB0aGUgam9iIGxldmVsLCB0aGlzIG1ldGhvZCB3aWxsIHJhaXNlIGFuIGVycm9yIGlmIG5vIGNsaWVudCBpcyBkZXRlY3RlZC4KICAgIAogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBzcmNfZGF0YTogICAgICAgIHVybCBvZiB0aGUgZGF0YSBmaWxlIG9yIHBhcnRpdGlvbmVkIGRhdGFzZXQgYXMgZWl0aGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnRpZmFjdCBEYXRhSXRlbSwgc3RyaW5nLCBvciBwYXRoIG9iamVjdCAoc2ltaWxhciB0byAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhbmRhcyByZWFkX2NzdikKICAgIDpwYXJhbSBkYXNrX2tleTogICAgICAgIGRlc3RpbmF0aW9uIGtleSBvZiBkYXRhIG9uIGRhc2sgY2x1c3RlciBhbmQgYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBpbmNfY29sczogICAgICAgIGluY2x1ZGUgb25seSB0aGVzZSBjb2x1bW5zICh2ZXJ5IGZhc3QpCiAgICA6cGFyYW0gaW5kZXhfY29sczogICAgICBsaXN0IG9mIGluZGV4IGNvbHVtbiBuYW1lcyAoY2FuIGJlIGEgbG9uZy1ydW5uaW5nIHByb2Nlc3MpCiAgICA6cGFyYW0gZGFza19wZXJzaXN0OiAgICAoVHJ1ZSkgc2hvdWxkIHRoZSBkYXRhIGJlIHBlcnNpc3RlZCAodGhyb3VnaCB0aGUgYGNsaWVudC5wZXJzaXN0YCBvcCkKICAgIDpwYXJhbSByZWZyZXNoX2RhdGE6ICAgIChGYWxzZSkgaWYgdGhlIGRhc2tfa2V5IGFscmVhZHkgZXhpc3RzIGluIHRoZSBkYXNrIGNsdXN0ZXIsIHRoaXMgd2lsbCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIGFuIEV4Y2VwdGlvbi4gIFNldCB0byBUcnVlIHRvIHJlcGxhY2UgdGhlIGV4aXN0aW5nIGNsdXN0ZXIgZGF0YS4KICAgIDpwYXJhbSBzY2hlZHVsZXJfa2V5OiAgIChzY2hlZHVsZXIpIHRoZSBkYXNrIHNjaGVkdWxlciBjb25maWd1cmF0aW9uLCBqc29uIGFsc28gbG9nZ2VkIGFzIGFuIGFydGlmYWN0CiAgICAiIiIKICAgIGlmIGhhc2F0dHIoY29udGV4dCwgImRhc2tfY2xpZW50Iik6CiAgICAgICAgZGFza19jbGllbnQgPSBjb250ZXh0LmRhc2tfY2xpZW50CiAgICBlbHNlOgogICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiYSBkYXNrIGNsaWVudCB3YXMgbm90IGZvdW5kIGluIHRoZSBleGVjdXRpb24gY29udGV4dCIpCiAgICAKICAgIHNyY19kYXRhID0gc3RyKHNyY19kYXRhKQogICAgaWYgaXNpbnN0YW5jZShzcmNfZGF0YSwgc3RyKToKICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHNyY19kYXRhKSBvciBzcmNfZGF0YS5lbmRzd2l0aCgicHEiKSBvciBzcmNfZGF0YS5lbmRzd2l0aCgicGFycXVldCIpOgogICAgICAgICAgICBkZiA9IGRkLnJlYWRfcGFycXVldChzcmNfZGF0YSkKICAgICAgICBlbGlmIHNyY19kYXRhLmVuZHN3aXRoKCJjc3YiKToKICAgICAgICAgICAgZGYgPSBkZC5yZWFkX2NzdihzcmNfZGF0YSkKCiAgICBpZiBkYXNrX3BlcnNpc3Q6CiAgICAgICAgZGYgPSBkYXNrX2NsaWVudC5wZXJzaXN0KGRmKQogICAgICAgIGlmIGRhc2tfY2xpZW50LmRhdGFzZXRzIGFuZCBkYXNrX2tleSBpbiBkYXNrX2NsaWVudC5kYXRhc2V0czoKICAgICAgICAgICAgZGFza19jbGllbnQudW5wdWJsaXNoX2RhdGFzZXQoZGFza19rZXkpCiAgICAgICAgZGFza19jbGllbnQucHVibGlzaF9kYXRhc2V0KGRmLCBuYW1lPWRhc2tfa2V5KQogICAgCiAgICBpZiBjb250ZXh0OgogICAgICAgIGNvbnRleHQuZGFza19jbGllbnQgPSBkYXNrX2NsaWVudAogICAgICAgIAogICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBzY2hlZHVsZXJfa2V5KyIuanNvbiIpCiAgICBkYXNrX2NsaWVudC53cml0ZV9zY2hlZHVsZXJfZmlsZShmaWxlcGF0aCkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3Qoc2NoZWR1bGVyX2tleSwgbG9jYWxfcGF0aD1zY2hlZHVsZXJfa2V5KyIuanNvbiIpCgo=
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#43c6ce4b807e68feccd1333a2c005a43cd13ef5b:load_dask.ipynb
  description: load dask cluster with data
  replicas: 4
  remote: true
  service_type: NodePort
  nthreads: 1
  min_replicas: 0
  max_replicas: 8
  scheduler_timeout: 60 minutes
