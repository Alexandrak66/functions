kind: remote
metadata:
  name: iris-randomforestclassifier
  hash: e194298e4da0621ccb50835078bb9b31102f44fa
  project: default
  labels:
    author: yaronh
  categories:
  - serving
  - models
  - RandomForestClassifier
spec:
  command: ''
  args: []
  image: ''
  description: generic sklearn RandomForestClassifier model server
  min_replicas: 0
  max_replicas: 4
  env:
  - name: MODEL_CLASS
    value: ClassifierModel
  - name: ENABLE_EXPLAINER
    value: 'False'
  config:
    spec.triggers.http:
      kind: http
      maxWorkers: 8
      attributes:
        ingresses: {}
      annotations: {}
  base_spec:
    apiVersion: nuclio.io/v1
    kind: nuclio:serving
    metadata:
      annotations:
        nuclio.io/generated_by: function generated at 30-04-2020 by admin from /User/repos/functions/model_server/model_server.ipynb
      labels: {}
      name: iris-randomforestclassifier
    spec:
      build:
        baseImage: mlrun/ml-models
        commands:
        - pip install v3io
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTA0LTMwIDIxOjQ4CgppbXBvcnQgb3MKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgbG9hZAppbXBvcnQgbnVtcHkgYXMgbnAKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCmltcG9ydCBqc29uCmltcG9ydCBzb2NrZXQKaW1wb3J0IHYzaW8uZGF0YXBsYW5lCgp2M2lvX2NsaWVudCA9IHYzaW8uZGF0YXBsYW5lLkNsaWVudCgpCmhvc3RuYW1lID0gTm9uZQoKZGVmIHNwbGl0X3BhdGgobW50cGF0aD0nJyk6CiAgICBpZiBtbnRwYXRoWzBdID09ICcvJzoKICAgICAgICBtbnRwYXRoID0gbW50cGF0aFsxOl0KICAgIHBhdGhzID0gbW50cGF0aC5zcGxpdCgnLycpCiAgICBjb250YWluZXIgPSBwYXRoc1swXQogICAgc3VicGF0aCA9ICcnCiAgICBpZiBsZW4ocGF0aHMpID4gMToKICAgICAgICBzdWJwYXRoID0gbW50cGF0aFtsZW4oY29udGFpbmVyKTpdCiAgICByZXR1cm4gY29udGFpbmVyLCBzdWJwYXRoCiAKCmRlZiBpbml0X3N0cmVhbShzdHJlYW1fcGF0aCwgc2hhcmRzPTEpOgogICAgZ2xvYmFsIGhvc3RuYW1lCiAgICBob3N0bmFtZSA9IHNvY2tldC5nZXRob3N0bmFtZSgpCiAgICBjb250YWluZXIsIHN0cmVhbV9wYXRoID0gc3BsaXRfcGF0aChzdHJlYW1fcGF0aCkKICAgIHJlc3BvbnNlID0gdjNpb19jbGllbnQuY3JlYXRlX3N0cmVhbShjb250YWluZXI9Y29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9c3RyZWFtX3BhdGgsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJkX2NvdW50PXNoYXJkcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWlzZV9mb3Jfc3RhdHVzPXYzaW8uZGF0YXBsYW5lLlJhaXNlRm9yU3RhdHVzLm5ldmVyKQogICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cyhbNDA5LCAyMDRdKQogICAgcHJpbnQocmVzcG9uc2UuX19kaWN0X18pCiAgICAKZGVmIHB1c2hfdG9fc3RyZWFtKHN0cmVhbV9wYXRoLCBkYXRhKToKICAgIHJlY29yZHMgPSBbeydkYXRhJzoganNvbi5kdW1wcyhyZWMpfSBmb3IgcmVjIGluIGRhdGFdCiAgICBjb250YWluZXIsIHN0cmVhbV9wYXRoID0gc3BsaXRfcGF0aChzdHJlYW1fcGF0aCkKICAgIHJlc3BvbnNlID0gdjNpb19jbGllbnQucHV0X3JlY29yZHMoY29udGFpbmVyPWNvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aD1zdHJlYW1fcGF0aCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHM9cmVjb3JkcykKICAgIAoKaW1wb3J0IG1scnVuCmNsYXNzIENsYXNzaWZpZXJNb2RlbChtbHJ1bi5ydW50aW1lcy5NTE1vZGVsU2VydmVyKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBuYW1lOiBzdHIsIG1vZGVsX2Rpcjogc3RyLCBjbGFzc2lmaWVyID0gTm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhuYW1lKQogICAgICAgIHNlbGYubW9kZWxfZGlyID0gbW9kZWxfZGlyCiAgICAgICAgc2VsZi5sb2dfc3RyZWFtID0gb3MuZW52aXJvbi5nZXQoJ0lORkVSRU5DRV9TVFJFQU0nLCAnJykKICAgICAgICBpZiBzZWxmLmxvZ19zdHJlYW06CiAgICAgICAgICAgIGluaXRfc3RyZWFtKHNlbGYubG9nX3N0cmVhbSkKICAgICAgICBpZiBjbGFzc2lmaWVyOgogICAgICAgICAgICBzZWxmLmNsYXNzaWZpZXIgPSBjbGFzc2lmaWVyCiAgICAgICAgICAgIHNlbGYucmVhZHkgPSBUcnVlCgogICAgZGVmIGxvYWQoc2VsZik6CiAgICAgICAgIiIiTG9hZCBtb2RlbCBmcm9tIEt1YmVGbG93IHN0b3JhZ2UuCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5tb2RlbF9kaXIuZW5kc3dpdGgoJy5wa2wnKToKICAgICAgICAgICAgbW9kZWxfZmlsZSA9IHNlbGYubW9kZWxfZGlyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZm9yIGZpbGUgaW4gb3MucGF0aC5saXN0ZGlyKHNlbGYubW9kZWxfZGlyKToKICAgICAgICAgICAgICAgIGlmIGZpbGUuZW5kc3dpdGgoJy5wa2wnKToKICAgICAgICAgICAgICAgICAgICBtb2RlbF9maWxlID0gb3MucHRoLmpvaW4oc2VsZi5tb2RlbF9kaXIsIGZpbGUpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBzZWxmLmNsYXNzaWZpZXIgPSBsb2FkKG9wZW4obW9kZWxfZmlsZSwgJ3JiJykpCiAgICAgICAgc2VsZi5yZWFkeSA9IFRydWUKCiAgICBkZWYgcHJlZGljdChzZWxmLCBib2R5OiBkaWN0KSAtPiBMaXN0OgogICAgICAgICIiIkdlbmVyYXRlIG1vZGVsIHByZWRpY3Rpb25zIGZyb20gc2FtcGxlLgogICAgICAgIAogICAgICAgIDpwYXJhbSBib2R5IDogQSBkaWN0IG9mIG9ic2VydmF0aW9ucywgZWFjaCBvZiB3aGljaCBpcyBhbiAxLWRpbWVuc2lvbmFsIGZlYXR1cmUgdmVjdG9yLgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zIG1vZGVsIHByZWRpY3Rpb25zIGFzIGEgYExpc3RgLCBvbmUgZm9yIGVhY2ggcm93IGluIHRoZSBgYm9keWAgaW5wdXQgYExpc3RgLgogICAgICAgICIiIgogICAgICAgIHN0YXJ0ID0gZGF0ZXRpbWUubm93KCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZlYXRzID0gbnAuYXNhcnJheShib2R5WydpbnN0YW5jZXMnXSkKICAgICAgICAgICAgcmVzdWx0OiBucC5uZGFycmF5ID0gc2VsZi5jbGFzc2lmaWVyLnByZWRpY3QoZmVhdHMpCiAgICAgICAgICAgIHJlc3AgPSByZXN1bHQudG9saXN0KCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbihmIkZhaWxlZCB0byBwcmVkaWN0IHtlfSIpCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi5sb2dfc3RyZWFtOgogICAgICAgICAgICBkYXRhID0geydyZXF1ZXN0JzogYm9keSwgJ3Jlc3AnOiByZXNwLCAKICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOiAnQ2xhc3NpZmllck1vZGVsJywgCiAgICAgICAgICAgICAgICAgICAgJ21vZGVsJzogc2VsZi5uYW1lLAogICAgICAgICAgICAgICAgICAgICdob3N0JzogaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgJ3doZW4nOiBzdHIoc3RhcnQpLCAKICAgICAgICAgICAgICAgICAgICAnbWljcm9zZWMnOiAoZGF0ZXRpbWUubm93KCktc3RhcnQpLm1pY3Jvc2Vjb25kc30KICAgICAgICAgICAgcHVzaF90b19zdHJlYW0oc2VsZi5sb2dfc3RyZWFtLCBbZGF0YV0pCgogICAgICAgIHJldHVybiByZXNwCgoKZnJvbSBtbHJ1bi5ydW50aW1lcyBpbXBvcnQgbnVjbGlvX2luaXRfaG9vawpkZWYgaW5pdF9jb250ZXh0KGNvbnRleHQpOgogICAgbnVjbGlvX2luaXRfaG9vayhjb250ZXh0LCBnbG9iYWxzKCksICdzZXJ2aW5nJykKCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToKICAgIHJldHVybiBjb250ZXh0Lm1scnVuX2hhbmRsZXIoY29udGV4dCwgZXZlbnQpCg==
        noBaseImagesPull: true
      env:
      - name: MODEL_CLASS
        value: ClassifierModel
      handler: model_server:handler
      runtime: python:3.6
      volumes: []
  source: ''
  function_kind: serving
