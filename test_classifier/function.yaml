kind: job
metadata:
  name: test-classifier
  tag: ''
  hash: e41b41cc0dee62c79550be0593d661fe474c8173
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - test
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: test_classifier
  description: ''
  image_pull_policy: Always
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBpbXBvcnRsaWIKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgbG9hZAoKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKCmltcG9ydCBza2xlYXJuCmZyb20gc2tsZWFybiBpbXBvcnQgbWV0cmljcwpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgbGFiZWxfYmluYXJpemUKZnJvbSBza2xlYXJuLnV0aWxzLm11bHRpY2xhc3MgaW1wb3J0IHVuaXF1ZV9sYWJlbHMKCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKZnJvbSBtYXRwbG90bGliLmZpZ3VyZSBpbXBvcnQgRmlndXJlCmltcG9ydCBzZWFib3JuIGFzIHNucwoKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsLCBVbmlvbiwgTGlzdCwgVHVwbGUKCmZyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IFRhYmxlQXJ0aWZhY3QsIFBsb3RBcnRpZmFjdAoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgpkZWYgX2djZl9jbGVhcihwbHQpOgogICAgcGx0LmNsYSgpCiAgICBwbHQuY2xmKCkKICAgIHBsdC5jbG9zZSgpICAgICAgICAKCmRlZiB0ZXN0X2NsYXNzaWZpZXIoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsc19kaXI6IFVuaW9uW0RhdGFJdGVtLCBzdHJdLCAKICAgIHRlc3Rfc2V0OiBEYXRhSXRlbSwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgc2NvcmVfbWV0aG9kOiBzdHIgPSAnbWljcm8nLAogICAga2V5OiBzdHIgPSAiIiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIgopIC0+IE5vbmU6CiAgICAiIiJUZXN0IG9uZSBvciBtb3JlIGNsYXNzaWZpZXIgbW9kZWxzIGFnYWluc3QgaGVsZC1vdXQgZGF0YXNldAogICAgCiAgICBVc2luZyBoZWxkLW91dCB0ZXN0IGZlYXR1cmVzLCBldmFsdWF0ZXMgdGhlIHBlZm9ybWFuY2Ugb2YgdGhlIGVzdGltYXRlZCBtb2RlbAogICAgCiAgICBDYW4gYmUgcGFydCBvZiBhIGt1YmVmbG93IHBpcGVsaW5lIGFzIGEgdGVzdCBzdGVwIHRoYXQgaXMgcnVuIHBvc3QgRURBIGFuZCAKICAgIHRyYWluaW5nL3ZhbGlkYXRpb24gY3ljbGVzCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbW9kZWxzX2RpcjogICAgICBhcnRpZmFjdCBtb2RlbHMgcmVwcmVzZW50aW5nIGEgZm9sZGVyIG9yIGEgZm9sZGVyCiAgICA6cGFyYW0gdGVzdF9zZXQ6ICAgICAgICB0ZXN0IGZlYXR1cmVzIGFuZCBsYWJlbHMKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgIGNvbHVtbiBuYW1lIGZvciBncm91bmQgdHJ1dGggbGFiZWxzCiAgICA6cGFyYW0gc2NvcmVfbWV0aG9kOiAgICBmb3IgbXVsdGljbGFzcyBjbGFzc2lmaWNhdGlvbgogICAgOnBhcmFtIGtleTogICAgICAgICAgICAga2V5IGZvciByZXN1bHRzIGFydGlmYWN0IChtYXliZSBqdXN0IGEgZGlyIG9mIGFydGlmYWN0cyBmb3IgdGVzdCBsaWtlIHBsb3RzX2RpcikKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgIGRpciBmb3IgdGVzdCBwbG90cwogICAgIiIiCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBwbG90c19kaXIpLCBleGlzdF9vaz1UcnVlKQogICAgCiAgICB4dGVzdCA9IHBkLnJlYWRfcGFycXVldChzdHIodGVzdF9zZXQpKQogICAgeXRlc3QgPSB4dGVzdC5wb3AobGFiZWxfY29sdW1uKQogICAgCiAgICBjb250ZXh0LmhlYWRlciA9IGxpc3QoeHRlc3QuY29sdW1ucy52YWx1ZXMpCiAgICAKICAgIGRlZiBfZXZhbF9tb2RlbChtb2RlbCk6CiAgICAgICAgIyBlbmNsb3NlIGFsbCBleGNlcHQgbW9kZWwKICAgICAgICB5dGVzdGIgPSBsYWJlbF9iaW5hcml6ZSh5dGVzdCwgY2xhc3Nlcz1saXN0KHJhbmdlKHh0ZXN0LnNoYXBlWzFdKSkpCiAgICAgICAgcHJpbnQoeXRlc3QpCiAgICAgICAgcHJpbnQoeXRlc3RiKQogICAgICAgIGNsZiA9IGxvYWQob3Blbihvcy5wYXRoLmpvaW4oc3RyKG1vZGVsc19kaXIpLCBtb2RlbCksICJyYiIpKQogICAgICAgIGlmIGNhbGxhYmxlKGdldGF0dHIoY2xmLCAicHJlZGljdF9wcm9iYSIpKToKICAgICAgICAgICAgeV9zY29yZSA9IGNsZi5wcmVkaWN0X3Byb2JhKHh0ZXN0LnZhbHVlcykKICAgICAgICAgICAgeXByZWQgPSBjbGYucHJlZGljdCh4dGVzdC52YWx1ZXMpCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJ5X3Njb3JlLnNoYXBlIHt5X3Njb3JlLnNoYXBlfSIpCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJ5dGVzdGIuc2hhcGUge3l0ZXN0Yi5zaGFwZX0iKQogICAgICAgICAgICBwbG90X3JvYyhjb250ZXh0LCB5dGVzdGIsIHlfc2NvcmUsIGtleT1mInJvYyIsIHBsb3RzX2Rpcj1wbG90c19kaXIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeXByZWQgPSBjbGYucHJlZGljdCh4dGVzdC52YWx1ZXMpICMgcmVmYWN0b3IKICAgICAgICAgICAgeV9zY29yZSA9IE5vbmUKICAgICAgICBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoY29udGV4dCwgeXRlc3QsIHlwcmVkLCBrZXk9ImNvbmZ1c2lvbiIsIGZtdD0icG5nIikKICAgICAgICBpZiBoYXNhdHRyKGNsZiwgImZlYXR1cmVfaW1wb3J0YW5jZXNfIik6CiAgICAgICAgICAgIHByaW50KGNsZikKICAgICAgICAgICAgcGxvdF9pbXBvcnRhbmNlKGNvbnRleHQsIGNsZiwga2V5PWYiZmVhdGltcCIpCiAgICAgICAgYXZlcmFnZV9wcmVjaXNpb24gPSBtZXRyaWNzLmF2ZXJhZ2VfcHJlY2lzaW9uX3Njb3JlKHl0ZXN0YiwgeV9zY29yZSwgYXZlcmFnZT1zY29yZV9tZXRob2QpCiAgICAgICAgY29udGV4dC5sb2dfcmVzdWx0KGYiYWNjdXJhY3kiLCBmbG9hdChjbGYuc2NvcmUoeHRlc3QudmFsdWVzLCB5dGVzdC52YWx1ZXMpKSkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCBtZXRyaWNzLnJvY19hdWNfc2NvcmUoeXRlc3RiLCB5X3Njb3JlKSkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJmMV9zY29yZSIsIG1ldHJpY3MuZjFfc2NvcmUoeXRlc3QudmFsdWVzLCB5cHJlZCwgYXZlcmFnZT1zY29yZV9tZXRob2QpKQogICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdChmImF2Z19wcmVjc2NvcmUiLCBhdmVyYWdlX3ByZWNpc2lvbikKCiAgICAKICAgIGJlc3RfbW9kZWwgPSBOb25lCiAgICBmb3IgbW9kZWwgaW4gb3MubGlzdGRpcihzdHIobW9kZWxzX2RpcikpOgogICAgICAgIGlmIG1vZGVsLmVuZHN3aXRoKCcucGtsJyk6CiAgICAgICAgICAgIF9ldmFsX21vZGVsKG1vZGVsKQogICAgICAgICAgICAjIEhBQ0s6IHRoZXJlIGlzIG9ubHkgb25lIG1vZGVsIGhlcmUKICAgICAgICAgICAgYmVzdF9tb2RlbCA9IG1vZGVsCgogICAgIyBsb2cgJ2Jlc3QgbW9kZWwnIGFzIGFydGlmYWN0CiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgnVE9EQVlTLU1PREVMUy1URVNULVJFUE9SVCcsIGxvY2FsX3BhdGg9YmVzdF9tb2RlbCkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KCdERVBMT1knLCBib2R5PWIndHJ1ZScsIGxvY2FsX3BhdGg9J0RFUExPWScpCiAgICAKZGVmIHBsb3Rfcm9jKAogICAgY29udGV4dCwKICAgIHlfbGFiZWxzLAogICAgeV9wcm9icywKICAgIGtleT0icm9jIiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIiwKICAgIGZtdD0icG5nIiwKICAgIGZwcl9sYWJlbDogc3RyID0gImZhbHNlIHBvc2l0aXZlIHJhdGUiLAogICAgdHByX2xhYmVsOiBzdHIgPSAgInRydWUgcG9zaXRpdmUgcmF0ZSIsCiAgICB0aXRsZTogc3RyID0gInJvYyBjdXJ2ZSIsCiAgICBsZWdlbmRfbG9jOiBzdHIgPSAiYmVzdCIKKToKICAgICIiInBsb3Qgcm9jIGN1cnZlcwogICAgCiAgICBUT0RPOiAgYWRkIGF2ZXJhZ2luZyBtZXRob2QgKGFzIHN0cmluZykgdGhhdCB3YXMgdXNlZCB0byBjcmVhdGUgcHJvYnMsIAogICAgZGlzcGxheSBpbiBsZWdlbmQKICAgIAogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSB5X2xhYmVsczogICAgIGdyb3VuZCB0cnV0aCBsYWJlbHMsIGhvdCBlbmNvZGVkIGZvciBtdWx0aWNsYXNzICAKICAgIDpwYXJhbSB5X3Byb2JzOiAgICAgIG1vZGVsIHByZWRpY3Rpb24gcHJvYmFiaWxpdGllcwogICAgOnBhcmFtIGtleTogICAgICAgICAgKCJyb2MiKSBrZXkgb2YgcGxvdCBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIHBsb3RzX2RpcjogICAgKCJwbG90cyIpIGRlc3RpbmF0aW9uIGZvbGRlciByZWxhdGl2ZSBwYXRoIHRvIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBmbXQ6ICAgICAgICAgICgicG5nIikgcGxvdCBmb3JtYXQKICAgIDpwYXJhbSBmcHJfbGFiZWw6ICAgICgiZmFsc2UgcG9zaXRpdmUgcmF0ZSIpIHgtYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB0cHJfbGFiZWw6ICAgICgidHJ1ZSBwb3NpdGl2ZSByYXRlIikgeS1heGlzIGxhYmVscwogICAgOnBhcmFtIHRpdGxlOiAgICAgICAgKCJyb2MgY3VydmUiKSB0aXRsZSBvZiBwbG90CiAgICA6cGFyYW0gbGVnZW5kX2xvYzogICAoImJlc3QiKSBsb2NhdGlvbiBvZiBwbG90IGxlZ2VuZAogICAgIiIiCiAgICB5X2xhYmVscyA9IHlfbGFiZWxzWzosIDotMV0gIyBsYXN0IGNvbHVtbiByZWR1bmRhbnQgKGxhYmVsYmluYXJpemVyIGlzc3VlPykKICAgIGFzc2VydCB5X3Byb2JzLnNoYXBlID09IHlfbGFiZWxzLnNoYXBlCiAgICAKICAgICMgY2xlYXIgbWF0cGxvdGxpYiBjdXJyZW50IGZpZ3VyZQogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgICMgZGF0YSBhY2N1bW11bGF0b3JzIGJ5IGNsYXNzCiAgICBmcHIgPSBkaWN0KCkKICAgIHRwciA9IGRpY3QoKQogICAgcm9jX2F1YyA9IGRpY3QoKQogICAgCiAgICAjIGRyYXcgNDUgZGVncmVlIGxpbmUKICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAiay0tIikKICAgIAogICAgIyBsYWJlbGxpbmcKICAgIHBsdC54bGFiZWwoZnByX2xhYmVsKQogICAgcGx0LnlsYWJlbCh0cHJfbGFiZWwpCiAgICBwbHQudGl0bGUodGl0bGUpCiAgICBwbHQubGVnZW5kKGxvYz1sZWdlbmRfbG9jKQogICAgCiAgICAjIHNpbmdsZSBST0Mgb3IgbXV0bGlwbGUKICAgIGZvciBpIGluIHJhbmdlKHlfbGFiZWxzWzosOi0xXS5zaGFwZVsxXSk6CiAgICAgICAgZnByW2ldLCB0cHJbaV0sIF8gPSBtZXRyaWNzLnJvY19jdXJ2ZSh5X2xhYmVsc1s6LCBpXSwgeV9wcm9ic1s6LCBpXSwgcG9zX2xhYmVsPTEpCiAgICAgICAgcm9jX2F1Y1tpXSA9IG1ldHJpY3MuYXVjKGZwcltpXSwgdHByW2ldKQogICAgICAgIHBsdC5wbG90KGZwcltpXSwgdHByW2ldLCBsYWJlbD1mImNsYXNzIHtpfSIpCgogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9LntmbXR9IgogICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZm5hbWUpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1wbHQuZ2NmKCkpLCBsb2NhbF9wYXRoPWZuYW1lKQogICAgCgpkZWYgcGxvdF9jb25mdXNpb25fbWF0cml4KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBsYWJlbHMsCiAgICBwcmVkaWN0aW9ucywKICAgIGtleTogc3RyID0gImNvbmZ1c2lvbl9tYXRyaXgiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgY29sb3JtYXA6IHN0ciA9ICJCbHVlcyIsCiAgICBmbXQ6IHN0ciA9ICJwbmciLAogICAgc2FtcGxlX3dlaWdodD1Ob25lCik6CiAgICAiIiJDcmVhdGUgYSBjb25mdXNpb24gbWF0cml4LgogICAgUGxvdCBhbmQgc2F2ZSBhIGNvbmZ1c2lvbiBtYXRyaXggdXNpbmcgdGVzdCBkYXRhIGZyb20gYQogICAgbW9kZWxsaW5lIHN0ZXAuCiAgICAKICAgIFNlZSBodHRwczovL3NjaWtpdC1sZWFybi5vcmcvc3RhYmxlL21vZHVsZXMvZ2VuZXJhdGVkL3NrbGVhcm4ubWV0cmljcy5jb25mdXNpb25fbWF0cml4Lmh0bWwKICAgIAogICAgVE9ETzogZml4IGxhYmVsIGFsaWdubWVudAogICAgVE9ETzogY29uc2lkZXIgdXNpbmcgYW5vdGhlciBwYWNrYWdlZCB2ZXJzaW9uCiAgICBUT0RPOiByZWZhY3RvciB0byB0YWtlIHBhcmFtcyBkaWN0IGZvciBwbG90IG9wdGlvbnMKCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbGFiZWxzOiAgICAgICAgICB2YWxpZGF0aW9uIGRhdGEgZ3JvdW5kLXRydXRoIGxhYmVscwogICAgOnBhcmFtIHByZWRpY3Rpb25zOiAgICAgdmFsaWRhdGlvbiBkYXRhIHByZWRpY3Rpb25zCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICAgICBzdHIKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgIHJlbGF0aXZlIHBhdGggb2YgcGxvdHMgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBjb2xvcm1hcDogICAgICAgIGNvbG91cm1hcCBmb3IgY29uZnVzaW9uIG1hdHJpeAogICAgOnBhcmFtIGZtdDogICAgICAgICAgICAgcGxvdCBmb3JtYXQKICAgIDpwYXJhbSBzYW1wbGVfd2VpZ2h0OiAgIHNhbXBsZSB3ZWlnaHRzCiAgICAiIiIKICAgIF9nY2ZfY2xlYXIocGx0KQogICAgCiAgICBjbSA9IG1ldHJpY3MuY29uZnVzaW9uX21hdHJpeChsYWJlbHMsIHByZWRpY3Rpb25zLCBzYW1wbGVfd2VpZ2h0PU5vbmUpCiAgICBzbnMuaGVhdG1hcChjbSwgYW5ub3Q9VHJ1ZSwgY21hcD1jb2xvcm1hcCwgc3F1YXJlPVRydWUpCgogICAgZmlnID0gcGx0LmdjZigpCiAgICBmbmFtZSA9IGYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICBmaWcuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmbmFtZSkpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3Qoa2V5LCBib2R5PWZpZyksIGxvY2FsX3BhdGg9Zm5hbWUpCgpkZWYgcGxvdF9pbXBvcnRhbmNlKAogICAgY29udGV4dCwKICAgIG1vZGVsLAogICAga2V5OiBzdHIgPSAiZmVhdHVyZS1pbXBvcnRhbmNlcyIsCiAgICBmbXQgPSAicG5nIgopOgogICAgIiIiRGlzcGxheSBlc3RpbWF0ZWQgZmVhdHVyZSBpbXBvcnRhbmNlcy4KICAgIDpwYXJhbSBjb250ZXh0OiAgICAgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIG1vZGVsOiAgICAgICBmaXR0ZWQgbGlnaHRnYm0gbW9kZWwKICAgICIiIgogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgICMgY3JlYXRlIGEgZmVhdHVyZSBpbXBvcnRhbmNlIHRhYmxlIHdpdGggZGVzaXJlZCBsYWJlbHMKICAgIHppcHBlZCA9IHppcChtb2RlbC5mZWF0dXJlX2ltcG9ydGFuY2VzXywgY29udGV4dC5oZWFkZXIpCgogICAgZmVhdHVyZV9pbXAgPSBwZC5EYXRhRnJhbWUoc29ydGVkKHppcHBlZCksIGNvbHVtbnM9WyJmcmVxIiwiZmVhdHVyZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5zb3J0X3ZhbHVlcyhieT0iZnJlcSIsIGFzY2VuZGluZz1GYWxzZSkKCiAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDIwLCAxMCkpCiAgICBzbnMuYmFycGxvdCh4PSJmcmVxIiwgeT0iZmVhdHVyZSIsIGRhdGE9ZmVhdHVyZV9pbXApCiAgICBwbHQudGl0bGUoImZlYXR1cmVzIikKICAgIHBsdC50aWdodF9sYXlvdXQoKQoKICAgIGZpZyA9IHBsdC5nY2YoKQogICAgb3MubWFrZWRpcnMob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgInBsb3RzIiksIGV4aXN0X29rPVRydWUpCiAgICBmaWcuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmInBsb3RzL3trZXl9LntmbXR9IikpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoZiJ7a2V5fS57Zm10fSIsIGJvZHk9ZmlnKSwgbG9jYWxfcGF0aD1mInBsb3RzL3trZXl9LntmbXR9IikKCiAgICAjIGZlYXR1cmUgaW1wb3J0YW5jZXMgYXJlIGFsc28gc2F2ZWQgYXMgYSB0YWJsZToKICAgIGZlYXR1cmVfaW1wLnRvX2Nzdihvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBrZXkrIi5jc3YiKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KGtleSsiLmNzdiIsIGxvY2FsX3BhdGg9a2V5KyIuY3N2IikKCiAgICBfZ2NmX2NsZWFyKHBsdCkKCmRlZiBfcGxvdF9jb25mdXNpb25fbWF0cml4KHlfdHJ1ZSwgeV9wcmVkLCBjbGFzc2VzPVsibmVnIiwgInBvcyJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemU9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNtYXA9cGx0LmNtLkJsdWVzKToKICAgICIiIlRoaXMgY2FuIGJlIGRlcHJlY2F0ZWQgb25jZSBpbnRlbCBweXRob24gdXBncmFkZXMgc2Npa2l0LWxlYXJuIHRvID4wLjIyCiAgICAKICAgIFRoaXMgZnVuY3Rpb24gcHJpbnRzIGFuZCBwbG90cyB0aGUgY29uZnVzaW9uIG1hdHJpeC4KICAgIE5vcm1hbGl6YXRpb24gY2FuIGJlIGFwcGxpZWQgYnkgc2V0dGluZyBgbm9ybWFsaXplPVRydWVgLgogICAgCiAgICBodHRwczovL3NjaWtpdC1sZWFybi5vcmcvMC4yMS9hdXRvX2V4YW1wbGVzL21vZGVsX3NlbGVjdGlvbi9wbG90X2NvbmZ1c2lvbl9tYXRyaXguaHRtbCNzcGh4LWdsci1hdXRvLWV4YW1wbGVzLW1vZGVsLXNlbGVjdGlvbi1wbG90LWNvbmZ1c2lvbi1tYXRyaXgtcHkKICAgICIiIgogICAgaWYgbm90IHRpdGxlOgogICAgICAgIGlmIG5vcm1hbGl6ZToKICAgICAgICAgICAgdGl0bGUgPSAiTm9ybWFsaXplZCBjb25mdXNpb24gbWF0cml4IgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRpdGxlID0gIkNvbmZ1c2lvbiBtYXRyaXgsIHdpdGhvdXQgbm9ybWFsaXphdGlvbiIKCiAgICAjIENvbXB1dGUgY29uZnVzaW9uIG1hdHJpeAogICAgY20gPSBjb25mdXNpb25fbWF0cml4KHlfdHJ1ZSwgeV9wcmVkKQogICAgIyBPbmx5IHVzZSB0aGUgbGFiZWxzIHRoYXQgYXBwZWFyIGluIHRoZSBkYXRhCiAgICAjY2xhc3NlcyA9IGNsYXNzZXNbdW5pcXVlX2xhYmVscyh5X3RydWUsIHlfcHJlZCldCiAgICBpZiBub3JtYWxpemU6CiAgICAgICAgY20gPSBjbS5hc3R5cGUoImZsb2F0IikgLyBjbS5zdW0oYXhpcz0xKVs6LCBucC5uZXdheGlzXQoKICAgIGZpZywgYXggPSBwbHQuc3VicGxvdHMoKQogICAgaW0gPSBheC5pbXNob3coY20sIGludGVycG9sYXRpb249Im5lYXJlc3QiLCBjbWFwPWNtYXApCiAgICBheC5maWd1cmUuY29sb3JiYXIoaW0sIGF4PWF4KQogICAgIyBXZSB3YW50IHRvIHNob3cgYWxsIHRpY2tzLi4uCiAgICBheC5zZXQoeHRpY2tzPW5wLmFyYW5nZShjbS5zaGFwZVsxXSksCiAgICAgICAgICAgeXRpY2tzPW5wLmFyYW5nZShjbS5zaGFwZVswXSksCiAgICAgICAgICAgIyAuLi4gYW5kIGxhYmVsIHRoZW0gd2l0aCB0aGUgcmVzcGVjdGl2ZSBsaXN0IGVudHJpZXMKICAgICAgICAgICB4dGlja2xhYmVscz1jbGFzc2VzLCB5dGlja2xhYmVscz1jbGFzc2VzLAogICAgICAgICAgIHRpdGxlPXRpdGxlLAogICAgICAgICAgIHlsYWJlbD0iVHJ1ZSBsYWJlbCIsCiAgICAgICAgICAgeGxhYmVsPSJQcmVkaWN0ZWQgbGFiZWwiKQoKICAgICMgUm90YXRlIHRoZSB0aWNrIGxhYmVscyBhbmQgc2V0IHRoZWlyIGFsaWdubWVudC4KICAgIHBsdC5zZXRwKGF4LmdldF94dGlja2xhYmVscygpLCByb3RhdGlvbj00NSwgaGE9InJpZ2h0IiwKICAgICAgICAgICAgIHJvdGF0aW9uX21vZGU9ImFuY2hvciIpCgogICAgIyBMb29wIG92ZXIgZGF0YSBkaW1lbnNpb25zIGFuZCBjcmVhdGUgdGV4dCBhbm5vdGF0aW9ucy4KICAgIGZtdCA9ICIuMmYiIGlmIG5vcm1hbGl6ZSBlbHNlICJkIgogICAgdGhyZXNoID0gY20ubWF4KCkgLyAyLgogICAgZm9yIGkgaW4gcmFuZ2UoY20uc2hhcGVbMF0pOgogICAgICAgIGZvciBqIGluIHJhbmdlKGNtLnNoYXBlWzFdKToKICAgICAgICAgICAgYXgudGV4dChqLCBpLCBmb3JtYXQoY21baSwgal0sIGZtdCksCiAgICAgICAgICAgICAgICAgICAgaG9yaXpvbnRhbGFsaWdubWVudD0iY2VudGVyIiwKICAgICAgICAgICAgICAgICAgICBjb2xvcj0id2hpdGUiIGlmIGNtW2ksIGpdID4gdGhyZXNoIGVsc2UgImJsYWNrIikKICAgIGZpZy50aWdodF9sYXlvdXQoKQogICAgcmV0dXJuIGF4ICAgIA==
    commands: []
    code_origin: https://github.com/mlrun/functions.git#90dd42fcd544762b263200f5f93c36796bfceece:test_classifier/test_classifier.py
