kind: job
metadata:
  name: model-server-tester
  tag: ''
  hash: be0a875481e2b1e55fe1ab3ece4e177d7521f4f1
  project: ''
  labels:
    author: yaronh
  categories:
  - models
  - testing
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: model_server_tester
  description: test model servers
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTA0LTA2IDIzOjEwCgppbXBvcnQgb3MKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGpzb24KCmRlZiBtb2RlbF9zZXJ2ZXJfdGVzdGVyKGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogc3RyLAogICAgICAgICAgICAgICAgICAgICAgbGFiZWxfY29sdW1uOiBzdHIgPSAibGFiZWwiLAogICAgICAgICAgICAgICAgICAgICAgYWRkcj0nJywgCiAgICAgICAgICAgICAgICAgICAgICBtb2RlbD0nJywKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoX2Vycj1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHJvd3M9MTApOgogICAgIiIiIFRlc3QgYSBtb2RlbCBzZXJ2ZXIgIiIiCiAgICAKICAgIAogICAgdGFibGUgPSBzdHIodGFibGUpCiAgICBpZiB0YWJsZS5lbmRzd2l0aCgiLmNzdiIpOgogICAgICAgIHRhYmxlID0gcGQucmVhZF9jc3YodGFibGUpCiAgICBlbHNlOiAKICAgICAgICB0YWJsZSA9IHBkLnJlYWRfcGFycXVldCh0YWJsZSkKCiAgICB5X2xpc3QgPSB0YWJsZS5wb3AobGFiZWxfY29sdW1uKS52YWx1ZXMudG9saXN0KCkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZid0ZXN0aW5nIHdpdGggZGF0YXNldCBhZ2FpbnN0IHthZGRyfSwgbW9kZWw6IHttb2RlbH0nKQogICAgaWYgcm93czoKICAgICAgICB0YWJsZSA9IHRhYmxlLnNhbXBsZShyb3dzKQogICAgCiAgICBjb3VudCA9IGVycl9jb3VudCA9IG1hdGNoID0gMAogICAgZm9yIHgsIHkgaW4gemlwKHRhYmxlLnZhbHVlcywgeV9saXN0KToKICAgICAgICBjb3VudCArPSAxCiAgICAgICAgZXZlbnRfZGF0YSA9IGpzb24uZHVtcHMoeyJpbnN0YW5jZXMiOlt4LnRvbGlzdCgpXX0pCiAgICAgICAgaGFkX2VyciA9IEZhbHNlCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwID0gcmVxdWVzdHMucHV0KGYne2FkZHJ9L3ttb2RlbH0vcHJlZGljdCcsIGpzb249ZXZlbnRfZGF0YSkKICAgICAgICAgICAgaWYgbm90IHJlc3Aub2s6CiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcihmJ2JhZCBmdW5jdGlvbiByZXNwISFcbntyZXNwLnRleHR9JykKICAgICAgICAgICAgICAgIGVycl9jb3VudCArPSAxCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IE9TRXJyb3IgYXMgZXJyOgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcihmJ2Vycm9yIGluIHJlcXVlc3QsIGRhdGE6e2V2ZW50X2RhdGF9LCBlcnJvcjoge2Vycn0nKQogICAgICAgICAgICBlcnJfY291bnQgKz0gMQogICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICB5X3Jlc3AgPSByZXNwLmpzb24oKVswXQogICAgICAgIGlmIHkgPT0geV9yZXNwOgogICAgICAgICAgICBtYXRjaCArPSAxCiAgICAgICAgCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoJ3RvdGFsX3Rlc3RzJywgY291bnQpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoJ2Vycm9ycycsIGVycl9jb3VudCkKICAgIGNvbnRleHQubG9nX3Jlc3VsdCgnbWF0Y2gnLCBtYXRjaCkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidydW4ge2NvdW50fSB0ZXN0cywge2Vycl9jb3VudH0gZXJyb3JzIGFuZCB7bWF0Y2h9IG1hdGNoIGV4cGVjdGVkIHZhbHVlJykKICAgIAogICAgaWYgZXJyX2NvdW50OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZidmYWlsZWQgb24ge2Vycl9jb3VudH0gdGVzdHMgb2Yge2NvdW50fScpCiAgICAKICAgIGlmIG1hdGNoX2VyciBhbmQgbWF0Y2ggIT0gY291bnQ6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmJ29ubHkge21hdGNofSByZXN1bHRzIG1hdGNoIG91dCBvZiB7Y291bnR9JykKCg==
    commands: []
    code_origin: https://github.com/mlrun/demos.git#49b1a461bcc34436fb5d90640088ba1b5ddf6c2a:model_server_tester.ipynb
