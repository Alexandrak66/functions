kind: job
metadata:
  name: sklearn-classifier
  tag: ''
  hash: 8b4c40389c905dd56106e916a446450ac94c8564
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models:latest
  env: []
  default_handler: train_model
  description: ''
  image_pull_policy: Always
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gaW1wb3J0bGliIGltcG9ydCBpbXBvcnRfbW9kdWxlCmZyb20gaW5zcGVjdCBpbXBvcnQgZ2V0ZnVsbGFyZ3NwZWMsIEZ1bGxBcmdTcGVjCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAsIGxvYWQKaW1wb3J0IGl0ZXJ0b29scwoKaW1wb3J0IHNrbGVhcm4KZnJvbSBza2xlYXJuIGltcG9ydCBtZXRyaWNzCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHB5YXJyb3cgYXMgcGEKaW1wb3J0IHB5YXJyb3cucGFycXVldCBhcyBwcQppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgc2VhYm9ybiBhcyBzbnMKCmZyb20gc2tsZWFybi51dGlscy50ZXN0aW5nIGltcG9ydCBhbGxfZXN0aW1hdG9ycwpmcm9tIHNrbGVhcm4uZGF0YXNldHMgaW1wb3J0IG1ha2VfY2xhc3NpZmljYXRpb24KZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IGxhYmVsX2JpbmFyaXplCmZyb20gc2tsZWFybi5tb2RlbF9zZWxlY3Rpb24gaW1wb3J0IHRyYWluX3Rlc3Rfc3BsaXQKZnJvbSBza2xlYXJuIGltcG9ydCBtZXRyaWNzCgpmcm9tIHR5cGluZyBpbXBvcnQgVW5pb24sIExpc3QsIEFueSwgT3B0aW9uYWwKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0Cgpza3ZlcnNpb24gPSBza2xlYXJuLl9fdmVyc2lvbl9fCgppbXBvcnQgd2FybmluZ3MKCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgoKZGVmIF9nY2ZfY2xlYXIocGx0KToKICAgICIiIlV0aWxpdHkgdG8gY2xlYXIgbWF0cGxvdGxpYiBmaWd1cmUKCiAgICBSdW4gdGhpcyBpbnNpZGUgZXZlcnkgcGxvdCBtZXRob2QgYmVmb3JlIGNhbGxpbmcgYW55IG1hdHBsb3RsaWIKICAgIG1ldGhvZHMKCiAgICA6cGFyYW0gcGxvdDogICAgbWF0bG9ibGliIGZpZ3VyZSBvYmplY3QKICAgICIiIgogICAgcGx0LmNsYSgpCiAgICBwbHQuY2xmKCkKICAgIHBsdC5jbG9zZSgpCgoKZGVmIF9jcmVhdGVfY2xhc3MocGtnX2NsYXNzOiBzdHIpOgogICAgIiIiQ3JlYXRlIGEgY2xhc3MgZnJvbSBhIHBhY2thZ2UubW9kdWxlLmNsYXNzIHN0cmluZwoKICAgIDpwYXJhbSBwa2dfY2xhc3M6ICBmdWxsIGNsYXNzIGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgIGUuZy4gInNrbGVhcm4ubW9kZWxfc2VsZWN0aW9uLkdyb3VwS0ZvbGQiCiAgICAiIiIKICAgIHNwbGl0cyA9IHBrZ19jbGFzcy5zcGxpdCgiLiIpCiAgICBjbGZjbGFzcyA9IHNwbGl0c1stMV0KICAgIHBrZ19tb2R1bGUgPSBzcGxpdHNbOi0xXQogICAgY2xhc3NfID0gZ2V0YXR0cihpbXBvcnRfbW9kdWxlKCIuIi5qb2luKHBrZ19tb2R1bGUpKSwgY2xmY2xhc3MpCiAgICByZXR1cm4gY2xhc3NfCgpkZWYgX2NyZWF0ZV9mdW5jdGlvbihwa2dfZnVuYzogbGlzdCk6CiAgICAiIiJDcmVhdGUgYSBmdW5jdGlvbiBmcm9tIGEgcGFja2FnZS5tb2R1bGUuZnVuY3Rpb24gc3RyaW5nCgogICAgOnBhcmFtIHBrZ19mdW5jOiAgZnVsbCBmdW5jdGlvbiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGUuZy4gInNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24uZl9jbGFzc2lmIgogICAgIiIiCiAgICBzcGxpdHMgPSBwa2dfZnVuYy5zcGxpdCgiLiIpCiAgICBwa2dfbW9kdWxlID0gIi4iLmpvaW4oc3BsaXRzWzotMV0pCiAgICBjYl9mbmFtZSA9IHNwbGl0c1stMV0KICAgIHBrZ19tb2R1bGUgPSBfX2ltcG9ydF9fKHBrZ19tb2R1bGUsIGZyb21saXN0PVtjYl9mbmFtZV0pCiAgICBmdW5jdGlvbl8gPSBnZXRhdHRyKHBrZ19tb2R1bGUsIGNiX2ZuYW1lKQogICAgcmV0dXJuIGZ1bmN0aW9uXwoKZGVmIGdldF9tb2RlbF9jb25maWdzKAogICAgbXlfbW9kZWxzOiBVbmlvbltzdHIsIExpc3Rbc3RyXV0sCiAgICBjbGFzc19rZXkgPSAiQ0xBU1MiLAogICAgZml0X2tleSA9ICJGSVQiLAogICAgbWV0YV9rZXkgPSAiTUVUQSIsCikgLT4gVW5pb25bZGljdCwgTGlzdFtkaWN0XV06CiAgICAiIiJidWlsZCBza2xlYXJuIG1vZGVsIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycwogICAgCiAgICBUYWtlIChmdWxsKSBjbGFzcyBuYW1lIG9mIGFuIHNjaWtpdC1sZWFybiBtb2RlbCAKICAgIGFuZCByZXRyaWV2ZSBpdHMgYGNsYXNzYCBhbmQgYGZpdGAgcGFyYW1ldGVycyBhbmQKICAgIHRoZWlyIGRlZmF1bHQgdmFsdWVzLgogICAgCiAgICBBbHNvIHJldHVybnMgc29tZSB1c2VmdWwgbWV0YWRhdGEgdmFsdWVzIGZvciB0aGUgY2xhc3MKICAgICIiIgogICAgIyBnZXQgYSBsaXN0IG9mIGFsbCBza2xlYXJuIGVzdGltYXRvcnMKICAgIGVzdGltYXRvcnMgPSBhbGxfZXN0aW1hdG9ycygpCiAgICBkZWYgX2dldF9lc3RpbWF0b3IocGtnX2NsYXNzKToKICAgICAgICAiIiJmaW5kIGEgc3BlY2lmaWMgY2xhc3MgaW4gYSBsaXN0IG9mIHNrbGVhcm4gZXN0aW1hdG9ycyIiIgogICAgICAgIG15X2NsYXNzID0gcGtnX2NsYXNzLnNwbGl0KCIuIilbLTFdCiAgICAgICAgcmV0dXJuIGxpc3QoZmlsdGVyKGxhbWJkYSB4OiB4WzBdID09IG15X2NsYXNzLCBlc3RpbWF0b3JzKSlbMF0KCiAgICAjIGZpbmQgZXN0aW1hdG9ycyBjb3JyZXNwb25kaW5nIHRvIG15X21vZGVscyBsaXN0CiAgICBteV9lc3RpbWF0b3JzID0gW10KICAgIG15X21vZGVscyA9IFtteV9tb2RlbHNdIGlmIGlzaW5zdGFuY2UobXlfbW9kZWxzLCBzdHIpIGVsc2UgbXlfbW9kZWxzCiAgICBmb3IgbW9kZWwgaW4gbXlfbW9kZWxzOgogICAgICAgIGVzdGltYXRvcl9uYW1lLCBlc3RpbWF0b3JfY2xhc3MgPSBfZ2V0X2VzdGltYXRvcihtb2RlbCkKICAgICAgICBteV9lc3RpbWF0b3JzLmFwcGVuZCgoZXN0aW1hdG9yX25hbWUsIGVzdGltYXRvcl9jbGFzcykpCgogICAgIyBnZXQgY2xhc3MgYW5kIGZpdCBzcGVjcwogICAgZXN0aW1hdG9yX3NwZWNzID0gW10KICAgIGZvciBhbl9lc3RpbWF0b3IgaW4gbXlfZXN0aW1hdG9yczoKICAgICAgICBlc3RpbWF0b3Jfc3BlY3MuYXBwZW5kKChhbl9lc3RpbWF0b3JbMF0sICMgbW9kZWwgb25seSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0ZnVsbGFyZ3NwZWMoYW5fZXN0aW1hdG9yWzFdKSwgIyBjbGFzcyBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRmdWxsYXJnc3BlYyhhbl9lc3RpbWF0b3JbMV0uZml0KSwgIyBmaXQgcGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5fZXN0aW1hdG9yWzFdKSkgIyBwYWNrYWdlLm1vZHVsZS5tb2RlbAoKICAgIG1vZGVsX2NvbmZpZ3MgPSBbXQoKICAgIGZvciBlc3RpbWF0b3IgaW4gZXN0aW1hdG9yX3NwZWNzOgogICAgICAgIG1vZGVsX2pzb24gPSB7Y2xhc3Nfa2V5OiB7fSwgZml0X2tleToge319CiAgICAgICAgZml0X3BhcmFtcyA9IHt9CgogICAgICAgIGZvciBpLCBrZXkgaW4gZW51bWVyYXRlKG1vZGVsX2pzb24ua2V5cygpKToKICAgICAgICAgICAgZiA9IGVzdGltYXRvcltpKzFdCiAgICAgICAgICAgIGFyZ3NfcGFpcmVkID0gW10KICAgICAgICAgICAgZGVmc19wYWlyZWQgPSBbXQoKICAgICAgICAgICAgIyByZXZlcnNlIHRoZSBhcmdzIHNpbmNlIHRoZXJlIGFyZSBmZXdlciBkZWZhdWx0cyB0aGFuIGFyZ3MKICAgICAgICAgICAgYXJncyA9IGYuYXJncwogICAgICAgICAgICBhcmdzLnJldmVyc2UoKQogICAgICAgICAgICBuX2FyZ3MgPSBsZW4oYXJncykKCiAgICAgICAgICAgIGRlZnMgPSBmLmRlZmF1bHRzCiAgICAgICAgICAgIGlmIGRlZnMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGRlZnMgPSBbZGVmc10KICAgICAgICAgICAgZGVmcyA9IGxpc3QoZGVmcykKICAgICAgICAgICAgZGVmcy5yZXZlcnNlKCkKICAgICAgICAgICAgbl9kZWZzID0gbGVuKGRlZnMpCgogICAgICAgICAgICBuX3NtYWxsZXN0ID0gbWluKG5fYXJncywgbl9kZWZzKQogICAgICAgICAgICBuX2xhcmdlc3QgPSBtYXgobl9hcmdzLCBuX2RlZnMpCgogICAgICAgICAgICAjIGJ1aWxkIDIgbGlzdHMgdGhhdCBjYW4gYmUgY29uY2F0ZW5hdGVkCiAgICAgICAgICAgIGZvciBpeCBpbiByYW5nZShuX3NtYWxsZXN0KToKICAgICAgICAgICAgICAgIGlmIGFyZ3NbaXhdIGlzIG5vdCAic2VsZiI6CiAgICAgICAgICAgICAgICAgICAgYXJnc19wYWlyZWQuYXBwZW5kKGFyZ3NbaXhdKQogICAgICAgICAgICAgICAgICAgIGRlZnNfcGFpcmVkLmFwcGVuZChkZWZzW2l4XSkKCiAgICAgICAgICAgIGZvciBpeCBpbiByYW5nZShuX3NtYWxsZXN0LCBuX2xhcmdlc3QpOgogICAgICAgICAgICAgICAgaWYgaXggaXMgbm90IDAgYW5kIGFyZ3NbaXhdIGlzIG5vdCAic2VsZiI6CiAgICAgICAgICAgICAgICAgICAgYXJnc19wYWlyZWQuYXBwZW5kKGFyZ3NbaXhdKQogICAgICAgICAgICAgICAgICAgIGRlZnNfcGFpcmVkLmFwcGVuZChOb25lKQogICAgICAgICAgICAgICAjIGNvbmNhdGVuYXRlIGxpc3RzIGludG8gYXBwcm9wcmlhdGUgc3RydWN0dXJlCiAgICAgICAgICAgIG1vZGVsX2pzb25ba2V5XSA9IGRpY3QoemlwKHJldmVyc2VkKGFyZ3NfcGFpcmVkKSwgcmV2ZXJzZWQoZGVmc19wYWlyZWQpKSkKCiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV0gPSB7fQogICAgICAgIG1vZGVsX2pzb25bbWV0YV9rZXldWyJza2xlYXJuX3ZlcnNpb24iXSA9IHNrdmVyc2lvbgogICAgICAgIG1vZGVsX2pzb25bbWV0YV9rZXldWyJjbGFzcyJdID0gIi4iLmpvaW4oW2VzdGltYXRvclszXS5fX21vZHVsZV9fLCBlc3RpbWF0b3JbMF1dKQogICAgICAgIG1vZGVsX2NvbmZpZ3MuYXBwZW5kKG1vZGVsX2pzb24pCiAgICBpZiBsZW4obW9kZWxfY29uZmlncykgPT0gMToKICAgICAgICAjIGRvIHdlIHdhbnQgdG8gbG9nIHRoaXMgbW9kaWZpZWQgbW9kZWwgYXMgYW4gYXJ0aWZhY3Q/CiAgICAgICAgcmV0dXJuIG1vZGVsX2NvbmZpZ3NbMF0KICAgIGVsc2U6CiAgICAgICAgIyBkbyB3ZSB3YW50IHRvIGxvZyB0aGlzIG1vZGlmaWVkIG1vZGVsIGFzIGFuIGFydGlmYWN0PwogICAgICAgIHJldHVybiBtb2RlbF9jb25maWdzCgpkZWYgdXBkYXRlX21vZGVsX2NvbmZpZygKICAgIGNvbmZpZzogZGljdCwKICAgIG5ld19jbGFzczogZGljdCwKICAgIG5ld19maXQ6IGRpY3QsCiAgICBjbGFzc19rZXk6IHN0ciA9ICJDTEFTUyIsCiAgICBmaXRfa2V5OiBzdHIgPSAiRklUIgopOgogICAgIiIiVXBkYXRlIG1vZGVsIGNvbmZpZyBqc29uCiAgICAKICAgIE5vdCB1c2VkIHVudGlsIHdlIHJlZmFjdG9yIGFzIHBlciB0aGUgVE9ETwogICAgICAgIAogICAgVGhpcyBmdW5jdGlvbiBpcyBlc3NlbnRpYWwgc2luY2UgdGhlcmUgYXJlIG1vZGlmaWNhdGlvbnMgaW4gY2xhc3MKICAgIGFuZCBmaXQgcGFyYW1zIHRoYXQgbXVzdCBiZSBtYWRlIChjYWxsYmFja3MgYXJlIGEgZ29vZCBleGFtcGxlLCB3aXRob3V0CiAgICB3aGljaCB0aGVyZSBpcyBubyB0cmFpbmluZyBoaXN0b3J5IGF2YWlsYWJsZSkKICAgIAogICAgVE9ETzogIGN1cnJlbnRseSBhIG1vZGVsIGNvbmZpZyBjb250YWlucyAyIGtleXMsIGJ1dCB0aGlzIHdpbGwgbGlrZWx5CiAgICBleHBhbmQgdG8gaW5jbHVkZSBvdGhlciBmdW5jdGlvbnMgYmV5b25kIGNsYXNzIGFuZCBmaXQuIFNvIG5lZWQgdG8gZXhwYW5kIAogICAgdGhpcyB0byBhIGxpc3Qgb2YgVHVwbGUoc3RyLCBkaWN0KSwgd2hlcmUgYHN0cmAgY29ycmVzcG9uZHMgdG8gYSBrZXkKICAgIGluIHRoZSBtb2RlbCBjb25maWcgYW5kIGBkaWN0YCBjb250YWlucyB0aGUgcGFyYW1zIGFuZCB0aGVpciBuZXcgdmFsdWVzLgogICAgCiAgICA6cGFyYW0gY29uZmlnOiAgICAgIG9yaWdpbmFsIG1vZGVsIGRlZmluaXRpb24gY29udGFpbmluZyAyIGtleXMsIENMQVNTIGFuZCBGSVQKICAgIDpwYXJhbSBuZXdfY2xhc3M6ICAgbmV3IGNsYXNzIGtleS12YWx1ZXMKICAgIDpwYXJhbSBuZXdfZml0OiAgICAgbmV3IGZpdCBrZXktdmFsdWVzCiAgICAiIiIKICAgIGNvbmZpZ1tjbGFzc19rZXldLnVwZGF0ZShuZXdfY2xhc3MpCiAgICBjb25maWdbZml0X2tleV0udXBkYXRlKG5ld19maXQpCiAgICAKICAgIHJldHVybiBjb25maWcKCmRlZiB0cmFpbl9tb2RlbCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbW9kZWxfcGtnX2NsYXNzOiBzdHIsCiAgICBkYXRhX2tleTogVW5pb25bRGF0YUl0ZW0sIHN0cl0sCiAgICBzYW1wbGU6IGludCwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgbW9kZWxfa2V5OiBzdHIgPSAibW9kZWwiLAogICAgdGVzdF9zaXplOiBmbG9hdCA9IDAuMDUsCiAgICB0cmFpbl92YWxfc3BsaXQ6IGZsb2F0ID0gMC43NSwKICAgIHRlc3Rfc2V0X2tleTogc3RyID0gInRlc3Rfc2V0IiwKICAgIHJuZzogaW50ID0gMSwKICAgIG1vZGVsc19kaXI6IHN0ciA9ICJtb2RlbHMiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgc2NvcmVfbWV0aG9kOiBzdHIgPSAibWljcm8iLAogICAgY2xhc3NfcGFyYW1zX3VwZGF0ZXM6IFVuaW9uW0RhdGFJdGVtLCBkaWN0XSA9IHt9LAogICAgZml0X3BhcmFtc191cGRhdGVzOiBVbmlvbltEYXRhSXRlbSwgZGljdF0gPSB7fSwKKSAtPiBOb25lOgogICAgIiIidHJhaW4gYSBjbGFzc2lmaWVyLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBtb2RlbF9wa2dfY2xhc3M6ICAgdGhlIG1vZGVsIHRvIHRyYWluLCBlLmcsICJza2xlYXJuLm5ldXJhbF9uZXR3b3Jrcy5NTFBDbGFzc2lmaWVyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGpzb24gbW9kZWwgY29uZmlnCiAgICA6cGFyYW0gZGF0YV9rZXk6ICAgICAgICAgICgicmF3IikgbmFtZSBvZiByYXcgZGF0YSBmaWxlCiAgICA6cGFyYW0gc2FtcGxlOiAgICAgICAgICAgIFNlbGVjdHMgdGhlIGZpcnN0IG4gcm93cywgb3Igc2VsZWN0IGEgc2FtcGxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0aW5nIGZyb20gdGhlIGZpcnN0LiBJZiBuZWdhdGl2ZSA8LTEsIHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHJhbmRvbSBzYW1wbGUKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgZ3JvdW5kLXRydXRoICh5KSBsYWJlbHMKICAgIDpwYXJhbSBtb2RlbF9rZXk6ICAgICAgICAgKCJtb2RlbCIpIG5hbWUgb2YgbW9kZWwgaW4gYXJ0aWZhY3Qgc3RvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyB0byBhIGRpcmVjdG9yeQogICAgOnBhcmFtIHRlc3Rfc2l6ZTogICAgICAgICAoMC4wNSkgdGVzdCBzZXQgc2l6ZQogICAgOnBhcmFtIHRyYWluX3ZhbF9zcGxpdDogICAoMC43NSkgT25jZSB0aGUgdGVzdCBzZXQgaGFzIGJlZW4gcmVtb3ZlZCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5pbmcgc2V0IGdldHMgdGhpcyBwcm9wb3J0aW9uLgogICAgOnBhcmFtIHRlc3Rfc2V0X2tleTogICAgICBzdG9yZSB0aGUgdGVzdCBkYXRhIHNldCB1bmRlciB0aGlzIGtleSBpbiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBybmc6ICAgICAgICAgICAgICAgKDEpIHNrbGVhcm4gcm5nIHNlZWQKICAgIDpwYXJhbSBtb2RlbHNfZGlyOiAgICAgICAgbW9kZWxzIHN1YmZvbGRlciBvbiBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICAgIHBsb3Qgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBzY29yZV9tZXRob2Q6ICAgICAgZm9yIG11bHRpY2xhc3MgY2xhc3NpZmljYXRpb24KICAgIDpwYXJhbSBjbGFzc191cGRhdGVzOiAgICAgdXBkYXRlIHRoZXNlIHNjaWtpdC1sZWFybiBjbGFzc2lmaWVyIHBhcmFtcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgYXMgYSBkaWN0CiAgICA6cGFyYW0gZml0X3VwZGF0ZXM6ICAgICAgIHVwZGF0ZSBzY2lraXQtbGVhcm4gZml0IHBhcmFtZXRlcnMsIGlucHV0IGFzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgZGljdC4KICAgICIiIgogICAgYmFzZV9wYXRoID0gY29udGV4dC5hcnRpZmFjdF9wYXRoCiAgICBvcy5tYWtlZGlycyhiYXNlX3BhdGgsIGV4aXN0X29rPVRydWUpCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBwbG90c19kaXIpLCBleGlzdF9vaz1UcnVlKQogICAgb3MubWFrZWRpcnMob3MucGF0aC5qb2luKGJhc2VfcGF0aCwgbW9kZWxzX2RpciksIGV4aXN0X29rPVRydWUpCiAgICAKICAgICMgZXh0cmFjdCBmaWxlIG5hbWUgZnJvbSBEYXRhSXRlbQogICAgc3JjZmlsZXBhdGggPSBzdHIoZGF0YV9rZXkpCiAgICAKICAgICMgVE9ETzogdGhpcyBzaG91bGQgYmUgcGFydCBvZiBkYXRhInMgbWV0YWRhdGEgZGVhbHQgd2l0aCBpbiBhbm90aGVyIHN0ZXAgZ2V0IGEgZGF0YSBzZXQsIHNhbXBsZSwgZXRjLi4uCiAgICAjIGdldCBhbGwgZGF0YSBvciBhIHNhbXBsZQogICAgaWYgKHNhbXBsZSA9PSAtMSkgb3IgKHNhbXBsZSA+PSAxKToKICAgICAgICAjIGdldCBhbGwgcm93cywgb3IgY29udGlndW91cyBzYW1wbGUgc3RhcnRpbmcgYXQgcm93IDEuCiAgICAgICAgcmF3ID0gcHEucmVhZF90YWJsZShzcmNmaWxlcGF0aCkudG9fcGFuZGFzKCkuZHJvcG5hKCkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKICAgICAgICByYXcgPSByYXcuaWxvY1s6c2FtcGxlLCA6XQogICAgICAgIGxhYmVscyA9IGxhYmVscy5pbG9jWzpzYW1wbGVdCiAgICBlbHNlOgogICAgICAgICMgZ3JhYiBhIHJhbmRvbSBzYW1wbGUKICAgICAgICByYXcgPSBwcS5yZWFkX3RhYmxlKHNyY2ZpbGVwYXRoKS50b19wYW5kYXMoKS5kcm9wbmEoKS5zYW1wbGUoc2FtcGxlICogLTEpCiAgICAgICAgbGFiZWxzID0gcmF3LnBvcChsYWJlbF9jb2x1bW4pCgogICAgIyBUT0RPOiB0aGlzIHNob3VsZCBiZSBwYXJ0IG9mIGRhdGEicyBtZXRhZGF0YSBkZWFsdCB3aXRoIGluIGFub3RoZXIgc3RlcAogICAgY29udGV4dC5oZWFkZXIgPSByYXcuY29sdW1ucy52YWx1ZXMKICAgIAogICAgIyBUT0RPOiBhbGwgb2YgdGhpcyBzaG91bGQgYmUgcGFydCBvZiBhIHNwaXR0ZXIgY29tcG9uZW50IHRoYXQgZG9lcyBjdiB0b28sIGRlYWx0IHdpdGggaW4gYW5vdGhlciBzdGVwCiAgICAjIG1ha2UgYSBob3QgZW5jb2RlIGNvcHkgb2YgbGFiZWxzIGJlZm9yZSB0aGUgc3BsaXQKICAgIHliID0gbGFiZWxfYmluYXJpemUobGFiZWxzLCBjbGFzc2VzPWxhYmVscy51bmlxdWUoKSkKICAgICMgZG91YmxlIHNwbGl0IHRvIGdlbmVyYXRlIDMgZGF0YSBzZXRzOiB0cmFpbiwgdmFsaWRhdGlvbiBhbmQgdGVzdAogICAgIyB3aXRoIHh0ZXN0LHl0ZXN0IHNldCBhc2lkZQogICAgeCwgeHRlc3QsIHksIHl0ZXN0ID0gdHJhaW5fdGVzdF9zcGxpdChucC5jb25jYXRlbmF0ZShbcmF3LCB5Yl0sIGF4aXM9MSksIGxhYmVscywgdGVzdF9zaXplPXRlc3Rfc2l6ZSwgcmFuZG9tX3N0YXRlPXJuZykKICAgIHh0cmFpbiwgeHZhbGlkLCB5dHJhaW4sIHl2YWxpZCA9IHRyYWluX3Rlc3Rfc3BsaXQoeCwgeSwgdHJhaW5fc2l6ZT10cmFpbl92YWxfc3BsaXQsIHJhbmRvbV9zdGF0ZT1ybmcpCiAgICAjIGV4dHJhY3QgdGhlIGhvdF9lbmNvZGVkIGxhYmVscwogICAgeXRyYWluYiA9IHh0cmFpbls6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh0cmFpbiA9IHh0cmFpbls6LCA6LXliLnNoYXBlWzFdXS5jb3B5KCkKICAgICMgZXh0cmFjdCB0aGUgaG90X2VuY29kZWQgbGFiZWxzCiAgICB5dmFsaWRiID0geHZhbGlkWzosIC15Yi5zaGFwZVsxXTpdLmNvcHkoKQogICAgeHZhbGlkID0geHZhbGlkWzosIDoteWIuc2hhcGVbMV1dLmNvcHkoKQogICAgIyBleHRyYWN0IHRoZSBob3RfZW5jb2RlZCBsYWJlbHMKICAgIHl0ZXN0YiA9IHh0ZXN0WzosIC15Yi5zaGFwZVsxXTpdLmNvcHkoKQogICAgeHRlc3QgPSB4dGVzdFs6LCA6LXliLnNoYXBlWzFdXS5jb3B5KCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgIyBzZXQtYXNpZGUgdGVzdF9zZXQKICAgIHRlc3Rfc2V0ID0gcGQuY29uY2F0KAogICAgICAgIFtwZC5EYXRhRnJhbWUoZGF0YT14dGVzdCwgY29sdW1ucz1jb250ZXh0LmhlYWRlciksCiAgICAgICAgIHBkLkRhdGFGcmFtZShkYXRhPXl0ZXN0LnZhbHVlcywgY29sdW1ucz1bbGFiZWxfY29sdW1uXSldLAogICAgICAgIGF4aXM9MSwpCiAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIHRlc3Rfc2V0X2tleSArICIucHF0IikKICAgIHRlc3Rfc2V0LnRvX3BhcnF1ZXQoZmlsZXBhdGgsIGluZGV4PUZhbHNlKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QodGVzdF9zZXRfa2V5LCBsb2NhbF9wYXRoPXRlc3Rfc2V0X2tleSArICIucHF0IikKCiAgICBpZiBtb2RlbF9wa2dfY2xhc3MuZW5kc3dpdGgoIi5qc29uIik6CiAgICAgICAgbW9kZWxfY29uZmlnID0ganNvbi5sb2FkKG9wZW4obW9kZWxfcGtnX2NsYXNzLCAiciIpKQogICAgZWxzZToKICAgICAgICAjIGxvYWQgdGhlIG1vZGVsIGNvbmZpZwogICAgICAgIG1vZGVsX2NvbmZpZyA9IGdldF9tb2RlbF9jb25maWdzKG1vZGVsX3BrZ19jbGFzcykKCiAgICAjIGdldCB1cGRhdGUgcGFyYW1zIGlmIGFueQogICAgaWYgaXNpbnN0YW5jZShjbGFzc19wYXJhbXNfdXBkYXRlcywgRGF0YUl0ZW0pOgogICAgICAgIGNsYXNzX3BhcmFtc191cGRhdGVzID0ganNvbi5sb2FkcyhjbGFzc19wYXJhbXNfdXBkYXRlcy5nZXQoKSkKICAgIGlmIGlzaW5zdGFuY2UoZml0X3BhcmFtc191cGRhdGVzLCBEYXRhSXRlbSk6CiAgICAgICAgZml0X3BhcmFtc191cGRhdGVzID0ganNvbi5sb2FkcyhmaXRfcGFyYW1zX3VwZGF0ZXMuZ2V0KCkpCiAgICAjIHVwZGF0ZSB0aGUgcGFyYW1ldGVycyAgICAgICAgICAgIAogICAgIyBhZGQgZGF0YSB0byBmaXQgcGFyYW1zCiAgICBmaXRfcGFyYW1zX3VwZGF0ZXMudXBkYXRlKHsiWCI6IHh0cmFpbiwieSI6IHl0cmFpbi52YWx1ZXN9KQogICAgCiAgICBtb2RlbF9jb25maWdbIkNMQVNTIl0udXBkYXRlKGNsYXNzX3BhcmFtc191cGRhdGVzKQogICAgbW9kZWxfY29uZmlnWyJGSVQiXS51cGRhdGUoZml0X3BhcmFtc191cGRhdGVzKQogICAgCiAgICAjIGNyZWF0ZSBjbGFzcyBhbmQgZml0CiAgICBDbGFzc2lmaWVyQ2xhc3MgPSBfY3JlYXRlX2NsYXNzKG1vZGVsX2NvbmZpZ1siTUVUQSJdWyJjbGFzcyJdKQogICAgbW9kZWwgPSBDbGFzc2lmaWVyQ2xhc3MoKiptb2RlbF9jb25maWdbIkNMQVNTIl0pCiAgICBtb2RlbC5maXQoKiptb2RlbF9jb25maWdbIkZJVCJdKQoKICAgICMgc2F2ZSBtb2RlbAogICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBmInttb2RlbHNfZGlyfS97bW9kZWxfa2V5fS5wa2wiKQogICAgdHJ5OgogICAgICAgIGR1bXAobW9kZWwsIG9wZW4oZmlsZXBhdGgsICJ3YiIpKQogICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KG1vZGVsX2tleSwgbG9jYWxfcGF0aD1tb2RlbHNfZGlyKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KCJTRVJJQUxJWkUgTU9ERUwgRVJST1I6Iiwgc3RyKGUpKQoKICAgICMgY29tcHV0ZSB2YWxpZGF0aW9uIG1ldHJpY3MKICAgIHlwcmVkID0gbW9kZWwucHJlZGljdCh4dmFsaWQpCiAgICB5X3Njb3JlID0gbW9kZWwucHJlZGljdF9wcm9iYSh4dmFsaWQpCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYieV9zY29yZS5zaGFwZSB7eV9zY29yZS5zaGFwZX0iKQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmInl2YWxpZGIuc2hhcGUge3l2YWxpZGIuc2hhcGV9IikKICAgIGlmIHl2YWxpZGIuc2hhcGVbMV0gPiAxOgogICAgICAgICMgbGFiZWwgZW5jb2Rpbmcgd2FzIGFwcGxpZWQ6CiAgICAgICAgYXZlcmFnZV9wcmVjaXNpb24gPSBtZXRyaWNzLmF2ZXJhZ2VfcHJlY2lzaW9uX3Njb3JlKHl2YWxpZGJbOiw6LTFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5X3Njb3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCBtZXRyaWNzLnJvY19hdWNfc2NvcmUoeXZhbGlkYiwgeV9zY29yZSkpCiAgICBlbHNlOgogICAgICAgIGF2ZXJhZ2VfcHJlY2lzaW9uID0gbWV0cmljcy5hdmVyYWdlX3ByZWNpc2lvbl9zY29yZSh5dmFsaWRiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5X3Njb3JlWzosIDFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCBtZXRyaWNzLnJvY19hdWNfc2NvcmUoeXZhbGlkYiwgeV9zY29yZVs6LCAxXSkpCiAgICAgICAgCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhdmdfcHJlY3Njb3JlIiwgYXZlcmFnZV9wcmVjaXNpb24pCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhY2N1cmFjeSIsIGZsb2F0KG1vZGVsLnNjb3JlKHh2YWxpZCwgeXZhbGlkKSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJmMV9zY29yZSIsIG1ldHJpY3MuZjFfc2NvcmUoeXZhbGlkLCB5cHJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZT1zY29yZV9tZXRob2QpKQogICAgCgogICAgIyB2YWxpZGF0aW9uIHBsb3RzCiAgICAKICAgIHBsb3Rfcm9jKGNvbnRleHQsIHl2YWxpZGIsIHlfc2NvcmUpCiAgICBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoY29udGV4dCwgeXZhbGlkLCB5cHJlZCwga2V5PSJjb25mdXNpb24iLCBmbXQ9InBuZyIpCgpkZWYgcGxvdF9yb2MoCiAgICBjb250ZXh0LAogICAgeV9sYWJlbHMsCiAgICB5X3Byb2JzLAogICAga2V5PSJyb2MiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgZm10PSJwbmciLAogICAgeF9sYWJlbDogc3RyID0gImZhbHNlIHBvc2l0aXZlIHJhdGUiLAogICAgeV9sYWJlbDogc3RyID0gICJ0cnVlIHBvc2l0aXZlIHJhdGUiLAogICAgdGl0bGU6IHN0ciA9ICJyb2MgY3VydmUiLAogICAgbGVnZW5kX2xvYzogc3RyID0gImJlc3QiCik6CiAgICAiIiJwbG90IHJvYyBjdXJ2ZXMKICAgIAogICAgVE9ETzogIGFkZCBhdmVyYWdpbmcgbWV0aG9kIChhcyBzdHJpbmcpIHRoYXQgd2FzIHVzZWQgdG8gY3JlYXRlIHByb2JzLCAKICAgIGRpc3BsYXkgaW4gbGVnZW5kCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0geV9sYWJlbHM6ICAgICBncm91bmQgdHJ1dGggbGFiZWxzLCBob3QgZW5jb2RlZCBmb3IgbXVsdGljbGFzcyAgCiAgICA6cGFyYW0geV9wcm9iczogICAgICBtb2RlbCBwcmVkaWN0aW9uIHByb2JhYmlsaXRpZXMKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICgicm9jIikga2V5IG9mIHBsb3QgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICgicGxvdHMiKSBkZXN0aW5hdGlvbiBmb2xkZXIgcmVsYXRpdmUgcGF0aCB0byBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gZm10OiAgICAgICAgICAoInBuZyIpIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0geF9sYWJlbDogICAgICAoImZhbHNlIHBvc2l0aXZlIHJhdGUiKSB4LWF4aXMgbGFiZWxzCiAgICA6cGFyYW0geV9sYWJlbDogICAgICAoInRydWUgcG9zaXRpdmUgcmF0ZSIpIHktYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB0aXRsZTogICAgICAgICgicm9jIGN1cnZlIikgdGl0bGUgb2YgcGxvdAogICAgOnBhcmFtIGxlZ2VuZF9sb2M6ICAgKCJiZXN0IikgbG9jYXRpb24gb2YgcGxvdCBsZWdlbmQKICAgICIiIgogICAgIyBjbGVhciBtYXRwbG90bGliIGN1cnJlbnQgZmlndXJlCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgIyBkcmF3IDQ1IGRlZ3JlZSBsaW5lCiAgICBwbHQucGxvdChbMCwgMV0sIFswLCAxXSwgImstLSIpCiAgICAKICAgICMgbGFiZWxsaW5nCiAgICBwbHQueGxhYmVsKHhfbGFiZWwpCiAgICBwbHQueWxhYmVsKHlfbGFiZWwpCiAgICBwbHQudGl0bGUodGl0bGUpCiAgICBwbHQubGVnZW5kKGxvYz1sZWdlbmRfbG9jKQogICAgCiAgICAjIHNpbmdsZSBST0Mgb3IgbXV0bGlwbGUKICAgIGlmIHlfbGFiZWxzLnNoYXBlWzFdID4gMToKICAgICAgICAjIGRhdGEgYWNjdW1tdWxhdG9ycyBieSBjbGFzcwogICAgICAgIGZwciA9IGRpY3QoKQogICAgICAgIHRwciA9IGRpY3QoKQogICAgICAgIHJvY19hdWMgPSBkaWN0KCkKICAgICAgICBmb3IgaSBpbiByYW5nZSh5X2xhYmVsc1s6LDotMV0uc2hhcGVbMV0pOgogICAgICAgICAgICBmcHJbaV0sIHRwcltpXSwgXyA9IG1ldHJpY3Mucm9jX2N1cnZlKHlfbGFiZWxzWzosIGldLCB5X3Byb2JzWzosIGldLCBwb3NfbGFiZWw9MSkKICAgICAgICAgICAgcm9jX2F1Y1tpXSA9IG1ldHJpY3MuYXVjKGZwcltpXSwgdHByW2ldKQogICAgICAgICAgICBwbHQucGxvdChmcHJbaV0sIHRwcltpXSwgbGFiZWw9ZiJjbGFzcyB7aX0iKQogICAgZWxzZToKICAgICAgICBmcHIsIHRwciwgXyA9IG1ldHJpY3Mucm9jX2N1cnZlKHlfbGFiZWxzLCB5X3Byb2JzWzosIDFdLCBwb3NfbGFiZWw9MSkKICAgICAgICBwbHQucGxvdChmcHIsIHRwciwgbGFiZWw9ZiJwb3NpdGl2ZSBjbGFzcyIpCiAgICAgICAgCiAgICBmbmFtZSA9IGYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmbmFtZSkpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3Qoa2V5LCBib2R5PXBsdC5nY2YoKSksIGxvY2FsX3BhdGg9Zm5hbWUpCiAgICAKCmRlZiBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGxhYmVscywKICAgIHByZWRpY3Rpb25zLAogICAga2V5OiBzdHIgPSAiY29uZnVzaW9uX21hdHJpeCIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBjb2xvcm1hcDogc3RyID0gIkJsdWVzIiwKICAgIGZtdDogc3RyID0gInBuZyIsCiAgICBzYW1wbGVfd2VpZ2h0PU5vbmUKKToKICAgICIiIkNyZWF0ZSBhIGNvbmZ1c2lvbiBtYXRyaXguCiAgICBQbG90IGFuZCBzYXZlIGEgY29uZnVzaW9uIG1hdHJpeCB1c2luZyB0ZXN0IGRhdGEgZnJvbSBhCiAgICBtb2RlbGxpbmUgc3RlcC4KICAgIAogICAgU2VlIGh0dHBzOi8vc2Npa2l0LWxlYXJuLm9yZy9zdGFibGUvbW9kdWxlcy9nZW5lcmF0ZWQvc2tsZWFybi5tZXRyaWNzLmNvbmZ1c2lvbl9tYXRyaXguaHRtbAogICAgCiAgICBUT0RPOiBmaXggbGFiZWwgYWxpZ25tZW50CiAgICBUT0RPOiBjb25zaWRlciB1c2luZyBhbm90aGVyIHBhY2thZ2VkIHZlcnNpb24KICAgIFRPRE86IHJlZmFjdG9yIHRvIHRha2UgcGFyYW1zIGRpY3QgZm9yIHBsb3Qgb3B0aW9ucwoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBsYWJlbHM6ICAgICAgICAgIHZhbGlkYXRpb24gZGF0YSBncm91bmQtdHJ1dGggbGFiZWxzCiAgICA6cGFyYW0gcHJlZGljdGlvbnM6ICAgICB2YWxpZGF0aW9uIGRhdGEgcHJlZGljdGlvbnMKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICAgIHN0cgogICAgOnBhcmFtIHBsb3RzX2RpcjogICAgICAgcmVsYXRpdmUgcGF0aCBvZiBwbG90cyBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIGNvbG9ybWFwOiAgICAgICAgY29sb3VybWFwIGZvciBjb25mdXNpb24gbWF0cml4CiAgICA6cGFyYW0gZm10OiAgICAgICAgICAgICBwbG90IGZvcm1hdAogICAgOnBhcmFtIHNhbXBsZV93ZWlnaHQ6ICAgc2FtcGxlIHdlaWdodHMKICAgICIiIgogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgIGNtID0gbWV0cmljcy5jb25mdXNpb25fbWF0cml4KGxhYmVscywgcHJlZGljdGlvbnMsIHNhbXBsZV93ZWlnaHQ9Tm9uZSkKICAgIHNucy5oZWF0bWFwKGNtLCBhbm5vdD1UcnVlLCBjbWFwPWNvbG9ybWFwLCBzcXVhcmU9VHJ1ZSkKCiAgICBmaWcgPSBwbHQuZ2NmKCkKICAgIGZuYW1lID0gZiJ7cGxvdHNfZGlyfS97a2V5fS57Zm10fSIKICAgIGZpZy5zYXZlZmlnKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIGZuYW1lKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChrZXksIGJvZHk9ZmlnKSwgbG9jYWxfcGF0aD1mbmFtZSkK
    commands: []
    code_origin: /User/functions/sklearn_classifier/function.yaml
