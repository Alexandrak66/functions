kind: job
metadata:
  name: sklearn-classifier
  tag: ''
  hash: c21c099e9dc0aacb0c9afde0c0fe27006d61b765
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: train_model
  description: ''
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gaW1wb3J0bGliIGltcG9ydCBpbXBvcnRfbW9kdWxlCmZyb20gaW5zcGVjdCBpbXBvcnQgZ2V0ZnVsbGFyZ3NwZWMsIEZ1bGxBcmdTcGVjCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAsIGxvYWQKaW1wb3J0IGl0ZXJ0b29scwoKaW1wb3J0IHNrbGVhcm4KaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgc2VhYm9ybiBhcyBzbnMKCmZyb20gc2tsZWFybi51dGlscy50ZXN0aW5nIGltcG9ydCBhbGxfZXN0aW1hdG9ycwpmcm9tIHNrbGVhcm4uZGF0YXNldHMgaW1wb3J0IG1ha2VfY2xhc3NpZmljYXRpb24KZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IGxhYmVsX2JpbmFyaXplCmZyb20gc2tsZWFybi5tb2RlbF9zZWxlY3Rpb24gaW1wb3J0IHRyYWluX3Rlc3Rfc3BsaXQKZnJvbSBza2xlYXJuIGltcG9ydCBtZXRyaWNzCgpmcm9tIHR5cGluZyBpbXBvcnQgVW5pb24sIExpc3QsIEFueSwgT3B0aW9uYWwKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0Cgpza3ZlcnNpb24gPSBza2xlYXJuLl9fdmVyc2lvbl9fCgppbXBvcnQgd2FybmluZ3MKCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgoKZGVmIF9nY2ZfY2xlYXIocGx0KToKICAgICIiIlV0aWxpdHkgdG8gY2xlYXIgbWF0cGxvdGxpYiBmaWd1cmUKCiAgICBSdW4gdGhpcyBpbnNpZGUgZXZlcnkgcGxvdCBtZXRob2QgYmVmb3JlIGNhbGxpbmcgYW55IG1hdHBsb3RsaWIKICAgIG1ldGhvZHMKCiAgICA6cGFyYW0gcGxvdDogICAgbWF0bG9ibGliIGZpZ3VyZSBvYmplY3QKICAgICIiIgogICAgcGx0LmNsYSgpCiAgICBwbHQuY2xmKCkKICAgIHBsdC5jbG9zZSgpCgoKZGVmIF9jcmVhdGVfY2xhc3MocGtnX2NsYXNzOiBzdHIpOgogICAgIiIiQ3JlYXRlIGEgY2xhc3MgZnJvbSBhIHBhY2thZ2UubW9kdWxlLmNsYXNzIHN0cmluZwoKICAgIDpwYXJhbSBwa2dfY2xhc3M6ICBmdWxsIGNsYXNzIGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgIGUuZy4gInNrbGVhcm4ubW9kZWxfc2VsZWN0aW9uLkdyb3VwS0ZvbGQiCiAgICAiIiIKICAgIHNwbGl0cyA9IHBrZ19jbGFzcy5zcGxpdCgiLiIpCiAgICBjbGZjbGFzcyA9IHNwbGl0c1stMV0KICAgIHBrZ19tb2R1bGUgPSBzcGxpdHNbOi0xXQogICAgY2xhc3NfID0gZ2V0YXR0cihpbXBvcnRfbW9kdWxlKCIuIi5qb2luKHBrZ19tb2R1bGUpKSwgY2xmY2xhc3MpCiAgICByZXR1cm4gY2xhc3NfCgpkZWYgX2NyZWF0ZV9mdW5jdGlvbihwa2dfZnVuYzogbGlzdCk6CiAgICAiIiJDcmVhdGUgYSBmdW5jdGlvbiBmcm9tIGEgcGFja2FnZS5tb2R1bGUuZnVuY3Rpb24gc3RyaW5nCgogICAgOnBhcmFtIHBrZ19mdW5jOiAgZnVsbCBmdW5jdGlvbiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGUuZy4gInNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24uZl9jbGFzc2lmIgogICAgIiIiCiAgICBzcGxpdHMgPSBwa2dfZnVuYy5zcGxpdCgiLiIpCiAgICBwa2dfbW9kdWxlID0gIi4iLmpvaW4oc3BsaXRzWzotMV0pCiAgICBjYl9mbmFtZSA9IHNwbGl0c1stMV0KICAgIHBrZ19tb2R1bGUgPSBfX2ltcG9ydF9fKHBrZ19tb2R1bGUsIGZyb21saXN0PVtjYl9mbmFtZV0pCiAgICBmdW5jdGlvbl8gPSBnZXRhdHRyKHBrZ19tb2R1bGUsIGNiX2ZuYW1lKQogICAgcmV0dXJuIGZ1bmN0aW9uXwoKZGVmIGdldF9tb2RlbF9jb25maWdzKAogICAgbXlfbW9kZWxzOiBVbmlvbltzdHIsIExpc3Rbc3RyXV0sCiAgICBjbGFzc19rZXkgPSAiQ0xBU1MiLAogICAgZml0X2tleSA9ICJGSVQiLAogICAgbWV0YV9rZXkgPSAiTUVUQSIsCikgLT4gVW5pb25bZGljdCwgTGlzdFtkaWN0XV06CiAgICAiIiJidWlsZCBza2xlYXJuIG1vZGVsIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycwogICAgCiAgICBUYWtlIChmdWxsKSBjbGFzcyBuYW1lIG9mIGFuIHNjaWtpdC1sZWFybiBtb2RlbCAKICAgIGFuZCByZXRyaWV2ZSBpdHMgYGNsYXNzYCBhbmQgYGZpdGAgcGFyYW1ldGVycyBhbmQKICAgIHRoZWlyIGRlZmF1bHQgdmFsdWVzLgogICAgCiAgICBBbHNvIHJldHVybnMgc29tZSB1c2VmdWwgbWV0YWRhdGEgdmFsdWVzIGZvciB0aGUgY2xhc3MKICAgICIiIgogICAgIyBnZXQgYSBsaXN0IG9mIGFsbCBza2xlYXJuIGVzdGltYXRvcnMKICAgIGVzdGltYXRvcnMgPSBhbGxfZXN0aW1hdG9ycygpCiAgICBkZWYgX2dldF9lc3RpbWF0b3IocGtnX2NsYXNzKToKICAgICAgICAiIiJmaW5kIGEgc3BlY2lmaWMgY2xhc3MgaW4gYSBsaXN0IG9mIHNrbGVhcm4gZXN0aW1hdG9ycyIiIgogICAgICAgIG15X2NsYXNzID0gcGtnX2NsYXNzLnNwbGl0KCcuJylbLTFdCiAgICAgICAgcmV0dXJuIGxpc3QoZmlsdGVyKGxhbWJkYSB4OiB4WzBdID09IG15X2NsYXNzLCBlc3RpbWF0b3JzKSlbMF0KCiAgICAjIGZpbmQgZXN0aW1hdG9ycyBjb3JyZXNwb25kaW5nIHRvIG15X21vZGVscyBsaXN0CiAgICBteV9lc3RpbWF0b3JzID0gW10KICAgIG15X21vZGVscyA9IFtteV9tb2RlbHNdIGlmIGlzaW5zdGFuY2UobXlfbW9kZWxzLCBzdHIpIGVsc2UgbXlfbW9kZWxzCiAgICBmb3IgbW9kZWwgaW4gbXlfbW9kZWxzOgogICAgICAgIGVzdGltYXRvcl9uYW1lLCBlc3RpbWF0b3JfY2xhc3MgPSBfZ2V0X2VzdGltYXRvcihtb2RlbCkKICAgICAgICBteV9lc3RpbWF0b3JzLmFwcGVuZCgoZXN0aW1hdG9yX25hbWUsIGVzdGltYXRvcl9jbGFzcykpCgogICAgIyBnZXQgY2xhc3MgYW5kIGZpdCBzcGVjcwogICAgZXN0aW1hdG9yX3NwZWNzID0gW10KICAgIGZvciBhbl9lc3RpbWF0b3IgaW4gbXlfZXN0aW1hdG9yczoKICAgICAgICBlc3RpbWF0b3Jfc3BlY3MuYXBwZW5kKChhbl9lc3RpbWF0b3JbMF0sICMgbW9kZWwgb25seSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0ZnVsbGFyZ3NwZWMoYW5fZXN0aW1hdG9yWzFdKSwgIyBjbGFzcyBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRmdWxsYXJnc3BlYyhhbl9lc3RpbWF0b3JbMV0uZml0KSwgIyBmaXQgcGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5fZXN0aW1hdG9yWzFdKSkgIyBwYWNrYWdlLm1vZHVsZS5tb2RlbAoKICAgIG1vZGVsX2NvbmZpZ3MgPSBbXQoKICAgIGZvciBlc3RpbWF0b3IgaW4gZXN0aW1hdG9yX3NwZWNzOgogICAgICAgIG1vZGVsX2pzb24gPSB7Y2xhc3Nfa2V5OiB7fSwgZml0X2tleToge319CiAgICAgICAgZml0X3BhcmFtcyA9IHt9CgogICAgICAgIGZvciBpLCBrZXkgaW4gZW51bWVyYXRlKG1vZGVsX2pzb24ua2V5cygpKToKICAgICAgICAgICAgZiA9IGVzdGltYXRvcltpKzFdCiAgICAgICAgICAgIGFyZ3NfcGFpcmVkID0gW10KICAgICAgICAgICAgZGVmc19wYWlyZWQgPSBbXQoKICAgICAgICAgICAgIyByZXZlcnNlIHRoZSBhcmdzIHNpbmNlIHRoZXJlIGFyZSBmZXdlciBkZWZhdWx0cyB0aGFuIGFyZ3MKICAgICAgICAgICAgYXJncyA9IGYuYXJncwogICAgICAgICAgICBhcmdzLnJldmVyc2UoKQogICAgICAgICAgICBuX2FyZ3MgPSBsZW4oYXJncykKCiAgICAgICAgICAgIGRlZnMgPSBmLmRlZmF1bHRzCiAgICAgICAgICAgIGlmIGRlZnMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGRlZnMgPSBbZGVmc10KICAgICAgICAgICAgZGVmcyA9IGxpc3QoZGVmcykKICAgICAgICAgICAgZGVmcy5yZXZlcnNlKCkKICAgICAgICAgICAgbl9kZWZzID0gbGVuKGRlZnMpCgogICAgICAgICAgICBuX3NtYWxsZXN0ID0gbWluKG5fYXJncywgbl9kZWZzKQogICAgICAgICAgICBuX2xhcmdlc3QgPSBtYXgobl9hcmdzLCBuX2RlZnMpCgogICAgICAgICAgICAjIGJ1aWxkIDIgbGlzdHMgdGhhdCBjYW4gYmUgY29uY2F0ZW5hdGVkCiAgICAgICAgICAgIGZvciBpeCBpbiByYW5nZShuX3NtYWxsZXN0KToKICAgICAgICAgICAgICAgIGlmIGFyZ3NbaXhdIGlzIG5vdCAic2VsZiI6CiAgICAgICAgICAgICAgICAgICAgYXJnc19wYWlyZWQuYXBwZW5kKGFyZ3NbaXhdKQogICAgICAgICAgICAgICAgICAgIGRlZnNfcGFpcmVkLmFwcGVuZChkZWZzW2l4XSkKCiAgICAgICAgICAgIGZvciBpeCBpbiByYW5nZShuX3NtYWxsZXN0LCBuX2xhcmdlc3QpOgogICAgICAgICAgICAgICAgaWYgaXggaXMgbm90IDAgYW5kIGFyZ3NbaXhdIGlzIG5vdCAic2VsZiI6CiAgICAgICAgICAgICAgICAgICAgYXJnc19wYWlyZWQuYXBwZW5kKGFyZ3NbaXhdKQogICAgICAgICAgICAgICAgICAgIGRlZnNfcGFpcmVkLmFwcGVuZChOb25lKQogICAgICAgICAgICAgICAjIGNvbmNhdGVuYXRlIGxpc3RzIGludG8gYXBwcm9wcmlhdGUgc3RydWN0dXJlCiAgICAgICAgICAgIG1vZGVsX2pzb25ba2V5XSA9IGRpY3QoemlwKHJldmVyc2VkKGFyZ3NfcGFpcmVkKSwgcmV2ZXJzZWQoZGVmc19wYWlyZWQpKSkKCiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV0gPSB7fQogICAgICAgIG1vZGVsX2pzb25bbWV0YV9rZXldWydza2xlYXJuX3ZlcnNpb24nXSA9IHNrdmVyc2lvbgogICAgICAgIG1vZGVsX2pzb25bbWV0YV9rZXldWydjbGFzcyddID0gJy4nLmpvaW4oW2VzdGltYXRvclszXS5fX21vZHVsZV9fLCBlc3RpbWF0b3JbMF1dKQogICAgICAgIG1vZGVsX2NvbmZpZ3MuYXBwZW5kKG1vZGVsX2pzb24pCiAgICBpZiBsZW4obW9kZWxfY29uZmlncykgPT0gMToKICAgICAgICAjIGRvIHdlIHdhbnQgdG8gbG9nIHRoaXMgbW9kaWZpZWQgbW9kZWwgYXMgYW4gYXJ0aWZhY3Q/CiAgICAgICAgcmV0dXJuIG1vZGVsX2NvbmZpZ3NbMF0KICAgIGVsc2U6CiAgICAgICAgIyBkbyB3ZSB3YW50IHRvIGxvZyB0aGlzIG1vZGlmaWVkIG1vZGVsIGFzIGFuIGFydGlmYWN0PwogICAgICAgIHJldHVybiBtb2RlbF9jb25maWdzCgpkZWYgdXBkYXRlX21vZGVsX2NvbmZpZygKICAgIGNvbmZpZzogZGljdCwKICAgIG5ld19jbGFzczogZGljdCwKICAgIG5ld19maXQ6IGRpY3QsCiAgICBjbGFzc19rZXk6IHN0ciA9ICJDTEFTUyIsCiAgICBmaXRfa2V5OiBzdHIgPSAiRklUIgopOgogICAgIiIiVXBkYXRlIG1vZGVsIGNvbmZpZyBqc29uCiAgICAgICAgCiAgICBUaGlzIGZ1bmN0aW9uIGlzIGVzc2VudGlhbCBzaW5jZSB0aGVyZSBhcmUgbW9kaWZpY2F0aW9ucyBpbiBjbGFzcwogICAgYW5kIGZpdCBwYXJhbXMgdGhhdCBtdXN0IGJlIG1hZGUgKGNhbGxiYWNrcyBhcmUgYSBnb29kIGV4YW1wbGUsIHdpdGhvdXQKICAgIHdoaWNoIHRoZXJlIGlzIG5vIHRyYWluaW5nIGhpc3RvcnkgYXZhaWxhYmxlKQogICAgCiAgICBUT0RPOiAgY3VycmVudGx5IGEgbW9kZWwgY29uZmlnIGNvbnRhaW5zIDIga2V5cywgYnV0IHRoaXMgd2lsbCBsaWtlbHkKICAgIGV4cGFuZCB0byBpbmNsdWRlIG90aGVyIGZ1bmN0aW9ucyBiZXlvbmQgY2xhc3MgYW5kIGZpdC4gU28gbmVlZCB0byBleHBhbmQgCiAgICB0aGlzIHRvIGEgbGlzdCBvZiBUdXBsZShzdHIsIGRpY3QpLCB3aGVyZSBgc3RyYCBjb3JyZXNwb25kcyB0byBhIGtleQogICAgaW4gdGhlIG1vZGVsIGNvbmZpZyBhbmQgYGRpY3RgIGNvbnRhaW5zIHRoZSBwYXJhbXMgYW5kIHRoZWlyIG5ldyB2YWx1ZXMuCiAgICAKICAgIDpwYXJhbSBjb25maWc6ICAgICAgb3JpZ2luYWwgbW9kZWwgZGVmaW5pdGlvbiBjb250YWluaW5nIDIga2V5cywgQ0xBU1MgYW5kIEZJVAogICAgOnBhcmFtIG5ld19jbGFzczogICBuZXcgY2xhc3Mga2V5LXZhbHVlcwogICAgOnBhcmFtIG5ld19maXQ6ICAgICBuZXcgZml0IGtleS12YWx1ZXMKICAgICIiIgogICAgY29uZmlnW2NsYXNzX2tleV0udXBkYXRlKG5ld19jbGFzcykKICAgIGNvbmZpZ1tmaXRfa2V5XS51cGRhdGUobmV3X2ZpdCkKICAgIAogICAgcmV0dXJuIGNvbmZpZwoKZGVmIHRyYWluX21vZGVsKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBtb2RlbF9wa2dfY2xhc3M6IHN0ciwKICAgIGRhdGFfa2V5OiBVbmlvbltEYXRhSXRlbSwgc3RyXSwKICAgIHNhbXBsZTogaW50LAogICAgbGFiZWxfY29sdW1uOiBzdHIsCiAgICBtb2RlbF9rZXk6IHN0ciA9ICJtb2RlbCIsCiAgICB0ZXN0X3NpemU6IGZsb2F0ID0gMC4wNSwKICAgIHRyYWluX3ZhbF9zcGxpdDogZmxvYXQgPSAwLjc1LAogICAgdGVzdF9zZXRfa2V5OiBzdHIgPSAidGVzdF9zZXQiLAogICAgcm5nOiBpbnQgPSAxLAogICAgbW9kZWxzX2Rpcjogc3RyID0gIm1vZGVscyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBzY29yZV9tZXRob2Q6IHN0ciA9ICJtaWNybyIsCiAgICBjbGFzc19wYXJhbXNfdXBkYXRlczogVW5pb25bRGF0YUl0ZW0sIGRpY3RdID0ge30sCiAgICBmaXRfcGFyYW1zX3VwZGF0ZXM6IFVuaW9uW0RhdGFJdGVtLCBkaWN0XSA9IHt9LAopIC0+IE5vbmU6CiAgICAiIiJ0cmFpbiBhIGNsYXNzaWZpZXIuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICB0aGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIG1vZGVsX3BrZ19jbGFzczogICB0aGUgbW9kZWwgdG8gdHJhaW4sIGUuZywgJ3NrbGVhcm4ubmV1cmFsX25ldHdvcmtzLk1MUENsYXNzaWZpZXInCiAgICA6cGFyYW0gZGF0YV9rZXk6ICAgICAgICAgICgicmF3IikgbmFtZSBvZiByYXcgZGF0YSBmaWxlCiAgICA6cGFyYW0gc2FtcGxlOiAgICAgICAgICAgIFNlbGVjdHMgdGhlIGZpcnN0IG4gcm93cywgb3Igc2VsZWN0IGEgc2FtcGxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0aW5nIGZyb20gdGhlIGZpcnN0LiBJZiBuZWdhdGl2ZSA8LTEsIHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHJhbmRvbSBzYW1wbGUKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgZ3JvdW5kLXRydXRoICh5KSBsYWJlbHMKICAgIDpwYXJhbSBtb2RlbF9rZXk6ICAgICAgICAgKCdtb2RlbCcpIG5hbWUgb2YgbW9kZWwgaW4gYXJ0aWZhY3Qgc3RvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyB0byBhIGRpcmVjdG9yeQogICAgOnBhcmFtIHRlc3Rfc2l6ZTogICAgICAgICAoMC4wNSkgdGVzdCBzZXQgc2l6ZQogICAgOnBhcmFtIHRyYWluX3ZhbF9zcGxpdDogICAoMC43NSkgT25jZSB0aGUgdGVzdCBzZXQgaGFzIGJlZW4gcmVtb3ZlZCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5pbmcgc2V0IGdldHMgdGhpcyBwcm9wb3J0aW9uLgogICAgOnBhcmFtIHRlc3Rfc2V0X2tleTogICAgICBzdG9yZSB0aGUgdGVzdCBkYXRhIHNldCB1bmRlciB0aGlzIGtleSBpbiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBybmc6ICAgICAgICAgICAgICAgKDEpIHNrbGVhcm4gcm5nIHNlZWQKICAgIDpwYXJhbSBtb2RlbHNfZGlyOiAgICAgICAgbW9kZWxzIHN1YmZvbGRlciBvbiBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICAgIHBsb3Qgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBzY29yZV9tZXRob2Q6ICAgICAgZm9yIG11bHRpY2xhc3MgY2xhc3NpZmljYXRpb24KICAgIDpwYXJhbSBjbGFzc191cGRhdGVzOiAgICAgdXBkYXRlIHRoZXNlIHNjaWtpdC1sZWFybiBjbGFzc2lmaWVyIHBhcmFtcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgYXMgYSBkaWN0CiAgICA6cGFyYW0gZml0X3VwZGF0ZXM6ICAgICAgIHVwZGF0ZSBzY2lraXQtbGVhcm4gZml0IHBhcmFtZXRlcnMsIGlucHV0IGFzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgZGljdC4KICAgICIiIgogICAgIyBleHRyYWN0IGZpbGUgbmFtZSBmcm9tIERhdGFJdGVtCiAgICBzcmNmaWxlcGF0aCA9IHN0cihkYXRhX2tleSkKICAgIAogICAgIyBUT0RPOiB0aGlzIHNob3VsZCBiZSBwYXJ0IG9mIGRhdGEncyBtZXRhZGF0YSBkZWFsdCB3aXRoIGluIGFub3RoZXIgc3RlcCBnZXQgYSBkYXRhIHNldCwgc2FtcGxlLCBldGMuLi4KICAgICMgZ2V0IGFsbCBkYXRhIG9yIGEgc2FtcGxlCiAgICBpZiAoc2FtcGxlID09IC0xKSBvciAoc2FtcGxlID49IDEpOgogICAgICAgICMgZ2V0IGFsbCByb3dzLCBvciBjb250aWd1b3VzIHNhbXBsZSBzdGFydGluZyBhdCByb3cgMS4KICAgICAgICByYXcgPSBwcS5yZWFkX3RhYmxlKHNyY2ZpbGVwYXRoKS50b19wYW5kYXMoKS5kcm9wbmEoKQogICAgICAgIGxhYmVscyA9IHJhdy5wb3AobGFiZWxfY29sdW1uKQogICAgICAgIHJhdyA9IHJhdy5pbG9jWzpzYW1wbGUsIDpdCiAgICAgICAgbGFiZWxzID0gbGFiZWxzLmlsb2NbOnNhbXBsZV0KICAgIGVsc2U6CiAgICAgICAgIyBncmFiIGEgcmFuZG9tIHNhbXBsZQogICAgICAgIHJhdyA9IHBxLnJlYWRfdGFibGUoc3JjZmlsZXBhdGgpLnRvX3BhbmRhcygpLmRyb3BuYSgpLnNhbXBsZShzYW1wbGUgKiAtMSkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKCiAgICAjIFRPRE86IHRoaXMgc2hvdWxkIGJlIHBhcnQgb2YgZGF0YSdzIG1ldGFkYXRhIGRlYWx0IHdpdGggaW4gYW5vdGhlciBzdGVwCiAgICBjb250ZXh0LmhlYWRlciA9IHJhdy5jb2x1bW5zLnZhbHVlcwogICAgCiAgICAjIFRPRE86IGFsbCBvZiB0aGlzIHNob3VsZCBiZSBwYXJ0IG9mIGEgc3BpdHRlciBjb21wb25lbnQgdGhhdCBkb2VzIGN2IHRvbywgZGVhbHQgd2l0aCBpbiBhbm90aGVyIHN0ZXAKICAgICMgbWFrZSBhIGhvdCBlbmNvZGUgY29weSBvZiBsYWJlbHMgYmVmb3JlIHRoZSBzcGxpdAogICAgeWIgPSBsYWJlbF9iaW5hcml6ZSh5LCBjbGFzc2VzPWxpc3QocmFuZ2UocmF3LnNoYXBlWzFdKSkpCiAgICAjIGRvdWJsZSBzcGxpdCB0byBnZW5lcmF0ZSAzIGRhdGEgc2V0czogdHJhaW4sIHZhbGlkYXRpb24gYW5kIHRlc3QKICAgICMgd2l0aCB4dGVzdCx5dGVzdCBzZXQgYXNpZGUKICAgIHgsIHh0ZXN0LCB5LCB5dGVzdCA9IHRyYWluX3Rlc3Rfc3BsaXQobnAuY29uY2F0ZW5hdGUoW3JhdywgeWJdLCBsYWJlbHMsIHRlc3Rfc2l6ZT10ZXN0X3NpemUsIHJhbmRvbV9zdGF0ZT1ybmcpCiAgICB4dHJhaW4sIHh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KHgsIHksIHRyYWluX3NpemU9dHJhaW5fdmFsX3NwbGl0LCByYW5kb21fc3RhdGU9cm5nKQogICAgIyBleHRyYWN0IHRoZSBob3RfZW5jb2RlZCBsYWJlbHMKICAgIHl0cmFpbmIgPSB4dHJhaW5bOiwgLXliLnNoYXBlWzFdOl0uY29weSgpCiAgICB4dHJhaW4gPSB4dHJhaW5bOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpCiAgICAjIGV4dHJhY3QgdGhlIGhvdF9lbmNvZGVkIGxhYmVscwogICAgeXZhbGlkYiA9IHh2YWxpZFs6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh2YWxpZCA9IHh2YWxpZFs6LCA6LXliLnNoYXBlWzFdXS5jb3B5KCkKICAgICMgZXh0cmFjdCB0aGUgaG90X2VuY29kZWQgbGFiZWxzCiAgICB5dGVzdGIgPSB4dGVzdFs6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh0ZXN0ID0geHRlc3RbOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICMgc2V0LWFzaWRlIHRlc3Rfc2V0CiAgICB0ZXN0X3NldCA9IHBkLmNvbmNhdCgKICAgICAgICBbcGQuRGF0YUZyYW1lKGRhdGE9eHRlc3QsIGNvbHVtbnM9Y29udGV4dC5oZWFkZXIpLAogICAgICAgICBwZC5EYXRhRnJhbWUoZGF0YT15dGVzdCwgY29sdW1ucz1bbGFiZWxfY29sdW1uXSksCiAgICAgICAgIHBkLkRhdGFGcmFtZShkYXRhPXl0ZXN0YiBjb2x1bW5zPVtsYWJlbF9jb2x1bW5dKV0sCiAgICAgICAgYXhpcz0xLCkKICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKGJhc2VfcGF0aCwgdGVzdF9zZXRfa2V5ICsgIi5wcXQiKQogICAgdGVzdF9zZXQudG9fcGFycXVldChmaWxlcGF0aCwgaW5kZXg9RmFsc2UpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCh0ZXN0X3NldF9rZXksIGxvY2FsX3BhdGg9dGVzdF9zZXRfa2V5ICsgIi5wcXQiKQoKICAgICMgbG9hZCB0aGUgbW9kZWwgY29uZmlnCiAgICBtb2RlbF9jb25maWcgPSBnZXRfbW9kZWxfY29uZmlncyhtb2RlbF9wa2dfY2xhc3MpCiAgICAjIGdldCB1cGRhdGUgcGFyYW1zIGlmIGFueQogICAgaWYgaXNpbnN0YW5jZShjbGFzc19wYXJhbXNfdXBkYXRlcywgRGF0YUl0ZW0pOgogICAgICAgIGNsYXNzX3BhcmFtc191cGRhdGVzID0ganNvbi5sb2FkcyhjbGFzc19wYXJhbXNfdXBkYXRlcy5nZXQoKSkKICAgIGlmIGlzaW5zdGFuY2UoZml0X3BhcmFtc191cGRhdGVzLCBEYXRhSXRlbSk6CiAgICAgICAgZml0X3BhcmFtc191cGRhdGVzID0ganNvbi5sb2FkcyhmaXRfcGFyYW1zX3VwZGF0ZXMuZ2V0KCkpCiAgICAjIHVwZGF0ZSB0aGUgcGFyYW1ldGVycyAgICAgICAgICAgIAogICAgIyBhZGQgZGF0YSB0byBmaXQgcGFyYW1zCiAgICBmaXRfcGFyYW1zX3VwZGF0ZXMudXBkYXRlKHsnWCc6IHh0cmFpbiwneSc6IHl0cmFpbn0pCiAgICBtb2RlbF9jb25maWcgPSB1cGRhdGVfbW9kZWxfY29uZmlnKG1vZGVsX2NvbmZpZywgY2xhc3NfcGFyYW1zX3VwZGF0ZSwgZml0X3BhcmFtc191cGRhdGVzKQoKICAgICMgY3JlYXRlIGNsYXNzIGFuZCBmaXQKICAgIENsYXNzaWZpZXJDbGFzcyA9IF9jcmVhdGVfY2xhc3MobW9kZWxfY29uZmlnWyJNRVRBIl1bImNsYXNzIl0pCiAgICBtb2RlbCA9IENsYXNzaWZpZXJDbGFzcygqKmNsYXNzX3BhcmFtcykKICAgIG1vZGVsLmZpdCgqKmZpdF9wYXJhbXMpCgogICAgIyBzYXZlIG1vZGVsCiAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIGYie21vZGVsc19kaXJ9L3ttb2RlbF9rZXl9LnBrbCIpCiAgICBkdW1wKG1vZGVsLCBvcGVuKGZpbGVwYXRoLCAid2IiKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KG1vZGVsX2tleSwgbG9jYWxfcGF0aD1tb2RlbHNfZGlyKQoKICAgICMgY29tcHV0ZSB2YWxpZGF0aW9uIG1ldHJpY3MKICAgIHlwcmVkID0gbW9kZWwucHJlZGljdCh4dmFsaWQpCiAgICB5X3Njb3JlID0gbW9kZWwucHJlZGljdF9wcm9iYSh4dmFsaWQpCgogICAgYXZlcmFnZV9wcmVjaXNpb24gPSBhdmVyYWdlX3ByZWNpc2lvbl9zY29yZSh5dmFsaWRiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5X3Njb3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkKCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhY2N1cmFjeSIsIGZsb2F0KG1vZGVsLnNjb3JlKHh2YWxpZCwgeXZhbGlkKSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCByb2NfYXVjX3Njb3JlKHl2YWxpZGIsIHlfc2NvcmUpKQogICAgY29udGV4dC5sb2dfcmVzdWx0KGYiZjFfc2NvcmUiLCBmMV9zY29yZSh5dmFsaWQsIHlwcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhdmdfcHJlY3Njb3JlIiwgYXZlcmFnZV9wcmVjaXNpb24pCgogICAgIyB2YWxpZGF0aW9uIHBsb3RzCiAgICAKICAgIHBsb3Rfcm9jKGNvbnRleHQsIHl2YWxpZGIsIHlfc2NvcmUpCiAgICBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoY29udGV4dCwgeXZhbGlkLCB5cHJlZCwga2V5PSJjb25mdXNpb24iLCBmbXQ9InBuZyIpCgpkZWYgcGxvdF9yb2MoCiAgICBjb250ZXh0LAogICAgeV9sYWJlbHMsCiAgICB5X3Byb2JzLAogICAga2V5PSJyb2MiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgZm10PSJwbmciLAogICAgeF9sYWJlbDogc3RyID0gImZhbHNlIHBvc2l0aXZlIHJhdGUiLAogICAgeV9sYWJlbDogc3RyID0gICJ0cnVlIHBvc2l0aXZlIHJhdGUiLAogICAgdGl0bGU6IHN0ciA9ICJyb2MgY3VydmUiLAogICAgbGVnZW5kX2xvYzogc3RyID0gImJlc3QiCik6CiAgICAiIiJwbG90IHJvYyBjdXJ2ZXMKICAgIAogICAgVE9ETzogIGFkZCBhdmVyYWdpbmcgbWV0aG9kIChhcyBzdHJpbmcpIHRoYXQgd2FzIHVzZWQgdG8gY3JlYXRlIHByb2JzLCAKICAgIGRpc3BsYXkgaW4gbGVnZW5kCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0geV9sYWJlbHM6ICAgICBncm91bmQgdHJ1dGggbGFiZWxzLCBob3QgZW5jb2RlZCBmb3IgbXVsdGljbGFzcyAgCiAgICA6cGFyYW0geV9wcm9iczogICAgICBtb2RlbCBwcmVkaWN0aW9uIHByb2JhYmlsaXRpZXMKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICgicm9jIikga2V5IG9mIHBsb3QgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICgicGxvdHMiKSBkZXN0aW5hdGlvbiBmb2xkZXIgcmVsYXRpdmUgcGF0aCB0byBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gZm10OiAgICAgICAgICAoInBuZyIpIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0geF9sYWJlbDogICAgICAoImZhbHNlIHBvc2l0aXZlIHJhdGUiKSB4LWF4aXMgbGFiZWxzCiAgICA6cGFyYW0geV9sYWJlbDogICAgICAoInRydWUgcG9zaXRpdmUgcmF0ZSIpIHktYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB0aXRsZTogICAgICAgICgicm9jIGN1cnZlIikgdGl0bGUgb2YgcGxvdAogICAgOnBhcmFtIGxlZ2VuZF9sb2M6ICAgKCJiZXN0IikgbG9jYXRpb24gb2YgcGxvdCBsZWdlbmQKICAgICIiIgogICAgIyBkb24ndCBib3RoZXIgaWYgdGhpcyBkb2Vzbid0IHdvcmsKICAgIGFzc2VydCB5X3Byb2JzLnNoYXBlID09IHlfbGFiZWxzLnNoYXBlCiAgICAKICAgICMgY2xlYXIgbWF0cGxvdGxpYiBjdXJyZW50IGZpZ3VyZQogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgICMgZGF0YSBhY2N1bW11bGF0b3JzIGJ5IGNsYXNzCiAgICBmcHIgPSBkaWN0KCkKICAgIHRwciA9IGRpY3QoKQogICAgcm9jX2F1YyA9IGRpY3QoKQogICAgCiAgICAjIGRyYXcgNDUgZGVncmVlIGxpbmUKICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAiay0tIikKICAgIAogICAgIyBsYWJlbGxpbmcKICAgIHBsdC54bGFiZWwoeF9sYWJlbCkKICAgIHBsdC55bGFiZWwoeV9sYWJlbCkKICAgIHBsdC50aXRsZSh0aXRsZSkKICAgIHBsdC5sZWdlbmQobG9jPWxlZ2VuZF9sb2MpCiAgICAKICAgICMgc2luZ2xlIFJPQyBvciBtdXRsaXBsZQogICAgZm9yIGkgaW4gcmFuZ2UoeV9sYWJlbHMuc2hhcGVbMV0pOgogICAgICAgIGZwcltpXSwgdHByW2ldLCBfID0gbWV0cmljcy5yb2NfY3VydmUoeV9sYWJlbHNbOiwgaV0sIHlfcHJvYnNbOiwgaV0sIHBvc19sYWJlbD0xKQogICAgICAgIHJvY19hdWNbaV0gPSBtZXRyaWNzLmF1YyhmcHJbaV0sIHRwcltpXSkKICAgICAgICBwbHQucGxvdChmcHJbaV0sIHRwcltpXSwgbGFiZWw9ZiJjbGFzcyB7aX0iKQoKICAgIGZuYW1lID0gZiJ7cGxvdHNfZGlyfS97a2V5fS57Zm10fSIKICAgIHBsdC5zYXZlZmlnKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIGZuYW1lKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChrZXksIGJvZHk9cGx0LmdjZigpKSwgbG9jYWxfcGF0aD1mbmFtZSkKICAgIAoKZGVmIHBsb3RfY29uZnVzaW9uX21hdHJpeCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbGFiZWxzLAogICAgcHJlZGljdGlvbnMsCiAgICBrZXk6IHN0ciA9ICJjb25mdXNpb25fbWF0cml4IiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIiwKICAgIGNvbG9ybWFwOiBzdHIgPSAiQmx1ZXMiLAogICAgZm10OiBzdHIgPSAicG5nIiwKICAgIHNhbXBsZV93ZWlnaHQ9Tm9uZQopOgogICAgIiIiQ3JlYXRlIGEgY29uZnVzaW9uIG1hdHJpeC4KICAgIFBsb3QgYW5kIHNhdmUgYSBjb25mdXNpb24gbWF0cml4IHVzaW5nIHRlc3QgZGF0YSBmcm9tIGEKICAgIG1vZGVsbGluZSBzdGVwLgogICAgCiAgICBTZWUgaHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnL3N0YWJsZS9tb2R1bGVzL2dlbmVyYXRlZC9za2xlYXJuLm1ldHJpY3MuY29uZnVzaW9uX21hdHJpeC5odG1sCiAgICAKICAgIFRPRE86IGZpeCBsYWJlbCBhbGlnbm1lbnQKICAgIFRPRE86IGNvbnNpZGVyIHVzaW5nIGFub3RoZXIgcGFja2FnZWQgdmVyc2lvbgogICAgVE9ETzogcmVmYWN0b3IgdG8gdGFrZSBwYXJhbXMgZGljdCBmb3IgcGxvdCBvcHRpb25zCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIGxhYmVsczogICAgICAgICAgdmFsaWRhdGlvbiBkYXRhIGdyb3VuZC10cnV0aCBsYWJlbHMKICAgIDpwYXJhbSBwcmVkaWN0aW9uczogICAgIHZhbGlkYXRpb24gZGF0YSBwcmVkaWN0aW9ucwogICAgOnBhcmFtIGtleTogICAgICAgICAgICAgc3RyCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICByZWxhdGl2ZSBwYXRoIG9mIHBsb3RzIGluIGFydGlmYWN0IHN0b3JlCiAgICA6cGFyYW0gY29sb3JtYXA6ICAgICAgICBjb2xvdXJtYXAgZm9yIGNvbmZ1c2lvbiBtYXRyaXgKICAgIDpwYXJhbSBmbXQ6ICAgICAgICAgICAgIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0gc2FtcGxlX3dlaWdodDogICBzYW1wbGUgd2VpZ2h0cwogICAgIiIiCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgY20gPSBtZXRyaWNzLmNvbmZ1c2lvbl9tYXRyaXgobGFiZWxzLCBwcmVkaWN0aW9ucywgc2FtcGxlX3dlaWdodD1Ob25lKQogICAgc25zLmhlYXRtYXAoY20sIGFubm90PVRydWUsIGNtYXA9Y29sb3JtYXAsIHNxdWFyZT1UcnVlKQoKICAgIGZpZyA9IHBsdC5nY2YoKQogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9LntmbXR9IgogICAgZmlnLnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZm5hbWUpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1maWcpLCBsb2NhbF9wYXRoPWZuYW1lKQo=
    commands: []
    code_origin: https://github.com/mlrun/functions.git#6dad36b167efd50e0f0cf0703b35e94ec29f6dad:sklearn_classifier/sklearn_classifier.py
