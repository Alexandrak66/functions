kind: job
metadata:
  name: sklearn-classifier
  tag: ''
  hash: fe5793ca7915de64c8f68a04f06d82269b6201e8
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: train_model
  description: ''
  image_pull_policy: Always
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gaW1wb3J0bGliIGltcG9ydCBpbXBvcnRfbW9kdWxlCmZyb20gaW5zcGVjdCBpbXBvcnQgZ2V0ZnVsbGFyZ3NwZWMsIEZ1bGxBcmdTcGVjCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAsIGxvYWQKaW1wb3J0IGl0ZXJ0b29scwoKaW1wb3J0IHNrbGVhcm4KZnJvbSBza2xlYXJuIGltcG9ydCBtZXRyaWNzCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHB5YXJyb3cgYXMgcGEKaW1wb3J0IHB5YXJyb3cucGFycXVldCBhcyBwcQppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgc2VhYm9ybiBhcyBzbnMKCmZyb20gc2tsZWFybi51dGlscy50ZXN0aW5nIGltcG9ydCBhbGxfZXN0aW1hdG9ycwpmcm9tIHNrbGVhcm4uZGF0YXNldHMgaW1wb3J0IG1ha2VfY2xhc3NpZmljYXRpb24KZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IGxhYmVsX2JpbmFyaXplCmZyb20gc2tsZWFybi5tb2RlbF9zZWxlY3Rpb24gaW1wb3J0IHRyYWluX3Rlc3Rfc3BsaXQKZnJvbSBza2xlYXJuIGltcG9ydCBtZXRyaWNzCgpmcm9tIHR5cGluZyBpbXBvcnQgVW5pb24sIExpc3QsIEFueSwgT3B0aW9uYWwKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0Cgpza3ZlcnNpb24gPSBza2xlYXJuLl9fdmVyc2lvbl9fCgppbXBvcnQgd2FybmluZ3MKCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgoKZGVmIF9nY2ZfY2xlYXIocGx0KToKICAgICIiIlV0aWxpdHkgdG8gY2xlYXIgbWF0cGxvdGxpYiBmaWd1cmUKCiAgICBSdW4gdGhpcyBpbnNpZGUgZXZlcnkgcGxvdCBtZXRob2QgYmVmb3JlIGNhbGxpbmcgYW55IG1hdHBsb3RsaWIKICAgIG1ldGhvZHMKCiAgICA6cGFyYW0gcGxvdDogICAgbWF0bG9ibGliIGZpZ3VyZSBvYmplY3QKICAgICIiIgogICAgcGx0LmNsYSgpCiAgICBwbHQuY2xmKCkKICAgIHBsdC5jbG9zZSgpCgoKZGVmIF9jcmVhdGVfY2xhc3MocGtnX2NsYXNzOiBzdHIpOgogICAgIiIiQ3JlYXRlIGEgY2xhc3MgZnJvbSBhIHBhY2thZ2UubW9kdWxlLmNsYXNzIHN0cmluZwoKICAgIDpwYXJhbSBwa2dfY2xhc3M6ICBmdWxsIGNsYXNzIGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgIGUuZy4gInNrbGVhcm4ubW9kZWxfc2VsZWN0aW9uLkdyb3VwS0ZvbGQiCiAgICAiIiIKICAgIHNwbGl0cyA9IHBrZ19jbGFzcy5zcGxpdCgiLiIpCiAgICBjbGZjbGFzcyA9IHNwbGl0c1stMV0KICAgIHBrZ19tb2R1bGUgPSBzcGxpdHNbOi0xXQogICAgY2xhc3NfID0gZ2V0YXR0cihpbXBvcnRfbW9kdWxlKCIuIi5qb2luKHBrZ19tb2R1bGUpKSwgY2xmY2xhc3MpCiAgICByZXR1cm4gY2xhc3NfCgpkZWYgX2NyZWF0ZV9mdW5jdGlvbihwa2dfZnVuYzogbGlzdCk6CiAgICAiIiJDcmVhdGUgYSBmdW5jdGlvbiBmcm9tIGEgcGFja2FnZS5tb2R1bGUuZnVuY3Rpb24gc3RyaW5nCgogICAgOnBhcmFtIHBrZ19mdW5jOiAgZnVsbCBmdW5jdGlvbiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGUuZy4gInNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24uZl9jbGFzc2lmIgogICAgIiIiCiAgICBzcGxpdHMgPSBwa2dfZnVuYy5zcGxpdCgiLiIpCiAgICBwa2dfbW9kdWxlID0gIi4iLmpvaW4oc3BsaXRzWzotMV0pCiAgICBjYl9mbmFtZSA9IHNwbGl0c1stMV0KICAgIHBrZ19tb2R1bGUgPSBfX2ltcG9ydF9fKHBrZ19tb2R1bGUsIGZyb21saXN0PVtjYl9mbmFtZV0pCiAgICBmdW5jdGlvbl8gPSBnZXRhdHRyKHBrZ19tb2R1bGUsIGNiX2ZuYW1lKQogICAgcmV0dXJuIGZ1bmN0aW9uXwoKZGVmIGdldF9tb2RlbF9jb25maWdzKAogICAgbXlfbW9kZWxzOiBVbmlvbltzdHIsIExpc3Rbc3RyXV0sCiAgICBjbGFzc19rZXkgPSAiQ0xBU1MiLAogICAgZml0X2tleSA9ICJGSVQiLAogICAgbWV0YV9rZXkgPSAiTUVUQSIsCikgLT4gVW5pb25bZGljdCwgTGlzdFtkaWN0XV06CiAgICAiIiJidWlsZCBza2xlYXJuIG1vZGVsIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycwogICAgCiAgICBUYWtlIChmdWxsKSBjbGFzcyBuYW1lIG9mIGFuIHNjaWtpdC1sZWFybiBtb2RlbCAKICAgIGFuZCByZXRyaWV2ZSBpdHMgYGNsYXNzYCBhbmQgYGZpdGAgcGFyYW1ldGVycyBhbmQKICAgIHRoZWlyIGRlZmF1bHQgdmFsdWVzLgogICAgCiAgICBBbHNvIHJldHVybnMgc29tZSB1c2VmdWwgbWV0YWRhdGEgdmFsdWVzIGZvciB0aGUgY2xhc3MKICAgICIiIgogICAgIyBnZXQgYSBsaXN0IG9mIGFsbCBza2xlYXJuIGVzdGltYXRvcnMKICAgIGVzdGltYXRvcnMgPSBhbGxfZXN0aW1hdG9ycygpCiAgICBkZWYgX2dldF9lc3RpbWF0b3IocGtnX2NsYXNzKToKICAgICAgICAiIiJmaW5kIGEgc3BlY2lmaWMgY2xhc3MgaW4gYSBsaXN0IG9mIHNrbGVhcm4gZXN0aW1hdG9ycyIiIgogICAgICAgIG15X2NsYXNzID0gcGtnX2NsYXNzLnNwbGl0KCIuIilbLTFdCiAgICAgICAgcmV0dXJuIGxpc3QoZmlsdGVyKGxhbWJkYSB4OiB4WzBdID09IG15X2NsYXNzLCBlc3RpbWF0b3JzKSlbMF0KCiAgICAjIGZpbmQgZXN0aW1hdG9ycyBjb3JyZXNwb25kaW5nIHRvIG15X21vZGVscyBsaXN0CiAgICBteV9lc3RpbWF0b3JzID0gW10KICAgIG15X21vZGVscyA9IFtteV9tb2RlbHNdIGlmIGlzaW5zdGFuY2UobXlfbW9kZWxzLCBzdHIpIGVsc2UgbXlfbW9kZWxzCiAgICBmb3IgbW9kZWwgaW4gbXlfbW9kZWxzOgogICAgICAgIGVzdGltYXRvcl9uYW1lLCBlc3RpbWF0b3JfY2xhc3MgPSBfZ2V0X2VzdGltYXRvcihtb2RlbCkKICAgICAgICBteV9lc3RpbWF0b3JzLmFwcGVuZCgoZXN0aW1hdG9yX25hbWUsIGVzdGltYXRvcl9jbGFzcykpCgogICAgIyBnZXQgY2xhc3MgYW5kIGZpdCBzcGVjcwogICAgZXN0aW1hdG9yX3NwZWNzID0gW10KICAgIGZvciBhbl9lc3RpbWF0b3IgaW4gbXlfZXN0aW1hdG9yczoKICAgICAgICBlc3RpbWF0b3Jfc3BlY3MuYXBwZW5kKChhbl9lc3RpbWF0b3JbMF0sICMgbW9kZWwgb25seSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0ZnVsbGFyZ3NwZWMoYW5fZXN0aW1hdG9yWzFdKSwgIyBjbGFzcyBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRmdWxsYXJnc3BlYyhhbl9lc3RpbWF0b3JbMV0uZml0KSwgIyBmaXQgcGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5fZXN0aW1hdG9yWzFdKSkgIyBwYWNrYWdlLm1vZHVsZS5tb2RlbAoKICAgIG1vZGVsX2NvbmZpZ3MgPSBbXQoKICAgIGZvciBlc3RpbWF0b3IgaW4gZXN0aW1hdG9yX3NwZWNzOgogICAgICAgIG1vZGVsX2pzb24gPSB7Y2xhc3Nfa2V5OiB7fSwgZml0X2tleToge319CiAgICAgICAgZml0X3BhcmFtcyA9IHt9CgogICAgICAgIGZvciBpLCBrZXkgaW4gZW51bWVyYXRlKG1vZGVsX2pzb24ua2V5cygpKToKICAgICAgICAgICAgZiA9IGVzdGltYXRvcltpKzFdCiAgICAgICAgICAgIGFyZ3NfcGFpcmVkID0gW10KICAgICAgICAgICAgZGVmc19wYWlyZWQgPSBbXQoKICAgICAgICAgICAgIyByZXZlcnNlIHRoZSBhcmdzIHNpbmNlIHRoZXJlIGFyZSBmZXdlciBkZWZhdWx0cyB0aGFuIGFyZ3MKICAgICAgICAgICAgYXJncyA9IGYuYXJncwogICAgICAgICAgICBhcmdzLnJldmVyc2UoKQogICAgICAgICAgICBuX2FyZ3MgPSBsZW4oYXJncykKCiAgICAgICAgICAgIGRlZnMgPSBmLmRlZmF1bHRzCiAgICAgICAgICAgIGlmIGRlZnMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGRlZnMgPSBbZGVmc10KICAgICAgICAgICAgZGVmcyA9IGxpc3QoZGVmcykKICAgICAgICAgICAgZGVmcy5yZXZlcnNlKCkKICAgICAgICAgICAgbl9kZWZzID0gbGVuKGRlZnMpCgogICAgICAgICAgICBuX3NtYWxsZXN0ID0gbWluKG5fYXJncywgbl9kZWZzKQogICAgICAgICAgICBuX2xhcmdlc3QgPSBtYXgobl9hcmdzLCBuX2RlZnMpCgogICAgICAgICAgICAjIGJ1aWxkIDIgbGlzdHMgdGhhdCBjYW4gYmUgY29uY2F0ZW5hdGVkCiAgICAgICAgICAgIGZvciBpeCBpbiByYW5nZShuX3NtYWxsZXN0KToKICAgICAgICAgICAgICAgIGlmIGFyZ3NbaXhdIGlzIG5vdCAic2VsZiI6CiAgICAgICAgICAgICAgICAgICAgYXJnc19wYWlyZWQuYXBwZW5kKGFyZ3NbaXhdKQogICAgICAgICAgICAgICAgICAgIGRlZnNfcGFpcmVkLmFwcGVuZChkZWZzW2l4XSkKCiAgICAgICAgICAgIGZvciBpeCBpbiByYW5nZShuX3NtYWxsZXN0LCBuX2xhcmdlc3QpOgogICAgICAgICAgICAgICAgaWYgaXggaXMgbm90IDAgYW5kIGFyZ3NbaXhdIGlzIG5vdCAic2VsZiI6CiAgICAgICAgICAgICAgICAgICAgYXJnc19wYWlyZWQuYXBwZW5kKGFyZ3NbaXhdKQogICAgICAgICAgICAgICAgICAgIGRlZnNfcGFpcmVkLmFwcGVuZChOb25lKQogICAgICAgICAgICAgICAjIGNvbmNhdGVuYXRlIGxpc3RzIGludG8gYXBwcm9wcmlhdGUgc3RydWN0dXJlCiAgICAgICAgICAgIG1vZGVsX2pzb25ba2V5XSA9IGRpY3QoemlwKHJldmVyc2VkKGFyZ3NfcGFpcmVkKSwgcmV2ZXJzZWQoZGVmc19wYWlyZWQpKSkKCiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV0gPSB7fQogICAgICAgIG1vZGVsX2pzb25bbWV0YV9rZXldWyJza2xlYXJuX3ZlcnNpb24iXSA9IHNrdmVyc2lvbgogICAgICAgIG1vZGVsX2pzb25bbWV0YV9rZXldWyJjbGFzcyJdID0gIi4iLmpvaW4oW2VzdGltYXRvclszXS5fX21vZHVsZV9fLCBlc3RpbWF0b3JbMF1dKQogICAgICAgIG1vZGVsX2NvbmZpZ3MuYXBwZW5kKG1vZGVsX2pzb24pCiAgICBpZiBsZW4obW9kZWxfY29uZmlncykgPT0gMToKICAgICAgICAjIGRvIHdlIHdhbnQgdG8gbG9nIHRoaXMgbW9kaWZpZWQgbW9kZWwgYXMgYW4gYXJ0aWZhY3Q/CiAgICAgICAgcmV0dXJuIG1vZGVsX2NvbmZpZ3NbMF0KICAgIGVsc2U6CiAgICAgICAgIyBkbyB3ZSB3YW50IHRvIGxvZyB0aGlzIG1vZGlmaWVkIG1vZGVsIGFzIGFuIGFydGlmYWN0PwogICAgICAgIHJldHVybiBtb2RlbF9jb25maWdzCgpkZWYgdXBkYXRlX21vZGVsX2NvbmZpZygKICAgIGNvbmZpZzogZGljdCwKICAgIG5ld19jbGFzczogZGljdCwKICAgIG5ld19maXQ6IGRpY3QsCiAgICBjbGFzc19rZXk6IHN0ciA9ICJDTEFTUyIsCiAgICBmaXRfa2V5OiBzdHIgPSAiRklUIgopOgogICAgIiIiVXBkYXRlIG1vZGVsIGNvbmZpZyBqc29uCiAgICAKICAgIE5vdCB1c2VkIHVudGlsIHdlIHJlZmFjdG9yIGFzIHBlciB0aGUgVE9ETwogICAgICAgIAogICAgVGhpcyBmdW5jdGlvbiBpcyBlc3NlbnRpYWwgc2luY2UgdGhlcmUgYXJlIG1vZGlmaWNhdGlvbnMgaW4gY2xhc3MKICAgIGFuZCBmaXQgcGFyYW1zIHRoYXQgbXVzdCBiZSBtYWRlIChjYWxsYmFja3MgYXJlIGEgZ29vZCBleGFtcGxlLCB3aXRob3V0CiAgICB3aGljaCB0aGVyZSBpcyBubyB0cmFpbmluZyBoaXN0b3J5IGF2YWlsYWJsZSkKICAgIAogICAgVE9ETzogIGN1cnJlbnRseSBhIG1vZGVsIGNvbmZpZyBjb250YWlucyAyIGtleXMsIGJ1dCB0aGlzIHdpbGwgbGlrZWx5CiAgICBleHBhbmQgdG8gaW5jbHVkZSBvdGhlciBmdW5jdGlvbnMgYmV5b25kIGNsYXNzIGFuZCBmaXQuIFNvIG5lZWQgdG8gZXhwYW5kIAogICAgdGhpcyB0byBhIGxpc3Qgb2YgVHVwbGUoc3RyLCBkaWN0KSwgd2hlcmUgYHN0cmAgY29ycmVzcG9uZHMgdG8gYSBrZXkKICAgIGluIHRoZSBtb2RlbCBjb25maWcgYW5kIGBkaWN0YCBjb250YWlucyB0aGUgcGFyYW1zIGFuZCB0aGVpciBuZXcgdmFsdWVzLgogICAgCiAgICA6cGFyYW0gY29uZmlnOiAgICAgIG9yaWdpbmFsIG1vZGVsIGRlZmluaXRpb24gY29udGFpbmluZyAyIGtleXMsIENMQVNTIGFuZCBGSVQKICAgIDpwYXJhbSBuZXdfY2xhc3M6ICAgbmV3IGNsYXNzIGtleS12YWx1ZXMKICAgIDpwYXJhbSBuZXdfZml0OiAgICAgbmV3IGZpdCBrZXktdmFsdWVzCiAgICAiIiIKICAgIGNvbmZpZ1tjbGFzc19rZXldLnVwZGF0ZShuZXdfY2xhc3MpCiAgICBjb25maWdbZml0X2tleV0udXBkYXRlKG5ld19maXQpCiAgICAKICAgIHJldHVybiBjb25maWcKCmRlZiB0cmFpbl9tb2RlbCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbW9kZWxfcGtnX2NsYXNzOiBzdHIsCiAgICBkYXRhX2tleTogVW5pb25bRGF0YUl0ZW0sIHN0cl0sCiAgICBzYW1wbGU6IGludCwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgbW9kZWxfa2V5OiBzdHIgPSAibW9kZWwiLAogICAgdGVzdF9zaXplOiBmbG9hdCA9IDAuMDUsCiAgICB0cmFpbl92YWxfc3BsaXQ6IGZsb2F0ID0gMC43NSwKICAgIHRlc3Rfc2V0X2tleTogc3RyID0gInRlc3Rfc2V0IiwKICAgIHJuZzogaW50ID0gMSwKICAgIG1vZGVsc19kaXI6IHN0ciA9ICJtb2RlbHMiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgc2NvcmVfbWV0aG9kOiBzdHIgPSAibWljcm8iLAogICAgY2xhc3NfcGFyYW1zX3VwZGF0ZXM6IFVuaW9uW0RhdGFJdGVtLCBkaWN0XSA9IHt9LAogICAgZml0X3BhcmFtc191cGRhdGVzOiBVbmlvbltEYXRhSXRlbSwgZGljdF0gPSB7fSwKKSAtPiBOb25lOgogICAgIiIidHJhaW4gYSBjbGFzc2lmaWVyLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBtb2RlbF9wa2dfY2xhc3M6ICAgdGhlIG1vZGVsIHRvIHRyYWluLCBlLmcsICJza2xlYXJuLm5ldXJhbF9uZXR3b3Jrcy5NTFBDbGFzc2lmaWVyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGpzb24gbW9kZWwgY29uZmlnCiAgICA6cGFyYW0gZGF0YV9rZXk6ICAgICAgICAgICgicmF3IikgbmFtZSBvZiByYXcgZGF0YSBmaWxlCiAgICA6cGFyYW0gc2FtcGxlOiAgICAgICAgICAgIFNlbGVjdHMgdGhlIGZpcnN0IG4gcm93cywgb3Igc2VsZWN0IGEgc2FtcGxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0aW5nIGZyb20gdGhlIGZpcnN0LiBJZiBuZWdhdGl2ZSA8LTEsIHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHJhbmRvbSBzYW1wbGUKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgZ3JvdW5kLXRydXRoICh5KSBsYWJlbHMKICAgIDpwYXJhbSBtb2RlbF9rZXk6ICAgICAgICAgKCJtb2RlbCIpIG5hbWUgb2YgbW9kZWwgaW4gYXJ0aWZhY3Qgc3RvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyB0byBhIGRpcmVjdG9yeQogICAgOnBhcmFtIHRlc3Rfc2l6ZTogICAgICAgICAoMC4wNSkgdGVzdCBzZXQgc2l6ZQogICAgOnBhcmFtIHRyYWluX3ZhbF9zcGxpdDogICAoMC43NSkgT25jZSB0aGUgdGVzdCBzZXQgaGFzIGJlZW4gcmVtb3ZlZCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5pbmcgc2V0IGdldHMgdGhpcyBwcm9wb3J0aW9uLgogICAgOnBhcmFtIHRlc3Rfc2V0X2tleTogICAgICBzdG9yZSB0aGUgdGVzdCBkYXRhIHNldCB1bmRlciB0aGlzIGtleSBpbiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBybmc6ICAgICAgICAgICAgICAgKDEpIHNrbGVhcm4gcm5nIHNlZWQKICAgIDpwYXJhbSBtb2RlbHNfZGlyOiAgICAgICAgbW9kZWxzIHN1YmZvbGRlciBvbiBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICAgIHBsb3Qgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBzY29yZV9tZXRob2Q6ICAgICAgZm9yIG11bHRpY2xhc3MgY2xhc3NpZmljYXRpb24KICAgIDpwYXJhbSBjbGFzc191cGRhdGVzOiAgICAgdXBkYXRlIHRoZXNlIHNjaWtpdC1sZWFybiBjbGFzc2lmaWVyIHBhcmFtcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgYXMgYSBkaWN0CiAgICA6cGFyYW0gZml0X3VwZGF0ZXM6ICAgICAgIHVwZGF0ZSBzY2lraXQtbGVhcm4gZml0IHBhcmFtZXRlcnMsIGlucHV0IGFzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgZGljdC4KICAgICIiIgogICAgYmFzZV9wYXRoID0gY29udGV4dC5hcnRpZmFjdF9wYXRoCiAgICBvcy5tYWtlZGlycyhiYXNlX3BhdGgsIGV4aXN0X29rPVRydWUpCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBwbG90c19kaXIpLCBleGlzdF9vaz1UcnVlKQogICAgb3MubWFrZWRpcnMob3MucGF0aC5qb2luKGJhc2VfcGF0aCwgbW9kZWxzX2RpciksIGV4aXN0X29rPVRydWUpCiAgICAKICAgICMgZXh0cmFjdCBmaWxlIG5hbWUgZnJvbSBEYXRhSXRlbQogICAgc3JjZmlsZXBhdGggPSBzdHIoZGF0YV9rZXkpCiAgICAKICAgICMgVE9ETzogdGhpcyBzaG91bGQgYmUgcGFydCBvZiBkYXRhInMgbWV0YWRhdGEgZGVhbHQgd2l0aCBpbiBhbm90aGVyIHN0ZXAgZ2V0IGEgZGF0YSBzZXQsIHNhbXBsZSwgZXRjLi4uCiAgICAjIGdldCBhbGwgZGF0YSBvciBhIHNhbXBsZQogICAgaWYgKHNhbXBsZSA9PSAtMSkgb3IgKHNhbXBsZSA+PSAxKToKICAgICAgICAjIGdldCBhbGwgcm93cywgb3IgY29udGlndW91cyBzYW1wbGUgc3RhcnRpbmcgYXQgcm93IDEuCiAgICAgICAgcmF3ID0gcHEucmVhZF90YWJsZShzcmNmaWxlcGF0aCkudG9fcGFuZGFzKCkuZHJvcG5hKCkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKICAgICAgICByYXcgPSByYXcuaWxvY1s6c2FtcGxlLCA6XQogICAgICAgIGxhYmVscyA9IGxhYmVscy5pbG9jWzpzYW1wbGVdCiAgICBlbHNlOgogICAgICAgICMgZ3JhYiBhIHJhbmRvbSBzYW1wbGUKICAgICAgICByYXcgPSBwcS5yZWFkX3RhYmxlKHNyY2ZpbGVwYXRoKS50b19wYW5kYXMoKS5kcm9wbmEoKS5zYW1wbGUoc2FtcGxlICogLTEpCiAgICAgICAgbGFiZWxzID0gcmF3LnBvcChsYWJlbF9jb2x1bW4pCgogICAgIyBUT0RPOiB0aGlzIHNob3VsZCBiZSBwYXJ0IG9mIGRhdGEicyBtZXRhZGF0YSBkZWFsdCB3aXRoIGluIGFub3RoZXIgc3RlcAogICAgY29udGV4dC5oZWFkZXIgPSByYXcuY29sdW1ucy52YWx1ZXMKICAgIAogICAgIyBUT0RPOiBhbGwgb2YgdGhpcyBzaG91bGQgYmUgcGFydCBvZiBhIHNwaXR0ZXIgY29tcG9uZW50IHRoYXQgZG9lcyBjdiB0b28sIGRlYWx0IHdpdGggaW4gYW5vdGhlciBzdGVwCiAgICAjIG1ha2UgYSBob3QgZW5jb2RlIGNvcHkgb2YgbGFiZWxzIGJlZm9yZSB0aGUgc3BsaXQKICAgIHliID0gbGFiZWxfYmluYXJpemUobGFiZWxzLCBjbGFzc2VzPWxpc3QocmFuZ2UocmF3LnNoYXBlWzFdKSkpCiAgICAjIGRvdWJsZSBzcGxpdCB0byBnZW5lcmF0ZSAzIGRhdGEgc2V0czogdHJhaW4sIHZhbGlkYXRpb24gYW5kIHRlc3QKICAgICMgd2l0aCB4dGVzdCx5dGVzdCBzZXQgYXNpZGUKICAgIHgsIHh0ZXN0LCB5LCB5dGVzdCA9IHRyYWluX3Rlc3Rfc3BsaXQobnAuY29uY2F0ZW5hdGUoW3JhdywgeWJdLCBheGlzPTEpLCBsYWJlbHMsIHRlc3Rfc2l6ZT10ZXN0X3NpemUsIHJhbmRvbV9zdGF0ZT1ybmcpCiAgICB4dHJhaW4sIHh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KHgsIHksIHRyYWluX3NpemU9dHJhaW5fdmFsX3NwbGl0LCByYW5kb21fc3RhdGU9cm5nKQogICAgIyBleHRyYWN0IHRoZSBob3RfZW5jb2RlZCBsYWJlbHMKICAgIHl0cmFpbmIgPSB4dHJhaW5bOiwgLXliLnNoYXBlWzFdOl0uY29weSgpCiAgICB4dHJhaW4gPSB4dHJhaW5bOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpCiAgICAjIGV4dHJhY3QgdGhlIGhvdF9lbmNvZGVkIGxhYmVscwogICAgeXZhbGlkYiA9IHh2YWxpZFs6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh2YWxpZCA9IHh2YWxpZFs6LCA6LXliLnNoYXBlWzFdXS5jb3B5KCkKICAgICMgZXh0cmFjdCB0aGUgaG90X2VuY29kZWQgbGFiZWxzCiAgICB5dGVzdGIgPSB4dGVzdFs6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh0ZXN0ID0geHRlc3RbOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICMgc2V0LWFzaWRlIHRlc3Rfc2V0CiAgICB0ZXN0X3NldCA9IHBkLmNvbmNhdCgKICAgICAgICBbcGQuRGF0YUZyYW1lKGRhdGE9eHRlc3QsIGNvbHVtbnM9Y29udGV4dC5oZWFkZXIpLAogICAgICAgICBwZC5EYXRhRnJhbWUoZGF0YT15dGVzdC52YWx1ZXMsIGNvbHVtbnM9W2xhYmVsX2NvbHVtbl0pXSwKICAgICAgICBheGlzPTEsKQogICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCB0ZXN0X3NldF9rZXkgKyAiLnBxdCIpCiAgICB0ZXN0X3NldC50b19wYXJxdWV0KGZpbGVwYXRoLCBpbmRleD1GYWxzZSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KHRlc3Rfc2V0X2tleSwgbG9jYWxfcGF0aD10ZXN0X3NldF9rZXkgKyAiLnBxdCIpCgogICAgaWYgbW9kZWxfcGtnX2NsYXNzLmVuZHN3aXRoKCIuanNvbiIpOgogICAgICAgIG1vZGVsX2NvbmZpZyA9IGpzb24ubG9hZChvcGVuKG1vZGVsX3BrZ19jbGFzcywgInIiKSkKICAgIGVsc2U6CiAgICAgICAgIyBsb2FkIHRoZSBtb2RlbCBjb25maWcKICAgICAgICBtb2RlbF9jb25maWcgPSBnZXRfbW9kZWxfY29uZmlncyhtb2RlbF9wa2dfY2xhc3MpCgogICAgIyBnZXQgdXBkYXRlIHBhcmFtcyBpZiBhbnkKICAgIGlmIGlzaW5zdGFuY2UoY2xhc3NfcGFyYW1zX3VwZGF0ZXMsIERhdGFJdGVtKToKICAgICAgICBjbGFzc19wYXJhbXNfdXBkYXRlcyA9IGpzb24ubG9hZHMoY2xhc3NfcGFyYW1zX3VwZGF0ZXMuZ2V0KCkpCiAgICBpZiBpc2luc3RhbmNlKGZpdF9wYXJhbXNfdXBkYXRlcywgRGF0YUl0ZW0pOgogICAgICAgIGZpdF9wYXJhbXNfdXBkYXRlcyA9IGpzb24ubG9hZHMoZml0X3BhcmFtc191cGRhdGVzLmdldCgpKQogICAgIyB1cGRhdGUgdGhlIHBhcmFtZXRlcnMgICAgICAgICAgICAKICAgICMgYWRkIGRhdGEgdG8gZml0IHBhcmFtcwogICAgZml0X3BhcmFtc191cGRhdGVzLnVwZGF0ZSh7IlgiOiB4dHJhaW4sInkiOiB5dHJhaW4udmFsdWVzfSkKICAgIAogICAgbW9kZWxfY29uZmlnWyJDTEFTUyJdLnVwZGF0ZShjbGFzc19wYXJhbXNfdXBkYXRlcykKICAgIG1vZGVsX2NvbmZpZ1siRklUIl0udXBkYXRlKGZpdF9wYXJhbXNfdXBkYXRlcykKICAgIAogICAgIyBjcmVhdGUgY2xhc3MgYW5kIGZpdAogICAgQ2xhc3NpZmllckNsYXNzID0gX2NyZWF0ZV9jbGFzcyhtb2RlbF9jb25maWdbIk1FVEEiXVsiY2xhc3MiXSkKICAgIG1vZGVsID0gQ2xhc3NpZmllckNsYXNzKCoqbW9kZWxfY29uZmlnWyJDTEFTUyJdKQogICAgbW9kZWwuZml0KCoqbW9kZWxfY29uZmlnWyJGSVQiXSkKCiAgICAjIHNhdmUgbW9kZWwKICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKGJhc2VfcGF0aCwgZiJ7bW9kZWxzX2Rpcn0ve21vZGVsX2tleX0ucGtsIikKICAgIHRyeToKICAgICAgICBkdW1wKG1vZGVsLCBvcGVuKGZpbGVwYXRoLCAid2IiKSkKICAgICAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChtb2RlbF9rZXksIGxvY2FsX3BhdGg9bW9kZWxzX2RpcikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludCgiU0VSSUFMSVpFIE1PREVMIEVSUk9SOiIsIHN0cihlKSkKCiAgICAjIGNvbXB1dGUgdmFsaWRhdGlvbiBtZXRyaWNzCiAgICB5cHJlZCA9IG1vZGVsLnByZWRpY3QoeHZhbGlkKQogICAgeV9zY29yZSA9IG1vZGVsLnByZWRpY3RfcHJvYmEoeHZhbGlkKQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmInlfc2NvcmUuc2hhcGUge3lfc2NvcmUuc2hhcGV9IikKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJ5dmFsaWRiLnNoYXBlIHt5dmFsaWRiLnNoYXBlfSIpCiAgICBhdmVyYWdlX3ByZWNpc2lvbiA9IG1ldHJpY3MuYXZlcmFnZV9wcmVjaXNpb25fc2NvcmUoeXZhbGlkYls6LDotMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeV9zY29yZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkKCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhY2N1cmFjeSIsIGZsb2F0KG1vZGVsLnNjb3JlKHh2YWxpZCwgeXZhbGlkKSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCBtZXRyaWNzLnJvY19hdWNfc2NvcmUoeXZhbGlkYiwgeV9zY29yZSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJmMV9zY29yZSIsIG1ldHJpY3MuZjFfc2NvcmUoeXZhbGlkLCB5cHJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZT1zY29yZV9tZXRob2QpKQogICAgY29udGV4dC5sb2dfcmVzdWx0KGYiYXZnX3ByZWNzY29yZSIsIGF2ZXJhZ2VfcHJlY2lzaW9uKQoKICAgICMgdmFsaWRhdGlvbiBwbG90cwogICAgCiAgICBwbG90X3JvYyhjb250ZXh0LCB5dmFsaWRiLCB5X3Njb3JlKQogICAgcGxvdF9jb25mdXNpb25fbWF0cml4KGNvbnRleHQsIHl2YWxpZCwgeXByZWQsIGtleT0iY29uZnVzaW9uIiwgZm10PSJwbmciKQoKZGVmIHBsb3Rfcm9jKAogICAgY29udGV4dCwKICAgIHlfbGFiZWxzLAogICAgeV9wcm9icywKICAgIGtleT0icm9jIiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIiwKICAgIGZtdD0icG5nIiwKICAgIHhfbGFiZWw6IHN0ciA9ICJmYWxzZSBwb3NpdGl2ZSByYXRlIiwKICAgIHlfbGFiZWw6IHN0ciA9ICAidHJ1ZSBwb3NpdGl2ZSByYXRlIiwKICAgIHRpdGxlOiBzdHIgPSAicm9jIGN1cnZlIiwKICAgIGxlZ2VuZF9sb2M6IHN0ciA9ICJiZXN0IgopOgogICAgIiIicGxvdCByb2MgY3VydmVzCiAgICAKICAgIFRPRE86ICBhZGQgYXZlcmFnaW5nIG1ldGhvZCAoYXMgc3RyaW5nKSB0aGF0IHdhcyB1c2VkIHRvIGNyZWF0ZSBwcm9icywgCiAgICBkaXNwbGF5IGluIGxlZ2VuZAogICAgCiAgICA6cGFyYW0gY29udGV4dDogICAgICB0aGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIHlfbGFiZWxzOiAgICAgZ3JvdW5kIHRydXRoIGxhYmVscywgaG90IGVuY29kZWQgZm9yIG11bHRpY2xhc3MgIAogICAgOnBhcmFtIHlfcHJvYnM6ICAgICAgbW9kZWwgcHJlZGljdGlvbiBwcm9iYWJpbGl0aWVzCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICAoInJvYyIpIGtleSBvZiBwbG90IGluIGFydGlmYWN0IHN0b3JlCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAoInBsb3RzIikgZGVzdGluYXRpb24gZm9sZGVyIHJlbGF0aXZlIHBhdGggdG8gYXJ0aWZhY3QgcGF0aAogICAgOnBhcmFtIGZtdDogICAgICAgICAgKCJwbmciKSBwbG90IGZvcm1hdAogICAgOnBhcmFtIHhfbGFiZWw6ICAgICAgKCJmYWxzZSBwb3NpdGl2ZSByYXRlIikgeC1heGlzIGxhYmVscwogICAgOnBhcmFtIHlfbGFiZWw6ICAgICAgKCJ0cnVlIHBvc2l0aXZlIHJhdGUiKSB5LWF4aXMgbGFiZWxzCiAgICA6cGFyYW0gdGl0bGU6ICAgICAgICAoInJvYyBjdXJ2ZSIpIHRpdGxlIG9mIHBsb3QKICAgIDpwYXJhbSBsZWdlbmRfbG9jOiAgICgiYmVzdCIpIGxvY2F0aW9uIG9mIHBsb3QgbGVnZW5kCiAgICAiIiIKICAgICMgZG9uInQgYm90aGVyIGlmIHRoaXMgZG9lc24idCB3b3JrCiAgICBhc3NlcnQgeV9wcm9icy5zaGFwZSA9PSB5X2xhYmVsc1s6LDotMV0uc2hhcGUKICAgIAogICAgIyBjbGVhciBtYXRwbG90bGliIGN1cnJlbnQgZmlndXJlCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgIyBkYXRhIGFjY3VtbXVsYXRvcnMgYnkgY2xhc3MKICAgIGZwciA9IGRpY3QoKQogICAgdHByID0gZGljdCgpCiAgICByb2NfYXVjID0gZGljdCgpCiAgICAKICAgICMgZHJhdyA0NSBkZWdyZWUgbGluZQogICAgcGx0LnBsb3QoWzAsIDFdLCBbMCwgMV0sICJrLS0iKQogICAgCiAgICAjIGxhYmVsbGluZwogICAgcGx0LnhsYWJlbCh4X2xhYmVsKQogICAgcGx0LnlsYWJlbCh5X2xhYmVsKQogICAgcGx0LnRpdGxlKHRpdGxlKQogICAgcGx0LmxlZ2VuZChsb2M9bGVnZW5kX2xvYykKICAgIAogICAgIyBzaW5nbGUgUk9DIG9yIG11dGxpcGxlCiAgICBmb3IgaSBpbiByYW5nZSh5X2xhYmVsc1s6LDotMV0uc2hhcGVbMV0pOgogICAgICAgIGZwcltpXSwgdHByW2ldLCBfID0gbWV0cmljcy5yb2NfY3VydmUoeV9sYWJlbHNbOiwgaV0sIHlfcHJvYnNbOiwgaV0sIHBvc19sYWJlbD0xKQogICAgICAgIHJvY19hdWNbaV0gPSBtZXRyaWNzLmF1YyhmcHJbaV0sIHRwcltpXSkKICAgICAgICBwbHQucGxvdChmcHJbaV0sIHRwcltpXSwgbGFiZWw9ZiJjbGFzcyB7aX0iKQoKICAgIGZuYW1lID0gZiJ7cGxvdHNfZGlyfS97a2V5fS57Zm10fSIKICAgIHBsdC5zYXZlZmlnKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIGZuYW1lKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChrZXksIGJvZHk9cGx0LmdjZigpKSwgbG9jYWxfcGF0aD1mbmFtZSkKICAgIAoKZGVmIHBsb3RfY29uZnVzaW9uX21hdHJpeCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbGFiZWxzLAogICAgcHJlZGljdGlvbnMsCiAgICBrZXk6IHN0ciA9ICJjb25mdXNpb25fbWF0cml4IiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIiwKICAgIGNvbG9ybWFwOiBzdHIgPSAiQmx1ZXMiLAogICAgZm10OiBzdHIgPSAicG5nIiwKICAgIHNhbXBsZV93ZWlnaHQ9Tm9uZQopOgogICAgIiIiQ3JlYXRlIGEgY29uZnVzaW9uIG1hdHJpeC4KICAgIFBsb3QgYW5kIHNhdmUgYSBjb25mdXNpb24gbWF0cml4IHVzaW5nIHRlc3QgZGF0YSBmcm9tIGEKICAgIG1vZGVsbGluZSBzdGVwLgogICAgCiAgICBTZWUgaHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnL3N0YWJsZS9tb2R1bGVzL2dlbmVyYXRlZC9za2xlYXJuLm1ldHJpY3MuY29uZnVzaW9uX21hdHJpeC5odG1sCiAgICAKICAgIFRPRE86IGZpeCBsYWJlbCBhbGlnbm1lbnQKICAgIFRPRE86IGNvbnNpZGVyIHVzaW5nIGFub3RoZXIgcGFja2FnZWQgdmVyc2lvbgogICAgVE9ETzogcmVmYWN0b3IgdG8gdGFrZSBwYXJhbXMgZGljdCBmb3IgcGxvdCBvcHRpb25zCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIGxhYmVsczogICAgICAgICAgdmFsaWRhdGlvbiBkYXRhIGdyb3VuZC10cnV0aCBsYWJlbHMKICAgIDpwYXJhbSBwcmVkaWN0aW9uczogICAgIHZhbGlkYXRpb24gZGF0YSBwcmVkaWN0aW9ucwogICAgOnBhcmFtIGtleTogICAgICAgICAgICAgc3RyCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICByZWxhdGl2ZSBwYXRoIG9mIHBsb3RzIGluIGFydGlmYWN0IHN0b3JlCiAgICA6cGFyYW0gY29sb3JtYXA6ICAgICAgICBjb2xvdXJtYXAgZm9yIGNvbmZ1c2lvbiBtYXRyaXgKICAgIDpwYXJhbSBmbXQ6ICAgICAgICAgICAgIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0gc2FtcGxlX3dlaWdodDogICBzYW1wbGUgd2VpZ2h0cwogICAgIiIiCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgY20gPSBtZXRyaWNzLmNvbmZ1c2lvbl9tYXRyaXgobGFiZWxzLCBwcmVkaWN0aW9ucywgc2FtcGxlX3dlaWdodD1Ob25lKQogICAgc25zLmhlYXRtYXAoY20sIGFubm90PVRydWUsIGNtYXA9Y29sb3JtYXAsIHNxdWFyZT1UcnVlKQoKICAgIGZpZyA9IHBsdC5nY2YoKQogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9LntmbXR9IgogICAgZmlnLnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZm5hbWUpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1maWcpLCBsb2NhbF9wYXRoPWZuYW1lKQo=
    commands: []
    code_origin: /User/functions/sklearn_classifier/function.yaml
