kind: job
metadata:
  name: sklearn-classifier
  tag: ''
  hash: a804b94a183b9af78e8114ffa2420aa4e0128025
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: train_model
  description: ''
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gaW1wb3J0bGliIGltcG9ydCBpbXBvcnRfbW9kdWxlCmZyb20gaW5zcGVjdCBpbXBvcnQgZ2V0ZnVsbGFyZ3NwZWMsIEZ1bGxBcmdTcGVjCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAsIGxvYWQKaW1wb3J0IGl0ZXJ0b29scwoKaW1wb3J0IHNrbGVhcm4KaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgcHlhcnJvdyBhcyBwYQppbXBvcnQgcHlhcnJvdy5wYXJxdWV0IGFzIHBxCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBzZWFib3JuIGFzIHNucwoKZnJvbSBza2xlYXJuLnV0aWxzLnRlc3RpbmcgaW1wb3J0IGFsbF9lc3RpbWF0b3JzCmZyb20gc2tsZWFybi5kYXRhc2V0cyBpbXBvcnQgbWFrZV9jbGFzc2lmaWNhdGlvbgpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgbGFiZWxfYmluYXJpemUKZnJvbSBza2xlYXJuLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgdHJhaW5fdGVzdF9zcGxpdApmcm9tIHNrbGVhcm4gaW1wb3J0IG1ldHJpY3MKCmZyb20gdHlwaW5nIGltcG9ydCBVbmlvbiwgTGlzdCwgQW55LCBPcHRpb25hbApmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QKCnNrdmVyc2lvbiA9IHNrbGVhcm4uX192ZXJzaW9uX18KCmltcG9ydCB3YXJuaW5ncwoKd2FybmluZ3Muc2ltcGxlZmlsdGVyKGFjdGlvbj0iaWdub3JlIiwgY2F0ZWdvcnk9RnV0dXJlV2FybmluZykKCgpkZWYgX2djZl9jbGVhcihwbHQpOgogICAgIiIiVXRpbGl0eSB0byBjbGVhciBtYXRwbG90bGliIGZpZ3VyZQoKICAgIFJ1biB0aGlzIGluc2lkZSBldmVyeSBwbG90IG1ldGhvZCBiZWZvcmUgY2FsbGluZyBhbnkgbWF0cGxvdGxpYgogICAgbWV0aG9kcwoKICAgIDpwYXJhbSBwbG90OiAgICBtYXRsb2JsaWIgZmlndXJlIG9iamVjdAogICAgIiIiCiAgICBwbHQuY2xhKCkKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKCgpkZWYgX2NyZWF0ZV9jbGFzcyhwa2dfY2xhc3M6IHN0cik6CiAgICAiIiJDcmVhdGUgYSBjbGFzcyBmcm9tIGEgcGFja2FnZS5tb2R1bGUuY2xhc3Mgc3RyaW5nCgogICAgOnBhcmFtIHBrZ19jbGFzczogIGZ1bGwgY2xhc3MgbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgZS5nLiAic2tsZWFybi5tb2RlbF9zZWxlY3Rpb24uR3JvdXBLRm9sZCIKICAgICIiIgogICAgc3BsaXRzID0gcGtnX2NsYXNzLnNwbGl0KCIuIikKICAgIGNsZmNsYXNzID0gc3BsaXRzWy0xXQogICAgcGtnX21vZHVsZSA9IHNwbGl0c1s6LTFdCiAgICBjbGFzc18gPSBnZXRhdHRyKGltcG9ydF9tb2R1bGUoIi4iLmpvaW4ocGtnX21vZHVsZSkpLCBjbGZjbGFzcykKICAgIHJldHVybiBjbGFzc18KCmRlZiBfY3JlYXRlX2Z1bmN0aW9uKHBrZ19mdW5jOiBsaXN0KToKICAgICIiIkNyZWF0ZSBhIGZ1bmN0aW9uIGZyb20gYSBwYWNrYWdlLm1vZHVsZS5mdW5jdGlvbiBzdHJpbmcKCiAgICA6cGFyYW0gcGtnX2Z1bmM6ICBmdWxsIGZ1bmN0aW9uIGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgZS5nLiAic2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbi5mX2NsYXNzaWYiCiAgICAiIiIKICAgIHNwbGl0cyA9IHBrZ19mdW5jLnNwbGl0KCIuIikKICAgIHBrZ19tb2R1bGUgPSAiLiIuam9pbihzcGxpdHNbOi0xXSkKICAgIGNiX2ZuYW1lID0gc3BsaXRzWy0xXQogICAgcGtnX21vZHVsZSA9IF9faW1wb3J0X18ocGtnX21vZHVsZSwgZnJvbWxpc3Q9W2NiX2ZuYW1lXSkKICAgIGZ1bmN0aW9uXyA9IGdldGF0dHIocGtnX21vZHVsZSwgY2JfZm5hbWUpCiAgICByZXR1cm4gZnVuY3Rpb25fCgpkZWYgZ2V0X21vZGVsX2NvbmZpZ3MoCiAgICBteV9tb2RlbHM6IFVuaW9uW3N0ciwgTGlzdFtzdHJdXSwKICAgIGNsYXNzX2tleSA9ICJDTEFTUyIsCiAgICBmaXRfa2V5ID0gIkZJVCIsCiAgICBtZXRhX2tleSA9ICJNRVRBIiwKKSAtPiBVbmlvbltkaWN0LCBMaXN0W2RpY3RdXToKICAgICIiImJ1aWxkIHNrbGVhcm4gbW9kZWwgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzCiAgICAKICAgIFRha2UgKGZ1bGwpIGNsYXNzIG5hbWUgb2YgYW4gc2Npa2l0LWxlYXJuIG1vZGVsIAogICAgYW5kIHJldHJpZXZlIGl0cyBgY2xhc3NgIGFuZCBgZml0YCBwYXJhbWV0ZXJzIGFuZAogICAgdGhlaXIgZGVmYXVsdCB2YWx1ZXMuCiAgICAKICAgIEFsc28gcmV0dXJucyBzb21lIHVzZWZ1bCBtZXRhZGF0YSB2YWx1ZXMgZm9yIHRoZSBjbGFzcwogICAgIiIiCiAgICAjIGdldCBhIGxpc3Qgb2YgYWxsIHNrbGVhcm4gZXN0aW1hdG9ycwogICAgZXN0aW1hdG9ycyA9IGFsbF9lc3RpbWF0b3JzKCkKICAgIGRlZiBfZ2V0X2VzdGltYXRvcihwa2dfY2xhc3MpOgogICAgICAgICIiImZpbmQgYSBzcGVjaWZpYyBjbGFzcyBpbiBhIGxpc3Qgb2Ygc2tsZWFybiBlc3RpbWF0b3JzIiIiCiAgICAgICAgbXlfY2xhc3MgPSBwa2dfY2xhc3Muc3BsaXQoJy4nKVstMV0KICAgICAgICByZXR1cm4gbGlzdChmaWx0ZXIobGFtYmRhIHg6IHhbMF0gPT0gbXlfY2xhc3MsIGVzdGltYXRvcnMpKVswXQoKICAgICMgZmluZCBlc3RpbWF0b3JzIGNvcnJlc3BvbmRpbmcgdG8gbXlfbW9kZWxzIGxpc3QKICAgIG15X2VzdGltYXRvcnMgPSBbXQogICAgbXlfbW9kZWxzID0gW215X21vZGVsc10gaWYgaXNpbnN0YW5jZShteV9tb2RlbHMsIHN0cikgZWxzZSBteV9tb2RlbHMKICAgIGZvciBtb2RlbCBpbiBteV9tb2RlbHM6CiAgICAgICAgZXN0aW1hdG9yX25hbWUsIGVzdGltYXRvcl9jbGFzcyA9IF9nZXRfZXN0aW1hdG9yKG1vZGVsKQogICAgICAgIG15X2VzdGltYXRvcnMuYXBwZW5kKChlc3RpbWF0b3JfbmFtZSwgZXN0aW1hdG9yX2NsYXNzKSkKCiAgICAjIGdldCBjbGFzcyBhbmQgZml0IHNwZWNzCiAgICBlc3RpbWF0b3Jfc3BlY3MgPSBbXQogICAgZm9yIGFuX2VzdGltYXRvciBpbiBteV9lc3RpbWF0b3JzOgogICAgICAgIGVzdGltYXRvcl9zcGVjcy5hcHBlbmQoKGFuX2VzdGltYXRvclswXSwgIyBtb2RlbCBvbmx5IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRmdWxsYXJnc3BlYyhhbl9lc3RpbWF0b3JbMV0pLCAjIGNsYXNzIHBhcmFtcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGZ1bGxhcmdzcGVjKGFuX2VzdGltYXRvclsxXS5maXQpLCAjIGZpdCBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbl9lc3RpbWF0b3JbMV0pKSAjIHBhY2thZ2UubW9kdWxlLm1vZGVsCgogICAgbW9kZWxfY29uZmlncyA9IFtdCgogICAgZm9yIGVzdGltYXRvciBpbiBlc3RpbWF0b3Jfc3BlY3M6CiAgICAgICAgbW9kZWxfanNvbiA9IHtjbGFzc19rZXk6IHt9LCBmaXRfa2V5OiB7fX0KICAgICAgICBmaXRfcGFyYW1zID0ge30KCiAgICAgICAgZm9yIGksIGtleSBpbiBlbnVtZXJhdGUobW9kZWxfanNvbi5rZXlzKCkpOgogICAgICAgICAgICBmID0gZXN0aW1hdG9yW2krMV0KICAgICAgICAgICAgYXJnc19wYWlyZWQgPSBbXQogICAgICAgICAgICBkZWZzX3BhaXJlZCA9IFtdCgogICAgICAgICAgICAjIHJldmVyc2UgdGhlIGFyZ3Mgc2luY2UgdGhlcmUgYXJlIGZld2VyIGRlZmF1bHRzIHRoYW4gYXJncwogICAgICAgICAgICBhcmdzID0gZi5hcmdzCiAgICAgICAgICAgIGFyZ3MucmV2ZXJzZSgpCiAgICAgICAgICAgIG5fYXJncyA9IGxlbihhcmdzKQoKICAgICAgICAgICAgZGVmcyA9IGYuZGVmYXVsdHMKICAgICAgICAgICAgaWYgZGVmcyBpcyBOb25lOgogICAgICAgICAgICAgICAgZGVmcyA9IFtkZWZzXQogICAgICAgICAgICBkZWZzID0gbGlzdChkZWZzKQogICAgICAgICAgICBkZWZzLnJldmVyc2UoKQogICAgICAgICAgICBuX2RlZnMgPSBsZW4oZGVmcykKCiAgICAgICAgICAgIG5fc21hbGxlc3QgPSBtaW4obl9hcmdzLCBuX2RlZnMpCiAgICAgICAgICAgIG5fbGFyZ2VzdCA9IG1heChuX2FyZ3MsIG5fZGVmcykKCiAgICAgICAgICAgICMgYnVpbGQgMiBsaXN0cyB0aGF0IGNhbiBiZSBjb25jYXRlbmF0ZWQKICAgICAgICAgICAgZm9yIGl4IGluIHJhbmdlKG5fc21hbGxlc3QpOgogICAgICAgICAgICAgICAgaWYgYXJnc1tpeF0gaXMgbm90ICJzZWxmIjoKICAgICAgICAgICAgICAgICAgICBhcmdzX3BhaXJlZC5hcHBlbmQoYXJnc1tpeF0pCiAgICAgICAgICAgICAgICAgICAgZGVmc19wYWlyZWQuYXBwZW5kKGRlZnNbaXhdKQoKICAgICAgICAgICAgZm9yIGl4IGluIHJhbmdlKG5fc21hbGxlc3QsIG5fbGFyZ2VzdCk6CiAgICAgICAgICAgICAgICBpZiBpeCBpcyBub3QgMCBhbmQgYXJnc1tpeF0gaXMgbm90ICJzZWxmIjoKICAgICAgICAgICAgICAgICAgICBhcmdzX3BhaXJlZC5hcHBlbmQoYXJnc1tpeF0pCiAgICAgICAgICAgICAgICAgICAgZGVmc19wYWlyZWQuYXBwZW5kKE5vbmUpCiAgICAgICAgICAgICAgICMgY29uY2F0ZW5hdGUgbGlzdHMgaW50byBhcHByb3ByaWF0ZSBzdHJ1Y3R1cmUKICAgICAgICAgICAgbW9kZWxfanNvbltrZXldID0gZGljdCh6aXAocmV2ZXJzZWQoYXJnc19wYWlyZWQpLCByZXZlcnNlZChkZWZzX3BhaXJlZCkpKQoKICAgICAgICBtb2RlbF9qc29uW21ldGFfa2V5XSA9IHt9CiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV1bJ3NrbGVhcm5fdmVyc2lvbiddID0gc2t2ZXJzaW9uCiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV1bJ2NsYXNzJ10gPSAnLicuam9pbihbZXN0aW1hdG9yWzNdLl9fbW9kdWxlX18sIGVzdGltYXRvclswXV0pCiAgICAgICAgbW9kZWxfY29uZmlncy5hcHBlbmQobW9kZWxfanNvbikKICAgIGlmIGxlbihtb2RlbF9jb25maWdzKSA9PSAxOgogICAgICAgICMgZG8gd2Ugd2FudCB0byBsb2cgdGhpcyBtb2RpZmllZCBtb2RlbCBhcyBhbiBhcnRpZmFjdD8KICAgICAgICByZXR1cm4gbW9kZWxfY29uZmlnc1swXQogICAgZWxzZToKICAgICAgICAjIGRvIHdlIHdhbnQgdG8gbG9nIHRoaXMgbW9kaWZpZWQgbW9kZWwgYXMgYW4gYXJ0aWZhY3Q/CiAgICAgICAgcmV0dXJuIG1vZGVsX2NvbmZpZ3MKCmRlZiB1cGRhdGVfbW9kZWxfY29uZmlnKAogICAgY29uZmlnOiBkaWN0LAogICAgbmV3X2NsYXNzOiBkaWN0LAogICAgbmV3X2ZpdDogZGljdCwKICAgIGNsYXNzX2tleTogc3RyID0gIkNMQVNTIiwKICAgIGZpdF9rZXk6IHN0ciA9ICJGSVQiCik6CiAgICAiIiJVcGRhdGUgbW9kZWwgY29uZmlnIGpzb24KICAgICAgICAKICAgIFRoaXMgZnVuY3Rpb24gaXMgZXNzZW50aWFsIHNpbmNlIHRoZXJlIGFyZSBtb2RpZmljYXRpb25zIGluIGNsYXNzCiAgICBhbmQgZml0IHBhcmFtcyB0aGF0IG11c3QgYmUgbWFkZSAoY2FsbGJhY2tzIGFyZSBhIGdvb2QgZXhhbXBsZSwgd2l0aG91dAogICAgd2hpY2ggdGhlcmUgaXMgbm8gdHJhaW5pbmcgaGlzdG9yeSBhdmFpbGFibGUpCiAgICAKICAgIFRPRE86ICBjdXJyZW50bHkgYSBtb2RlbCBjb25maWcgY29udGFpbnMgMiBrZXlzLCBidXQgdGhpcyB3aWxsIGxpa2VseQogICAgZXhwYW5kIHRvIGluY2x1ZGUgb3RoZXIgZnVuY3Rpb25zIGJleW9uZCBjbGFzcyBhbmQgZml0LiBTbyBuZWVkIHRvIGV4cGFuZCAKICAgIHRoaXMgdG8gYSBsaXN0IG9mIFR1cGxlKHN0ciwgZGljdCksIHdoZXJlIGBzdHJgIGNvcnJlc3BvbmRzIHRvIGEga2V5CiAgICBpbiB0aGUgbW9kZWwgY29uZmlnIGFuZCBgZGljdGAgY29udGFpbnMgdGhlIHBhcmFtcyBhbmQgdGhlaXIgbmV3IHZhbHVlcy4KICAgIAogICAgOnBhcmFtIGNvbmZpZzogICAgICBvcmlnaW5hbCBtb2RlbCBkZWZpbml0aW9uIGNvbnRhaW5pbmcgMiBrZXlzLCBDTEFTUyBhbmQgRklUCiAgICA6cGFyYW0gbmV3X2NsYXNzOiAgIG5ldyBjbGFzcyBrZXktdmFsdWVzCiAgICA6cGFyYW0gbmV3X2ZpdDogICAgIG5ldyBmaXQga2V5LXZhbHVlcwogICAgIiIiCiAgICBjb25maWdbY2xhc3Nfa2V5XS51cGRhdGUobmV3X2NsYXNzKQogICAgY29uZmlnW2ZpdF9rZXldLnVwZGF0ZShuZXdfZml0KQogICAgCiAgICByZXR1cm4gY29uZmlnCgpkZWYgdHJhaW5fbW9kZWwoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsX3BrZ19jbGFzczogc3RyLAogICAgZGF0YV9rZXk6IFVuaW9uW0RhdGFJdGVtLCBzdHJdLAogICAgc2FtcGxlOiBpbnQsCiAgICBsYWJlbF9jb2x1bW46IHN0ciwKICAgIG1vZGVsX2tleTogc3RyID0gIm1vZGVsIiwKICAgIHRlc3Rfc2l6ZTogZmxvYXQgPSAwLjA1LAogICAgdHJhaW5fdmFsX3NwbGl0OiBmbG9hdCA9IDAuNzUsCiAgICB0ZXN0X3NldF9rZXk6IHN0ciA9ICJ0ZXN0X3NldCIsCiAgICBybmc6IGludCA9IDEsCiAgICBtb2RlbHNfZGlyOiBzdHIgPSAibW9kZWxzIiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIiwKICAgIHNjb3JlX21ldGhvZDogc3RyID0gIm1pY3JvIiwKICAgIGNsYXNzX3BhcmFtc191cGRhdGVzOiBVbmlvbltEYXRhSXRlbSwgZGljdF0gPSB7fSwKICAgIGZpdF9wYXJhbXNfdXBkYXRlczogVW5pb25bRGF0YUl0ZW0sIGRpY3RdID0ge30sCikgLT4gTm9uZToKICAgICIiInRyYWluIGEgY2xhc3NpZmllci4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbW9kZWxfcGtnX2NsYXNzOiAgIHRoZSBtb2RlbCB0byB0cmFpbiwgZS5nLCAnc2tsZWFybi5uZXVyYWxfbmV0d29ya3MuTUxQQ2xhc3NpZmllcicKICAgIDpwYXJhbSBkYXRhX2tleTogICAgICAgICAgKCJyYXciKSBuYW1lIG9mIHJhdyBkYXRhIGZpbGUKICAgIDpwYXJhbSBzYW1wbGU6ICAgICAgICAgICAgU2VsZWN0cyB0aGUgZmlyc3QgbiByb3dzLCBvciBzZWxlY3QgYSBzYW1wbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRpbmcgZnJvbSB0aGUgZmlyc3QuIElmIG5lZ2F0aXZlIDwtMSwgc2VsZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgcmFuZG9tIHNhbXBsZQogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgICBncm91bmQtdHJ1dGggKHkpIGxhYmVscwogICAgOnBhcmFtIG1vZGVsX2tleTogICAgICAgICAoJ21vZGVsJykgbmFtZSBvZiBtb2RlbCBpbiBhcnRpZmFjdCBzdG9yZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzIHRvIGEgZGlyZWN0b3J5CiAgICA6cGFyYW0gdGVzdF9zaXplOiAgICAgICAgICgwLjA1KSB0ZXN0IHNldCBzaXplCiAgICA6cGFyYW0gdHJhaW5fdmFsX3NwbGl0OiAgICgwLjc1KSBPbmNlIHRoZSB0ZXN0IHNldCBoYXMgYmVlbiByZW1vdmVkIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbmluZyBzZXQgZ2V0cyB0aGlzIHByb3BvcnRpb24uCiAgICA6cGFyYW0gdGVzdF9zZXRfa2V5OiAgICAgIHN0b3JlIHRoZSB0ZXN0IGRhdGEgc2V0IHVuZGVyIHRoaXMga2V5IGluIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIHJuZzogICAgICAgICAgICAgICAoMSkgc2tsZWFybiBybmcgc2VlZAogICAgOnBhcmFtIG1vZGVsc19kaXI6ICAgICAgICBtb2RlbHMgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgICAgcGxvdCBzdWJmb2xkZXIgb24gYXJ0aWZhY3QgcGF0aAogICAgOnBhcmFtIHNjb3JlX21ldGhvZDogICAgICBmb3IgbXVsdGljbGFzcyBjbGFzc2lmaWNhdGlvbgogICAgOnBhcmFtIGNsYXNzX3VwZGF0ZXM6ICAgICB1cGRhdGUgdGhlc2Ugc2Npa2l0LWxlYXJuIGNsYXNzaWZpZXIgcGFyYW1zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dCBhcyBhIGRpY3QKICAgIDpwYXJhbSBmaXRfdXBkYXRlczogICAgICAgdXBkYXRlIHNjaWtpdC1sZWFybiBmaXQgcGFyYW1ldGVycywgaW5wdXQgYXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBkaWN0LgogICAgIiIiCiAgICAjIGV4dHJhY3QgZmlsZSBuYW1lIGZyb20gRGF0YUl0ZW0KICAgIHNyY2ZpbGVwYXRoID0gc3RyKGRhdGFfa2V5KQogICAgCiAgICAjIFRPRE86IHRoaXMgc2hvdWxkIGJlIHBhcnQgb2YgZGF0YSdzIG1ldGFkYXRhIGRlYWx0IHdpdGggaW4gYW5vdGhlciBzdGVwIGdldCBhIGRhdGEgc2V0LCBzYW1wbGUsIGV0Yy4uLgogICAgIyBnZXQgYWxsIGRhdGEgb3IgYSBzYW1wbGUKICAgIGlmIChzYW1wbGUgPT0gLTEpIG9yIChzYW1wbGUgPj0gMSk6CiAgICAgICAgIyBnZXQgYWxsIHJvd3MsIG9yIGNvbnRpZ3VvdXMgc2FtcGxlIHN0YXJ0aW5nIGF0IHJvdyAxLgogICAgICAgIHJhdyA9IHBxLnJlYWRfdGFibGUoc3JjZmlsZXBhdGgpLnRvX3BhbmRhcygpLmRyb3BuYSgpCiAgICAgICAgbGFiZWxzID0gcmF3LnBvcChsYWJlbF9jb2x1bW4pCiAgICAgICAgcmF3ID0gcmF3Lmlsb2NbOnNhbXBsZSwgOl0KICAgICAgICBsYWJlbHMgPSBsYWJlbHMuaWxvY1s6c2FtcGxlXQogICAgZWxzZToKICAgICAgICAjIGdyYWIgYSByYW5kb20gc2FtcGxlCiAgICAgICAgcmF3ID0gcHEucmVhZF90YWJsZShzcmNmaWxlcGF0aCkudG9fcGFuZGFzKCkuZHJvcG5hKCkuc2FtcGxlKHNhbXBsZSAqIC0xKQogICAgICAgIGxhYmVscyA9IHJhdy5wb3AobGFiZWxfY29sdW1uKQoKICAgICMgVE9ETzogdGhpcyBzaG91bGQgYmUgcGFydCBvZiBkYXRhJ3MgbWV0YWRhdGEgZGVhbHQgd2l0aCBpbiBhbm90aGVyIHN0ZXAKICAgIGNvbnRleHQuaGVhZGVyID0gcmF3LmNvbHVtbnMudmFsdWVzCiAgICAKICAgICMgVE9ETzogYWxsIG9mIHRoaXMgc2hvdWxkIGJlIHBhcnQgb2YgYSBzcGl0dGVyIGNvbXBvbmVudCB0aGF0IGRvZXMgY3YgdG9vLCBkZWFsdCB3aXRoIGluIGFub3RoZXIgc3RlcAogICAgIyBtYWtlIGEgaG90IGVuY29kZSBjb3B5IG9mIGxhYmVscyBiZWZvcmUgdGhlIHNwbGl0CiAgICB5YiA9IGxhYmVsX2JpbmFyaXplKGxhYmVscywgY2xhc3Nlcz1saXN0KHJhbmdlKHJhdy5zaGFwZVsxXSkpKQogICAgIyBkb3VibGUgc3BsaXQgdG8gZ2VuZXJhdGUgMyBkYXRhIHNldHM6IHRyYWluLCB2YWxpZGF0aW9uIGFuZCB0ZXN0CiAgICAjIHdpdGggeHRlc3QseXRlc3Qgc2V0IGFzaWRlCiAgICB4LCB4dGVzdCwgeSwgeXRlc3QgPSB0cmFpbl90ZXN0X3NwbGl0KG5wLmNvbmNhdGVuYXRlKFtyYXcsIHliXSwgYXhpcz0wKSwgbGFiZWxzLCB0ZXN0X3NpemU9dGVzdF9zaXplLCByYW5kb21fc3RhdGU9cm5nKQogICAgeHRyYWluLCB4dmFsaWQsIHl0cmFpbiwgeXZhbGlkID0gdHJhaW5fdGVzdF9zcGxpdCh4LCB5LCB0cmFpbl9zaXplPXRyYWluX3ZhbF9zcGxpdCwgcmFuZG9tX3N0YXRlPXJuZykKICAgICMgZXh0cmFjdCB0aGUgaG90X2VuY29kZWQgbGFiZWxzCiAgICB5dHJhaW5iID0geHRyYWluWzosIC15Yi5zaGFwZVsxXTpdLmNvcHkoKQogICAgeHRyYWluID0geHRyYWluWzosIDoteWIuc2hhcGVbMV1dLmNvcHkoKQogICAgIyBleHRyYWN0IHRoZSBob3RfZW5jb2RlZCBsYWJlbHMKICAgIHl2YWxpZGIgPSB4dmFsaWRbOiwgLXliLnNoYXBlWzFdOl0uY29weSgpCiAgICB4dmFsaWQgPSB4dmFsaWRbOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpCiAgICAjIGV4dHJhY3QgdGhlIGhvdF9lbmNvZGVkIGxhYmVscwogICAgeXRlc3RiID0geHRlc3RbOiwgLXliLnNoYXBlWzFdOl0uY29weSgpCiAgICB4dGVzdCA9IHh0ZXN0WzosIDoteWIuc2hhcGVbMV1dLmNvcHkoKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAjIHNldC1hc2lkZSB0ZXN0X3NldAogICAgdGVzdF9zZXQgPSBwZC5jb25jYXQoCiAgICAgICAgW3BkLkRhdGFGcmFtZShkYXRhPXh0ZXN0LCBjb2x1bW5zPWNvbnRleHQuaGVhZGVyKSwKICAgICAgICAgcGQuRGF0YUZyYW1lKGRhdGE9eXRlc3QsIGNvbHVtbnM9W2xhYmVsX2NvbHVtbl0pLAogICAgICAgICBwZC5EYXRhRnJhbWUoZGF0YT15dGVzdGIsIGNvbHVtbnM9W2xhYmVsX2NvbHVtbl0pXSwKICAgICAgICBheGlzPTEsKQogICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCB0ZXN0X3NldF9rZXkgKyAiLnBxdCIpCiAgICB0ZXN0X3NldC50b19wYXJxdWV0KGZpbGVwYXRoLCBpbmRleD1GYWxzZSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KHRlc3Rfc2V0X2tleSwgbG9jYWxfcGF0aD10ZXN0X3NldF9rZXkgKyAiLnBxdCIpCgogICAgIyBsb2FkIHRoZSBtb2RlbCBjb25maWcKICAgIG1vZGVsX2NvbmZpZyA9IGdldF9tb2RlbF9jb25maWdzKG1vZGVsX3BrZ19jbGFzcykKICAgICMgZ2V0IHVwZGF0ZSBwYXJhbXMgaWYgYW55CiAgICBpZiBpc2luc3RhbmNlKGNsYXNzX3BhcmFtc191cGRhdGVzLCBEYXRhSXRlbSk6CiAgICAgICAgY2xhc3NfcGFyYW1zX3VwZGF0ZXMgPSBqc29uLmxvYWRzKGNsYXNzX3BhcmFtc191cGRhdGVzLmdldCgpKQogICAgaWYgaXNpbnN0YW5jZShmaXRfcGFyYW1zX3VwZGF0ZXMsIERhdGFJdGVtKToKICAgICAgICBmaXRfcGFyYW1zX3VwZGF0ZXMgPSBqc29uLmxvYWRzKGZpdF9wYXJhbXNfdXBkYXRlcy5nZXQoKSkKICAgICMgdXBkYXRlIHRoZSBwYXJhbWV0ZXJzICAgICAgICAgICAgCiAgICAjIGFkZCBkYXRhIHRvIGZpdCBwYXJhbXMKICAgIGZpdF9wYXJhbXNfdXBkYXRlcy51cGRhdGUoeydYJzogeHRyYWluLCd5JzogeXRyYWlufSkKICAgIG1vZGVsX2NvbmZpZyA9IHVwZGF0ZV9tb2RlbF9jb25maWcobW9kZWxfY29uZmlnLCBjbGFzc19wYXJhbXNfdXBkYXRlLCBmaXRfcGFyYW1zX3VwZGF0ZXMpCgogICAgIyBjcmVhdGUgY2xhc3MgYW5kIGZpdAogICAgQ2xhc3NpZmllckNsYXNzID0gX2NyZWF0ZV9jbGFzcyhtb2RlbF9jb25maWdbIk1FVEEiXVsiY2xhc3MiXSkKICAgIG1vZGVsID0gQ2xhc3NpZmllckNsYXNzKCoqY2xhc3NfcGFyYW1zKQogICAgbW9kZWwuZml0KCoqZml0X3BhcmFtcykKCiAgICAjIHNhdmUgbW9kZWwKICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKGJhc2VfcGF0aCwgZiJ7bW9kZWxzX2Rpcn0ve21vZGVsX2tleX0ucGtsIikKICAgIGR1bXAobW9kZWwsIG9wZW4oZmlsZXBhdGgsICJ3YiIpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QobW9kZWxfa2V5LCBsb2NhbF9wYXRoPW1vZGVsc19kaXIpCgogICAgIyBjb21wdXRlIHZhbGlkYXRpb24gbWV0cmljcwogICAgeXByZWQgPSBtb2RlbC5wcmVkaWN0KHh2YWxpZCkKICAgIHlfc2NvcmUgPSBtb2RlbC5wcmVkaWN0X3Byb2JhKHh2YWxpZCkKCiAgICBhdmVyYWdlX3ByZWNpc2lvbiA9IGF2ZXJhZ2VfcHJlY2lzaW9uX3Njb3JlKHl2YWxpZGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlfc2NvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2U9c2NvcmVfbWV0aG9kKQoKICAgIGNvbnRleHQubG9nX3Jlc3VsdChmImFjY3VyYWN5IiwgZmxvYXQobW9kZWwuc2NvcmUoeHZhbGlkLCB5dmFsaWQpKSkKICAgIGNvbnRleHQubG9nX3Jlc3VsdChmInJvY2F1YyIsIHJvY19hdWNfc2NvcmUoeXZhbGlkYiwgeV9zY29yZSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJmMV9zY29yZSIsIGYxX3Njb3JlKHl2YWxpZCwgeXByZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2U9c2NvcmVfbWV0aG9kKSkKICAgIGNvbnRleHQubG9nX3Jlc3VsdChmImF2Z19wcmVjc2NvcmUiLCBhdmVyYWdlX3ByZWNpc2lvbikKCiAgICAjIHZhbGlkYXRpb24gcGxvdHMKICAgIAogICAgcGxvdF9yb2MoY29udGV4dCwgeXZhbGlkYiwgeV9zY29yZSkKICAgIHBsb3RfY29uZnVzaW9uX21hdHJpeChjb250ZXh0LCB5dmFsaWQsIHlwcmVkLCBrZXk9ImNvbmZ1c2lvbiIsIGZtdD0icG5nIikKCmRlZiBwbG90X3JvYygKICAgIGNvbnRleHQsCiAgICB5X2xhYmVscywKICAgIHlfcHJvYnMsCiAgICBrZXk9InJvYyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBmbXQ9InBuZyIsCiAgICB4X2xhYmVsOiBzdHIgPSAiZmFsc2UgcG9zaXRpdmUgcmF0ZSIsCiAgICB5X2xhYmVsOiBzdHIgPSAgInRydWUgcG9zaXRpdmUgcmF0ZSIsCiAgICB0aXRsZTogc3RyID0gInJvYyBjdXJ2ZSIsCiAgICBsZWdlbmRfbG9jOiBzdHIgPSAiYmVzdCIKKToKICAgICIiInBsb3Qgcm9jIGN1cnZlcwogICAgCiAgICBUT0RPOiAgYWRkIGF2ZXJhZ2luZyBtZXRob2QgKGFzIHN0cmluZykgdGhhdCB3YXMgdXNlZCB0byBjcmVhdGUgcHJvYnMsIAogICAgZGlzcGxheSBpbiBsZWdlbmQKICAgIAogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSB5X2xhYmVsczogICAgIGdyb3VuZCB0cnV0aCBsYWJlbHMsIGhvdCBlbmNvZGVkIGZvciBtdWx0aWNsYXNzICAKICAgIDpwYXJhbSB5X3Byb2JzOiAgICAgIG1vZGVsIHByZWRpY3Rpb24gcHJvYmFiaWxpdGllcwogICAgOnBhcmFtIGtleTogICAgICAgICAgKCJyb2MiKSBrZXkgb2YgcGxvdCBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIHBsb3RzX2RpcjogICAgKCJwbG90cyIpIGRlc3RpbmF0aW9uIGZvbGRlciByZWxhdGl2ZSBwYXRoIHRvIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBmbXQ6ICAgICAgICAgICgicG5nIikgcGxvdCBmb3JtYXQKICAgIDpwYXJhbSB4X2xhYmVsOiAgICAgICgiZmFsc2UgcG9zaXRpdmUgcmF0ZSIpIHgtYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB5X2xhYmVsOiAgICAgICgidHJ1ZSBwb3NpdGl2ZSByYXRlIikgeS1heGlzIGxhYmVscwogICAgOnBhcmFtIHRpdGxlOiAgICAgICAgKCJyb2MgY3VydmUiKSB0aXRsZSBvZiBwbG90CiAgICA6cGFyYW0gbGVnZW5kX2xvYzogICAoImJlc3QiKSBsb2NhdGlvbiBvZiBwbG90IGxlZ2VuZAogICAgIiIiCiAgICAjIGRvbid0IGJvdGhlciBpZiB0aGlzIGRvZXNuJ3Qgd29yawogICAgYXNzZXJ0IHlfcHJvYnMuc2hhcGUgPT0geV9sYWJlbHMuc2hhcGUKICAgIAogICAgIyBjbGVhciBtYXRwbG90bGliIGN1cnJlbnQgZmlndXJlCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgIyBkYXRhIGFjY3VtbXVsYXRvcnMgYnkgY2xhc3MKICAgIGZwciA9IGRpY3QoKQogICAgdHByID0gZGljdCgpCiAgICByb2NfYXVjID0gZGljdCgpCiAgICAKICAgICMgZHJhdyA0NSBkZWdyZWUgbGluZQogICAgcGx0LnBsb3QoWzAsIDFdLCBbMCwgMV0sICJrLS0iKQogICAgCiAgICAjIGxhYmVsbGluZwogICAgcGx0LnhsYWJlbCh4X2xhYmVsKQogICAgcGx0LnlsYWJlbCh5X2xhYmVsKQogICAgcGx0LnRpdGxlKHRpdGxlKQogICAgcGx0LmxlZ2VuZChsb2M9bGVnZW5kX2xvYykKICAgIAogICAgIyBzaW5nbGUgUk9DIG9yIG11dGxpcGxlCiAgICBmb3IgaSBpbiByYW5nZSh5X2xhYmVscy5zaGFwZVsxXSk6CiAgICAgICAgZnByW2ldLCB0cHJbaV0sIF8gPSBtZXRyaWNzLnJvY19jdXJ2ZSh5X2xhYmVsc1s6LCBpXSwgeV9wcm9ic1s6LCBpXSwgcG9zX2xhYmVsPTEpCiAgICAgICAgcm9jX2F1Y1tpXSA9IG1ldHJpY3MuYXVjKGZwcltpXSwgdHByW2ldKQogICAgICAgIHBsdC5wbG90KGZwcltpXSwgdHByW2ldLCBsYWJlbD1mImNsYXNzIHtpfSIpCgogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9LntmbXR9IgogICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZm5hbWUpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1wbHQuZ2NmKCkpLCBsb2NhbF9wYXRoPWZuYW1lKQogICAgCgpkZWYgcGxvdF9jb25mdXNpb25fbWF0cml4KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBsYWJlbHMsCiAgICBwcmVkaWN0aW9ucywKICAgIGtleTogc3RyID0gImNvbmZ1c2lvbl9tYXRyaXgiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgY29sb3JtYXA6IHN0ciA9ICJCbHVlcyIsCiAgICBmbXQ6IHN0ciA9ICJwbmciLAogICAgc2FtcGxlX3dlaWdodD1Ob25lCik6CiAgICAiIiJDcmVhdGUgYSBjb25mdXNpb24gbWF0cml4LgogICAgUGxvdCBhbmQgc2F2ZSBhIGNvbmZ1c2lvbiBtYXRyaXggdXNpbmcgdGVzdCBkYXRhIGZyb20gYQogICAgbW9kZWxsaW5lIHN0ZXAuCiAgICAKICAgIFNlZSBodHRwczovL3NjaWtpdC1sZWFybi5vcmcvc3RhYmxlL21vZHVsZXMvZ2VuZXJhdGVkL3NrbGVhcm4ubWV0cmljcy5jb25mdXNpb25fbWF0cml4Lmh0bWwKICAgIAogICAgVE9ETzogZml4IGxhYmVsIGFsaWdubWVudAogICAgVE9ETzogY29uc2lkZXIgdXNpbmcgYW5vdGhlciBwYWNrYWdlZCB2ZXJzaW9uCiAgICBUT0RPOiByZWZhY3RvciB0byB0YWtlIHBhcmFtcyBkaWN0IGZvciBwbG90IG9wdGlvbnMKCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbGFiZWxzOiAgICAgICAgICB2YWxpZGF0aW9uIGRhdGEgZ3JvdW5kLXRydXRoIGxhYmVscwogICAgOnBhcmFtIHByZWRpY3Rpb25zOiAgICAgdmFsaWRhdGlvbiBkYXRhIHByZWRpY3Rpb25zCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICAgICBzdHIKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgIHJlbGF0aXZlIHBhdGggb2YgcGxvdHMgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBjb2xvcm1hcDogICAgICAgIGNvbG91cm1hcCBmb3IgY29uZnVzaW9uIG1hdHJpeAogICAgOnBhcmFtIGZtdDogICAgICAgICAgICAgcGxvdCBmb3JtYXQKICAgIDpwYXJhbSBzYW1wbGVfd2VpZ2h0OiAgIHNhbXBsZSB3ZWlnaHRzCiAgICAiIiIKICAgIF9nY2ZfY2xlYXIocGx0KQogICAgCiAgICBjbSA9IG1ldHJpY3MuY29uZnVzaW9uX21hdHJpeChsYWJlbHMsIHByZWRpY3Rpb25zLCBzYW1wbGVfd2VpZ2h0PU5vbmUpCiAgICBzbnMuaGVhdG1hcChjbSwgYW5ub3Q9VHJ1ZSwgY21hcD1jb2xvcm1hcCwgc3F1YXJlPVRydWUpCgogICAgZmlnID0gcGx0LmdjZigpCiAgICBmbmFtZSA9IGYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICBmaWcuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmbmFtZSkpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3Qoa2V5LCBib2R5PWZpZyksIGxvY2FsX3BhdGg9Zm5hbWUpCg==
    commands: []
    code_origin: https://github.com/mlrun/functions.git#4beef786d05526f4ba9c4131dd44e4d7a1551c92:sklearn_classifier/sklearn_classifier.py
