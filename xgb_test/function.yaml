kind: job
metadata:
  name: xgb-test
  tag: ''
  hash: 50dab8c1873e00927e7875d63e7a4eacdfed0fa2
  project: ''
  labels:
    author: yjb
    framework: xgboost
  categories:
  - ml
  - test
spec:
  command: ''
  args: []
  image: yjbds/ml-models:0.4.7
  env: []
  default_handler: xgb_test
  entry_points:
    xgb_test:
      name: xgb_test
      doc: "Test one or more classifier models against held-out dataset\n\nUsing held-out\
        \ test features, evaluates the peformance of the estimated model\n\nCan be\
        \ part of a kubeflow pipeline as a test step that is run post EDA and \ntraining/validation\
        \ cycles"
      parameters:
      - name: context
        doc: the function context
      - name: models_path
        type: DataItem
        doc: model artifact to be tested
      - name: test_set
        type: DataItem
        doc: test features and labels
      - name: label_column
        type: str
        doc: column name for ground truth labels
      - name: plots_dest
        type: str
        doc: dir for test plots
        default: plots
      - name: model_evaluator
        doc: 'WIP: specific method to generate eval, passed in as string or available
          in this folder'
      - name: default_model
        type: str
        doc: '''model.pkl'', default model artifact file name'
        default: model.pkl
      outputs: []
      lineno: 14
  description: test a classifier using held-out or new data
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgppbXBvcnQgb3MKaW1wb3J0IHBhbmRhcyBhcyBwZApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IGdldF9tb2RlbApmcm9tIGNsb3VkcGlja2xlIGltcG9ydCBsb2FkCmZyb20gbWx1dGlscyBpbXBvcnQgZXZhbF9jbGFzc19tb2RlbApmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCB1cmxvcGVuCgpkZWYgeGdiX3Rlc3QoCiAgICBjb250ZXh0LAogICAgbW9kZWxzX3BhdGg6IERhdGFJdGVtLCAKICAgIHRlc3Rfc2V0OiBEYXRhSXRlbSwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgcGxvdHNfZGVzdDogc3RyID0gInBsb3RzIiwKICAgIG1vZGVsX2V2YWx1YXRvciA9IE5vbmUsCiAgICBkZWZhdWx0X21vZGVsOiBzdHIgPSAibW9kZWwucGtsIgopIC0+IE5vbmU6CiAgICAiIiJUZXN0IG9uZSBvciBtb3JlIGNsYXNzaWZpZXIgbW9kZWxzIGFnYWluc3QgaGVsZC1vdXQgZGF0YXNldAogICAgCiAgICBVc2luZyBoZWxkLW91dCB0ZXN0IGZlYXR1cmVzLCBldmFsdWF0ZXMgdGhlIHBlZm9ybWFuY2Ugb2YgdGhlIGVzdGltYXRlZCBtb2RlbAogICAgCiAgICBDYW4gYmUgcGFydCBvZiBhIGt1YmVmbG93IHBpcGVsaW5lIGFzIGEgdGVzdCBzdGVwIHRoYXQgaXMgcnVuIHBvc3QgRURBIGFuZCAKICAgIHRyYWluaW5nL3ZhbGlkYXRpb24gY3ljbGVzCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbW9kZWxzX3BhdGg6ICAgICBtb2RlbCBhcnRpZmFjdCB0byBiZSB0ZXN0ZWQKICAgIDpwYXJhbSB0ZXN0X3NldDogICAgICAgIHRlc3QgZmVhdHVyZXMgYW5kIGxhYmVscwogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgY29sdW1uIG5hbWUgZm9yIGdyb3VuZCB0cnV0aCBsYWJlbHMKICAgIDpwYXJhbSBwbG90c19kZXN0OiAgICAgIGRpciBmb3IgdGVzdCBwbG90cwogICAgOnBhcmFtIG1vZGVsX2V2YWx1YXRvcjogV0lQOiBzcGVjaWZpYyBtZXRob2QgdG8gZ2VuZXJhdGUgZXZhbCwgcGFzc2VkIGluIGFzIHN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgYXZhaWxhYmxlIGluIHRoaXMgZm9sZGVyCiAgICA6cGFyYW0gZGVmYXVsdF9tb2RlbDogICAnbW9kZWwucGtsJywgZGVmYXVsdCBtb2RlbCBhcnRpZmFjdCBmaWxlIG5hbWUKICAgICIiIiAgCiAgICB4dGVzdCA9IHRlc3Rfc2V0LmFzX2RmKCkKICAgIHl0ZXN0ID0geHRlc3QucG9wKGxhYmVsX2NvbHVtbikKICAgIAogICAgdHJ5OgogICAgICAgIG1vZGVsX2ZpbGUsIG1vZGVsX29iaiwgXyA9IGdldF9tb2RlbChtb2RlbHNfcGF0aC51cmwsIHN1ZmZpeD0nLnBrbCcpCiAgICAgICAgbW9kZWxfb2JqID0gbG9hZChvcGVuKG1vZGVsX2ZpbGUsICJyYiIpKQogICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgdmE6IAogICAgICAgIG1vZGVsX29iaiA9IGxvYWQodXJsb3Blbihvcy5wYXRoLmpvaW4oc3RyKG1vZGVsc19wYXRoKSwgZGVmYXVsdF9tb2RlbCkpKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBhOgogICAgICAgIHJhaXNlIEV4Y2VwdGlvbigibW9kZWwgbG9jYXRpb24gbGlrZWx5IHNwZWNpZmllZCIpCgogICAgaWYgbm90IG1vZGVsX2V2YWx1YXRvcjoKICAgICAgICBldmFsX21ldHJpY3MgPSBldmFsX2NsYXNzX21vZGVsKGNvbnRleHQsIHh0ZXN0LCB5dGVzdCwgbW9kZWxfb2JqKQoKICAgIG1vZGVsX3Bsb3RzID0gZXZhbF9tZXRyaWNzLnBvcCgicGxvdHMiKQogICAgbW9kZWxfdGFibGVzID0gZXZhbF9tZXRyaWNzLnBvcCgidGFibGVzIikKICAgIGZvciBwbG90IGluIG1vZGVsX3Bsb3RzOgogICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KHBsb3QsIGxvY2FsX3BhdGg9ZiJ7cGxvdHNfZGVzdH0ve3Bsb3Qua2V5fS5odG1sIikKICAgIGZvciB0YmwgaW4gbW9kZWxfdGFibGVzOgogICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KHRibCwgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS97cGxvdC5rZXl9LmNzdiIpCgogICAgY29udGV4dC5sb2dfcmVzdWx0cyhldmFsX21ldHJpY3MpCgo=
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#5a858f627203e3708519818a7e65938f6607ff12:xgb_test.ipynb
